<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroManager Pro - Sistema de Gestão Agrícola Avançado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#22C55E',
                        secondary: '#3B82F6', 
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        success: '#10B981',
                        warning: '#F59E0B',
                        info: '#3B82F6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 0.6s ease-in-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'zoom-in': 'zoomIn 0.3s ease-out'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes bounceGentle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { 
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 50%, #15803D 100%);
        }

        .metric-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .loading-overlay {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }
        .dark .loading-overlay {
            background: rgba(17, 24, 39, 0.9);
        }

        .notification {
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .notification.show {
            transform: translateX(0);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container-large {
            position: relative;
            height: 400px;
        }

        .data-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        .data-table th:first-child { border-radius: 0.5rem 0 0 0; }
        .data-table th:last-child { border-radius: 0 0.5rem 0 0; }
        .data-table tr:last-child td:first-child { border-radius: 0 0 0 0.5rem; }
        .data-table tr:last-child td:last-child { border-radius: 0 0 0.5rem 0; }

        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .btn-primary {
            @apply bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-secondary {
            @apply bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-6 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-danger {
            @apply bg-danger text-white px-4 py-2 rounded-lg hover:bg-danger/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-warning {
            @apply bg-warning text-white px-4 py-2 rounded-lg hover:bg-warning/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .tab-button {
            @apply bg-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #16A34A, #15803D);
        }

        .equipment-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .equipment-card:hover {
            transform: translateY(-12px) rotateX(5deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .dark .equipment-card {
            background: linear-gradient(145deg, #1f2937, #111827);
        }

        .progress-bar {
            overflow: hidden;
        }
        .progress-fill {
            animation: progressFill 2s ease-out forwards;
        }
        @keyframes progressFill {
            from { width: 0%; }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .status-indicator {
            position: relative;
            display: inline-block;
        }
        .status-indicator::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .status-online::after { background: #10b981; animation: pulse 2s infinite; }
        .status-warning::after { background: #f59e0b; }
        .status-offline::after { background: #ef4444; }

        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .save-button {
            position: fixed;
            top: 120px;
            right: 20px;
            z-index: 40;
            transition: all 0.3s ease;
        }

        .save-button:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-all duration-300 font-sans">
    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="relative inline-block mb-8">
                <div class="w-20 h-20 border-4 border-primary/20 rounded-full animate-spin"></div>
                <div class="absolute inset-0 w-20 h-20 border-4 border-primary border-t-transparent rounded-full animate-spin" style="animation-delay: -0.15s"></div>
                <i class="fas fa-tractor absolute inset-0 text-3xl text-primary flex items-center justify-center"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">AgroManager Pro</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Sistema Inteligente de Gestão Agrícola</p>
            <div class="w-64 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mx-auto">
                <div id="loadingProgress" class="bg-gradient-to-r from-primary to-secondary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="loadingText" class="text-sm text-gray-500 dark:text-gray-400 mt-4">Inicializando...</p>
        </div>
    </div>

    <!-- Save Button -->
    <button id="saveButton" onclick="manualSave()" class="save-button btn-primary shadow-2xl">
        <i class="fas fa-save mr-2"></i>Salvar Dados
    </button>

    <div id="app" class="min-h-screen opacity-0 transition-opacity duration-500">
        <!-- Enhanced Header -->
        <header class="gradient-bg text-white shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-black opacity-10"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20"></div>
            <div class="container mx-auto px-4 py-6 relative z-10">
                <div class="flex flex-col lg:flex-row items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <i class="fas fa-tractor text-4xl"></i>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <h1 class="text-3xl lg:text-4xl font-bold">AgroManager Pro</h1>
                            <p class="text-sm opacity-90">Sistema Inteligente de Gestão Agrícola Completo</p>
                            <div class="flex items-center mt-1 text-xs opacity-75">
                                <i class="fas fa-shield-check mr-1"></i>
                                <span>Versão 2.5.0 - Sistema Online</span>
                                <span class="mx-2">•</span>
                                <span id="dataStatus">Dados carregados</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Week Navigator -->
                    <div class="flex items-center space-x-4 glass-card rounded-xl px-6 py-3">
                        <button onclick="previousWeek()" class="text-white hover:text-yellow-300 transition-all p-2 rounded-lg hover:bg-white/10 transform hover:scale-110">
                            <i class="fas fa-chevron-left text-lg"></i>
                        </button>
                        <div class="text-center">
                            <div class="text-xs opacity-80 uppercase tracking-wide">Período de Análise</div>
                            <div class="text-lg font-bold" id="currentWeek">Semana 1/2024</div>
                            <div class="text-xs opacity-70" id="weekProgress">5 de 7 dias</div>
                        </div>
                        <button onclick="nextWeek()" class="text-white hover:text-yellow-300 transition-all p-2 rounded-lg hover:bg-white/10 transform hover:scale-110">
                            <i class="fas fa-chevron-right text-lg"></i>
                        </button>
                        <button onclick="goToCurrentWeek()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm transition-all transform hover:scale-105">
                            <i class="fas fa-calendar-day mr-2"></i>Hoje
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm opacity-80" id="currentDate">Carregando...</div>
                            <div class="text-xs opacity-70" id="currentTime">--:--</div>
                        </div>
                        
                        <!-- Auto-save status indicator -->
                        <div id="saveStatus" class="text-xs bg-white/20 px-3 py-2 rounded-lg opacity-0 transition-all">
                            <i class="fas fa-check mr-1"></i>Salvo automaticamente
                        </div>
                        
                        <!-- Data info -->
                        <div class="text-xs bg-white/10 px-3 py-2 rounded-lg">
                            <div class="text-xs opacity-70">Registros:</div>
                            <div class="font-bold" id="totalRecords">0</div>
                        </div>
                        
                        <!-- Notification Badge -->
                        <button onclick="openNotifications()" class="relative p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i class="fas fa-bell text-lg"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">3</span>
                        </button>
                        
                        <button onclick="toggleTheme()" class="p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i id="themeIcon" class="fas fa-moon text-lg"></i>
                        </button>
                        
                        <button onclick="openSettings()" class="p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i class="fas fa-cog text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Enhanced Navigation Tabs -->
        <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 overflow-x-auto custom-scrollbar">
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap active flex items-center" onclick="showTab('colhedoras', this)">
                        <i class="fas fa-wheat-awn mr-2"></i>Colhedoras
                        <span class="ml-2 bg-primary/20 text-primary px-2 py-1 rounded-full text-xs" id="colhedorasCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('transbordo', this)">
                        <i class="fas fa-truck mr-2"></i>Transbordos
                        <span class="ml-2 bg-secondary/20 text-secondary px-2 py-1 rounded-full text-xs" id="transbordosCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('caminhoes', this)">
                        <i class="fas fa-truck-moving mr-2"></i>Caminhões
                        <span class="ml-2 bg-accent/20 text-accent px-2 py-1 rounded-full text-xs" id="caminhoesCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('moagem', this)">
                        <i class="fas fa-industry mr-2"></i>Moagem
                        <span class="ml-2 bg-indigo-500/20 text-indigo-600 px-2 py-1 rounded-full text-xs" id="moagemCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('relatorios', this)">
                        <i class="fas fa-chart-line mr-2"></i>Relatórios
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('cadastro', this)">
                        <i class="fas fa-plus-circle mr-2"></i>Cadastro
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Colhedoras Tab -->
            <div id="colhedoras" class="tab-content active animate-fade-in">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão Completa de Colhedoras</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle total da operação de colheita - Produtividade, Consumo e Eficiência</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportColhedorasData()" class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            <button onclick="openColhedoraModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Colhedoras -->
                <div class="mb-8">
                    <!-- Métricas das Colhedoras -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Colhedoras</h3>
                            <p class="text-gray-600 dark:text-gray-400">Performance detalhada e indicadores de produtividade</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Produção Total</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="colhedorasProducaoTotal">0t</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Período selecionado</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-wheat-awn text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span id="colhedorasProducaoTrend">+12% vs período anterior</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Horas Operação</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="colhedorasHorasTotal">0h</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Motor + Sistema</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-clock text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span id="colhedorasEficienciaHoras">Eficiência operacional: 89%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 border border-red-200 dark:border-red-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-red-700 dark:text-red-300 uppercase tracking-wide">Combustível Total</p>
                                        <p class="text-2xl font-bold text-red-900 dark:text-red-100" id="colhedorasCombustivel">0L</p>
                                        <p class="text-xs text-red-600 dark:text-red-400 mt-1">Diesel consumido</p>
                                    </div>
                                    <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-red-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-red-600 dark:text-red-400">
                                        <i class="fas fa-chart-line mr-1"></i>
                                        <span id="colhedorasConsumoMedio">Consumo médio: 15.2L/t</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Produtividade</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="colhedorasProdutividade">0 t/h</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Performance média</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-tachometer-alt text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-trophy mr-1"></i>
                                        <span id="colhedorasMelhorPerf">Melhor: Colhedora Alpha</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos das Colhedoras -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Produção Diária vs Meta de Colheita</h4>
                                <div class="flex space-x-2">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Esta Semana</option>
                                        <option>Semana Passada</option>
                                        <option>Este Mês</option>
                                    </select>
                                    <button onclick="expandChart('colhedorasProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasProducaoChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência por Equipamento</h4>
                                <div class="flex space-x-2">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Produtividade</option>
                                        <option>Consumo</option>
                                        <option>Disponibilidade</option>
                                    </select>
                                    <button onclick="expandChart('colhedorasEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Análise Detalhada -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-lg font-bold text-gray-900 dark:text-white">Análise Detalhada de Consumo e Fluidos</h4>
                            <button onclick="expandChart('colhedorasConsumoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                <i class="fas fa-expand text-sm"></i>
                            </button>
                        </div>
                        <div class="chart-container">
                            <canvas id="colhedorasConsumoChart"></canvas>
                        </div>
                    </div>

                    <!-- Colhedoras Cards Grid -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Equipamentos Cadastrados e Status Operacional</h3>
                        <div id="colhedorasGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transbordos Tab -->
            <div id="transbordo" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão Completa de Transbordos</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle detalhado do transporte interno de grãos e logística de campo</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportTransbordosData()" class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            <button onclick="openTransbordoModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Transbordos -->
                <div class="mb-8">
                    <!-- Métricas dos Transbordos -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Transbordos</h3>
                            <p class="text-gray-600 dark:text-gray-400">Desempenho logístico e eficiência de transporte interno</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Carga Transportada</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="transbordosCargaTotal">0t</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Total do período</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-truck text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-chart-line mr-1"></i>
                                        <span id="transbordosEficienciaCarga">Média: 18.5 t/viagem</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="transbordosViagensTotal">0</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Ciclos completos</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-route text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span id="transbordosTempoMedio">Tempo médio: 45min/ciclo</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 border border-purple-200 dark:border-purple-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wide">Diesel Consumido</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" id="transbordosDiesel">0L</p>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">Combustível total</p>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-purple-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-purple-600 dark:text-purple-400">
                                        <i class="fas fa-calculator mr-1"></i>
                                        <span id="transbordosConsumoPorTonelada">Eficiência: 2.8 L/t</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 border border-orange-200 dark:border-orange-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-orange-700 dark:text-orange-300 uppercase tracking-wide">Óleo Hidráulico</p>
                                        <p class="text-2xl font-bold text-orange-900 dark:text-orange-100" id="transbordosHidraulico">0L</p>
                                        <p class="text-xs text-orange-600 dark:text-orange-400 mt-1">Sistema hidráulico</p>
                                    </div>
                                    <div class="w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-oil-can text-xl text-orange-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-orange-600 dark:text-orange-400">
                                        <i class="fas fa-wrench mr-1"></i>
                                        <span id="transbordosManutencao">Próxima manutenção: 15 dias</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Disponibilidade</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="transbordosDisponibilidade">0%</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Tempo operacional</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-check-circle text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-tools mr-1"></i>
                                        <span id="transbordosParadas">Parada preventiva: 2h</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos dos Transbordos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Operações Logísticas Diárias</h4>
                                <button onclick="expandChart('transbordosOperacoesChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosOperacoesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência Comparativa</h4>
                                <button onclick="expandChart('transbordosEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Transbordos Cards Grid -->
                    <div id="transbordosGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Caminhões Tab -->
            <div id="caminhoes" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão da Frota de Caminhões</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle completo da frota própria e terceirizada - Transporte rodoviário</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportCaminhoesData()" class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            <button onclick="openCaminhaoModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Caminhões -->
                <div class="mb-8">
                    <!-- Métricas dos Caminhões -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Frota de Caminhões</h3>
                            <p class="text-gray-600 dark:text-gray-400">Performance rodoviária e estatísticas de transporte externo</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Carga Transportada</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="caminhoesProducaoTotal">0t</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Volume total</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-truck-moving text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-weight mr-1"></i>
                                        <span id="caminhoesCargaMedia">Carga média: 28.5t por viagem</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Distância Total</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="caminhoesDistanciaTotal">0km</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Quilometragem</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-route text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-road mr-1"></i>
                                        <span id="caminhoesDistanciaMedia">Distância média: 85km/viagem</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Viagens Completas</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="caminhoesViagensTotal">0</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Ciclos realizados</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-list-ol text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-stopwatch mr-1"></i>
                                        <span id="caminhoesTempoViagem">Tempo médio: 2.5h/viagem</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 border border-red-200 dark:border-red-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-red-700 dark:text-red-300 uppercase tracking-wide">Combustível</p>
                                        <p class="text-2xl font-bold text-red-900 dark:text-red-100" id="caminhoesCombustivelTotal">0L</p>
                                        <p class="text-xs text-red-600 dark:text-red-400 mt-1">Diesel consumido</p>
                                    </div>
                                    <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-red-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-red-600 dark:text-red-400">
                                        <i class="fas fa-chart-bar mr-1"></i>
                                        <span id="caminhoesConsumoKm">Eficiência: 3.2km/L</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 border border-purple-200 dark:border-purple-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wide">Eficiência</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" id="caminhoesEficiencia">0 t/km</p>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">Produtividade</p>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-chart-line text-xl text-purple-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-purple-600 dark:text-purple-400">
                                        <i class="fas fa-trophy mr-1"></i>
                                        <span id="caminhoesMelhorEfic">Melhor: Volvo FH540</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos dos Caminhões -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Produção vs Distância Percorrida</h4>
                                <button onclick="expandChart('caminhoesProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesProducaoChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência Comparativa da Frota</h4>
                                <button onclick="expandChart('caminhoesEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Caminhões Cards Grid -->
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Frota de Caminhões - Status e Performance</h3>
                    <div id="caminhoesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Moagem Tab -->
            <div id="moagem" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão de Moagem Industrial</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle de produção detalhado por frentes de trabalho e unidades produtivas</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportMoagemData()" class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            <button onclick="openMoagemModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Resumo de Moagem Semanal -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Resumo da Moagem Industrial</h3>
                        <p class="text-gray-600 dark:text-gray-400">Produção total consolidada de todas as frentes e unidades</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center p-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-200 dark:border-indigo-700">
                            <div class="w-16 h-16 bg-indigo-500/20 rounded-xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-industry text-2xl text-indigo-600"></i>
                            </div>
                            <div class="text-3xl font-bold text-indigo-600 mb-2" id="moagemTotalSemana">0t</div>
                            <div class="text-sm text-gray-500">Produção Total</div>
                            <div class="text-xs text-indigo-600 mt-2">
                                <i class="fas fa-arrow-up mr-1"></i>
                                +18% vs período anterior
                            </div>
                        </div>
                        
                        <div class="text-center p-6 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-700">
                            <div class="w-16 h-16 bg-green-500/20 rounded-xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-users text-2xl text-green-600"></i>
                            </div>
                            <div class="text-3xl font-bold text-green-600 mb-2" id="frentesAtivas">0</div>
                            <div class="text-sm text-gray-500">Frentes Ativas</div>
                            <div class="text-xs text-green-600 mt-2">
                                <i class="fas fa-check-circle mr-1"></i>
                                100% operacionais
                            </div>
                        </div>
                        
                        <div class="text-center p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-700">
                            <div class="w-16 h-16 bg-blue-500/20 rounded-xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-calendar-check text-2xl text-blue-600"></i>
                            </div>
                            <div class="text-3xl font-bold text-blue-600 mb-2" id="diasProducao">0</div>
                            <div class="text-sm text-gray-500">Dias de Produção</div>
                            <div class="text-xs text-blue-600 mt-2">
                                <i class="fas fa-clock mr-1"></i>
                                Eficiência operacional: 96%
                            </div>
                        </div>
                        
                        <div class="text-center p-6 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-200 dark:border-amber-700">
                            <div class="w-16 h-16 bg-amber-500/20 rounded-xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-chart-line text-2xl text-amber-600"></i>
                            </div>
                            <div class="text-3xl font-bold text-amber-600 mb-2" id="mediaDiaria">0t</div>
                            <div class="text-sm text-gray-500">Média Diária</div>
                            <div class="text-xs text-amber-600 mt-2">
                                <i class="fas fa-target mr-1"></i>
                                Meta estabelecida: 45t/dia
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráficos de Moagem -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Produção por Frente de Trabalho</h3>
                            <div class="flex space-x-2">
                                <button onclick="app.updateMoagemChart()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-refresh text-sm"></i>
                                </button>
                                <button onclick="expandChart('moagemFrentesChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="moagemFrentesChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Evolução da Produção Diária</h3>
                            <div class="flex space-x-2">
                                <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                    <option>Esta Semana</option>
                                    <option>Semana Passada</option>
                                    <option>Este Mês</option>
                                </select>
                                <button onclick="expandChart('moagemDiariaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="moagemDiariaChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Registros de Moagem -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Registros Detalhados de Moagem</h3>
                        <div class="flex items-center space-x-4">
                            <select id="filtroFrente" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-1 bg-white dark:bg-gray-700">
                                <option value="">Todas as Frentes</option>
                            </select>
                            <button onclick="app.updateMoagemGrid()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="data-table w-full">
                            <thead>
                                <tr class="bg-gray-50 dark:bg-gray-700">
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Frente</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Produção (t)</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Meta (%)</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Observações</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="moagemTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Relatórios Tab -->
            <div id="relatorios" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Relatórios Analíticos Avançados</h2>
                            <p class="text-gray-600 dark:text-gray-400">Análises detalhadas, insights operacionais e indicadores de performance</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="generateReport()" class="btn-primary">
                                <i class="fas fa-chart-line mr-2"></i>Gerar Relatório Completo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Categories -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="openProductionReport()">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center mr-3">
                                <i class="fas fa-chart-bar text-xl text-green-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Relatório de Produção</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Análise de produtividade</p>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Relatórios detalhados de produção por equipamento, período e frente de trabalho com comparativos históricos.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-green-600 font-medium">Última atualização: Hoje</span>
                            <i class="fas fa-arrow-right text-green-600"></i>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="openEfficiencyReport()">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mr-3">
                                <i class="fas fa-tachometer-alt text-xl text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência Operacional</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Indicadores de performance</p>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise completa de eficiência, tempo de operação, otimização de recursos e benchmarking.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-600 font-medium">Última atualização: Hoje</span>
                            <i class="fas fa-arrow-right text-blue-600"></i>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="openCostReport()">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center mr-3">
                                <i class="fas fa-dollar-sign text-xl text-amber-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Relatório de Custos</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Análise financeira</p>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Controle detalhado de custos operacionais, combustível, manutenção e análise de rentabilidade.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-amber-600 font-medium">Última atualização: Hoje</span>
                            <i class="fas fa-arrow-right text-amber-600"></i>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Estatísticas Consolidadas do Período</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-primary mb-2" id="totalProducaoReport">0t</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Produção Total (Período)</div>
                            <div class="text-xs text-primary mt-1">Todas as operações</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-secondary mb-2" id="totalHorasReport">0h</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Horas Operadas</div>
                            <div class="text-xs text-secondary mt-1">Tempo produtivo total</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-accent mb-2" id="totalCombustivelReport">0L</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Combustível Consumido</div>
                            <div class="text-xs text-accent mt-1">Diesel + outros</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600 mb-2" id="eficienciaMediaReport">0%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Eficiência Média</div>
                            <div class="text-xs text-green-600 mt-1">Performance geral</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Tab -->
            <div id="cadastro" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Equipment Registration Form -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                            <i class="fas fa-plus-circle mr-3 text-primary"></i>Cadastrar Novo Equipamento
                        </h3>
                        <form id="equipmentForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Tipo de Equipamento *
                                    </label>
                                    <select id="tipoEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                        <option value="colhedora">Colhedora</option>
                                        <option value="transbordo">Transbordo</option>
                                        <option value="caminhao">Caminhão</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Nome/Identificação *
                                    </label>
                                    <input type="text" id="nomeEquipamento" placeholder="Ex: Colhedora 01" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Marca *
                                    </label>
                                    <input type="text" id="marcaEquipamento" placeholder="Ex: John Deere" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Modelo *
                                    </label>
                                    <input type="text" id="modeloEquipamento" placeholder="Ex: S770" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Ano
                                    </label>
                                    <input type="number" id="anoEquipamento" placeholder="2024" min="1900" max="2030" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Placa/Número
                                    </label>
                                    <input type="text" id="placaEquipamento" placeholder="ABC-1234" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full btn-primary">
                                <i class="fas fa-save mr-2"></i>Cadastrar Equipamento
                            </button>
                        </form>
                    </div>

                    <!-- Equipment List -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                <i class="fas fa-list mr-3 text-primary"></i>Equipamentos Cadastrados
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="refreshEquipmentList()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button onclick="exportEquipmentList()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Search and Filter -->
                        <div class="mb-4">
                            <input type="text" id="equipmentListSearch" placeholder="Buscar equipamento..." 
                                   class="w-full px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div id="equipmentList" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Enhanced Floating Action Button -->
        <div class="floating-action">
            <div class="relative">
                <button onclick="toggleQuickActionMenu()" class="w-16 h-16 bg-gradient-to-r from-primary to-secondary text-white rounded-full shadow-2xl hover:shadow-3xl transition-all transform hover:scale-110 active:scale-95 relative overflow-hidden">
                    <div class="absolute inset-0 bg-white opacity-0 hover:opacity-20 transition-opacity rounded-full"></div>
                    <i class="fas fa-plus text-xl relative z-10" id="fabIcon"></i>
                </button>
                
                <!-- Quick Action Menu -->
                <div id="quickActionMenu" class="absolute bottom-20 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 w-48 hidden transform scale-95 opacity-0 transition-all duration-300">
                    <div class="space-y-2">
                        <button onclick="openColhedoraModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-wheat-awn mr-3 text-green-600"></i>
                            <span>Nova Colhedora</span>
                        </button>
                        <button onclick="openTransbordoModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-truck mr-3 text-blue-600"></i>
                            <span>Novo Transbordo</span>
                        </button>
                        <button onclick="openCaminhaoModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-truck-moving mr-3 text-amber-600"></i>
                            <span>Novo Caminhão</span>
                        </button>
                        <button onclick="openMoagemModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-industry mr-3 text-indigo-600"></i>
                            <span>Nova Moagem</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <div id="modalOverlay" class="fixed inset-0 modal-backdrop z-50 hidden items-center justify-center p-4">
        <div id="modalContent" class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Dynamic modal content -->
        </div>
    </div>

    <!-- Enhanced Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-4 max-w-sm"></div>

    <script>
        // Support dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Enhanced Application State Management
        class AgroManagerApp {
            constructor() {
                this.state = {
                    equipamentos: [],
                    colhedorasData: [],
                    transbordosData: [],
                    caminhoesData: [],
                    moagemData: [],
                    currentWeekStart: new Date(),
                    charts: {},
                    notifications: [],
                    filters: {
                        equipmentSearch: '',
                        statusFilter: '',
                        dateRange: 'week'
                    },
                    settings: {
                        theme: 'light',
                        autoSave: true,
                        notifications: true,
                        language: 'pt-BR',
                        refreshInterval: 30000
                    },
                    version: '2.5.0',
                    lastUpdate: new Date(),
                    lastSave: null
                };
                this.init();
            }

            async init() {
                try {
                    await this.loadData();
                    this.setupEventListeners();
                    this.setupTheme();
                    this.setCurrentWeek();
                    this.startRealTimeUpdates();
                    await this.simulateLoading();
                    this.showApp();
                    this.updateDashboard();
                    this.updateEquipmentList();
                    this.updateTabCounts();
                    this.updateDataStatus();
                    this.showNotification('Sistema AgroManager Pro carregado com sucesso! 🚜', 'success');
                    this.startAutoSave();
                } catch (error) {
                    console.error('Erro na inicialização:', error);
                    this.showNotification('Erro ao carregar sistema', 'error');
                }
            }

            async simulateLoading() {
                const progress = document.getElementById('loadingProgress');
                const text = document.getElementById('loadingText');
                
                const steps = [
                    { progress: 20, text: 'Carregando configurações do sistema...' },
                    { progress: 40, text: 'Inicializando equipamentos cadastrados...' },
                    { progress: 60, text: 'Preparando dashboard operacional...' },
                    { progress: 80, text: 'Conectando módulos de análise...' },
                    { progress: 100, text: 'Finalizando carregamento...' }
                ];

                for (const step of steps) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    progress.style.width = `${step.progress}%`;
                    text.textContent = step.text;
                }
            }

            showApp() {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').classList.remove('opacity-0');
                document.getElementById('app').classList.add('opacity-100');
            }

            updateDataStatus() {
                const totalRecords = this.state.colhedorasData.length + 
                                   this.state.transbordosData.length + 
                                   this.state.caminhoesData.length + 
                                   this.state.moagemData.length;
                
                this.updateElement('totalRecords', totalRecords);
                this.updateElement('dataStatus', `${totalRecords} registros`);
            }

            // DATA PERSISTENCE
            async loadData() {
                try {
                    const savedData = localStorage.getItem('agroManagerData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        this.state.equipamentos = data.equipamentos || [];
                        this.state.colhedorasData = data.colhedorasData || [];
                        this.state.transbordosData = data.transbordosData || [];
                        this.state.caminhoesData = data.caminhoesData || [];
                        this.state.moagemData = data.moagemData || [];
                        this.state.lastSave = data.lastSave ? new Date(data.lastSave) : null;
                        
                        // Convert strings back to Date objects
                        this.state.equipamentos.forEach(eq => {
                            eq.createdAt = new Date(eq.createdAt);
                        });
                        
                        ['colhedorasData', 'transbordosData', 'caminhoesData', 'moagemData'].forEach(dataType => {
                            this.state[dataType].forEach(item => {
                                item.timestamp = new Date(item.timestamp);
                            });
                        });
                        
                        console.log('Dados carregados do localStorage:', {
                            equipamentos: this.state.equipamentos.length,
                            totalRegistros: this.state.colhedorasData.length + this.state.transbordosData.length + this.state.caminhoesData.length + this.state.moagemData.length,
                            lastSave: this.state.lastSave
                        });
                        
                        if (this.state.lastSave) {
                            this.showNotification(`Dados carregados (última atualização: ${this.state.lastSave.toLocaleDateString('pt-BR')})`, 'info', 3000);
                        }
                    } else {
                        this.loadSampleData();
                        this.saveData();
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    this.loadSampleData();
                    this.saveData();
                }
            }

            saveData() {
                try {
                    const dataToSave = {
                        equipamentos: this.state.equipamentos,
                        colhedorasData: this.state.colhedorasData,
                        transbordosData: this.state.transbordosData,
                        caminhoesData: this.state.caminhoesData,
                        moagemData: this.state.moagemData,
                        lastSave: new Date(),
                        version: this.state.version
                    };
                    
                    localStorage.setItem('agroManagerData', JSON.stringify(dataToSave));
                    this.state.lastSave = dataToSave.lastSave;
                    
                    this.showSaveStatus();
                    this.updateDataStatus();
                    
                    console.log('Dados salvos com sucesso:', {
                        equipamentos: this.state.equipamentos.length,
                        totalRegistros: this.state.colhedorasData.length + this.state.transbordosData.length + this.state.caminhoesData.length + this.state.moagemData.length,
                        timestamp: dataToSave.lastSave
                    });
                    
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    this.showNotification('Erro ao salvar dados', 'error');
                    return false;
                }
            }

            showSaveStatus() {
                const saveStatus = document.getElementById('saveStatus');
                if (saveStatus) {
                    saveStatus.classList.remove('opacity-0');
                    saveStatus.classList.add('opacity-100');
                    
                    setTimeout(() => {
                        saveStatus.classList.remove('opacity-100');
                        saveStatus.classList.add('opacity-0');
                    }, 3000);
                }
            }

            startAutoSave() {
                setInterval(() => {
                    if (this.state.settings.autoSave) {
                        this.saveData();
                    }
                }, 30000);

                window.addEventListener('beforeunload', () => {
                    this.saveData();
                });
            }

            addOperationalData(type, data) {
                const dataArray = type === 'colhedoras' ? this.state.colhedorasData :
                                type === 'transbordos' ? this.state.transbordosData :
                                type === 'caminhoes' ? this.state.caminhoesData :
                                this.state.moagemData;

                const newRecord = {
                    id: Date.now() + Math.random() * 1000,
                    ...data,
                    timestamp: data.timestamp || new Date()
                };

                dataArray.push(newRecord);
                this.saveData();
                this.updateDashboard();
                
                return newRecord;
            }

            loadSampleData() {
                this.state.equipamentos = [
                    {
                        id: 1,
                        tipo: 'colhedora',
                        nome: 'Colhedora Alpha',
                        marca: 'John Deere',
                        modelo: 'S770',
                        ano: 2023,
                        placa: 'AGR-2023',
                        status: 'Ativo',
                        localizacao: 'Talhão A1',
                        createdAt: new Date()
                    },
                    {
                        id: 2,
                        tipo: 'transbordo',
                        nome: 'Transbordo Beta',
                        marca: 'Stara',
                        modelo: 'Reboke 14000',
                        ano: 2022,
                        placa: 'TRS-2022',
                        status: 'Ativo',
                        localizacao: 'Talhão B2',
                        createdAt: new Date()
                    },
                    {
                        id: 3,
                        tipo: 'caminhao',
                        nome: 'Caminhão Gamma',
                        marca: 'Volvo',
                        modelo: 'FH 540',
                        ano: 2021,
                        placa: 'CAM-2021',
                        status: 'Ativo',
                        localizacao: 'Estrada Rural',
                        createdAt: new Date()
                    },
                    {
                        id: 4,
                        tipo: 'caminhao',
                        nome: 'Caminhão Delta',
                        marca: 'Mercedes',
                        modelo: 'Atego 2426',
                        ano: 2022,
                        placa: 'CAM-2022',
                        status: 'Ativo',
                        localizacao: 'Usina',
                        createdAt: new Date()
                    }
                ];

                this.generateSampleOperationalData();
                console.log('Dados de exemplo carregados');
            }

            generateSampleOperationalData() {
                const now = new Date();
                
                for (let week = 0; week < 8; week++) {
                    const weekStart = new Date(now);
                    weekStart.setDate(weekStart.getDate() - (week * 7));
                    const weekStartCalculated = this.getWeekStart(weekStart);
                    
                    for (let i = 0; i < 7; i++) {
                        const date = new Date(weekStartCalculated);
                        date.setDate(date.getDate() + i);
                        
                        // Colhedoras data
                        this.state.colhedorasData.push({
                            id: Date.now() + i + (week * 1000) + Math.random() * 1000,
                            tipo: 'producao',
                            equipamentoId: 1,
                            producao: Math.random() * 50 + 20 + (week < 4 ? 10 : 0),
                            timestamp: date
                        });

                        this.state.colhedorasData.push({
                            id: Date.now() + i + 100 + (week * 1000) + Math.random() * 1000,
                            tipo: 'horas',
                            equipamentoId: 1,
                            horasMotor: Math.random() * 8 + 4,
                            horasElevador: Math.random() * 8 + 4,
                            timestamp: date
                        });

                        this.state.colhedorasData.push({
                            id: Date.now() + i + 200 + (week * 1000) + Math.random() * 1000,
                            tipo: 'consumo',
                            equipamentoId: 1,
                            consumoCombustivel: Math.random() * 100 + 50,
                            consumoHidraulico: Math.random() * 5 + 2,
                            consumoLubrificantes: Math.random() * 3 + 1,
                            timestamp: date
                        });

                        // Transbordos data
                        this.state.transbordosData.push({
                            id: Date.now() + i + 300 + (week * 1000) + Math.random() * 1000,
                            tipo: 'operacao',
                            equipamentoId: 2,
                            producaoTrator: Math.random() * 30 + 15,
                            horas: Math.random() * 6 + 3,
                            viagens: Math.floor(Math.random() * 10) + 5,
                            distanciaPercorrida: Math.random() * 50 + 20,
                            timestamp: date
                        });

                        this.state.transbordosData.push({
                            id: Date.now() + i + 400 + (week * 1000) + Math.random() * 1000,
                            tipo: 'consumo',
                            equipamentoId: 2,
                            consumoDiesel: Math.random() * 80 + 40,
                            consumoHidraulico: Math.random() * 4 + 1,
                            timestamp: date
                        });

                        // Caminhões data
                        [3, 4].forEach(caminhaoId => {
                            this.state.caminhoesData.push({
                                id: Date.now() + i + (caminhaoId * 100) + (week * 1000) + Math.random() * 1000,
                                tipo: 'operacao',
                                equipamentoId: caminhaoId,
                                producao: Math.random() * 40 + 20,
                                horas: Math.random() * 10 + 5,
                                distancia: Math.random() * 200 + 100,
                                viagens: Math.floor(Math.random() * 3) + 1,
                                timestamp: date
                            });

                            this.state.caminhoesData.push({
                                id: Date.now() + i + (caminhaoId * 100) + 50 + (week * 1000) + Math.random() * 1000,
                                tipo: 'consumo',
                                equipamentoId: caminhaoId,
                                consumoCombustivel: Math.random() * 120 + 60,
                                timestamp: date
                            });
                        });

                        // Moagem data
                        const frentes = ['Frente 4001', 'Frente 4002', 'Frente 4007', 'Frente 40090', 'Frente 40090'];
                        if (Math.random() > 0.3) {
                            this.state.moagemData.push({
                                id: Date.now() + i + 700 + (week * 1000) + Math.random() * 1000,
                                frente: frentes[Math.floor(Math.random() * frentes.length)],
                                producao: Math.random() * 80 + 40,
                                meta: 50,
                                observacoes: this.getRandomObservation(),
                                timestamp: date
                            });
                        }
                    }
                }
            }

            getRandomObservation() {
                const observations = [
                    'Produção dentro da normalidade operacional',
                    'Pequeno atraso devido condições climáticas',
                    'Excelente produtividade alcançada',
                    'Manutenção preventiva realizada conforme cronograma',
                    'Ajuste fino de equipamentos executado',
                    'Condições ideais de trabalho e clima',
                    'Parada programada para reabastecimento completo',
                    'Performance acima da meta estabelecida'
                ];
                return observations[Math.floor(Math.random() * observations.length)];
            }

            // DASHBOARD UPDATE
            updateDashboard() {
                try {
                    this.updateColhedorasDashboard();
                    this.updateTransbordosDashboard();
                    this.updateCaminhoesDashboard();
                    this.updateEquipmentGrids();
                    this.updateMoagemSummary();
                    this.updateMoagemChart();
                    this.updateMoagemGrid();
                    this.updateTabCounts();
                    this.updateReports();
                    this.updateTrendAnalysis();
                    this.updateDataStatus();
                } catch (error) {
                    console.error('Erro ao atualizar dashboard:', error);
                }
            }

            updateTrendAnalysis() {
                const weekData = this.getWeekData();
                
                this.updateColhedorasMetrics(weekData);
                this.updateTransbordosMetrics(weekData);
                this.updateCaminhoesMetrics(weekData);
            }

            updateColhedorasMetrics(weekData) {
                let totalProducao = 0, totalHoras = 0, totalCombustivel = 0, totalHidraulico = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'producao') totalProducao += data.producao || 0;
                    if (data.tipo === 'horas') totalHoras += data.horasMotor || 0;
                    if (data.tipo === 'consumo') {
                        totalCombustivel += data.consumoCombustivel || 0;
                        totalHidraulico += data.consumoHidraulico || 0;
                    }
                });

                const produtividade = totalHoras > 0 ? (totalProducao / totalHoras) : 0;
                const consumoMedio = totalProducao > 0 ? (totalCombustivel / totalProducao) : 0;
                const eficienciaHoras = 89;

                this.updateElement('colhedorasProducaoTotal', totalProducao.toFixed(1) + 't');
                this.updateElement('colhedorasHorasTotal', totalHoras.toFixed(1) + 'h');
                this.updateElement('colhedorasCombustivel', totalCombustivel.toFixed(1) + 'L');
                this.updateElement('colhedorasProdutividade', produtividade.toFixed(1) + ' t/h');
                this.updateElement('colhedorasConsumoMedio', `Consumo médio: ${consumoMedio.toFixed(1)}L/t`);
                this.updateElement('colhedorasEficienciaHoras', `Eficiência operacional: ${eficienciaHoras}%`);
                this.updateElement('colhedorasMelhorPerf', 'Melhor: Colhedora Alpha');
                this.updateElement('colhedorasProducaoTrend', '+12% vs período anterior');
            }

            updateTransbordosMetrics(weekData) {
                let cargaTotal = 0, viagensTotal = 0, horasTotal = 0, distanciaTotal = 0, dieselTotal = 0, hidraulicoTotal = 0;
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'operacao') {
                        cargaTotal += data.producaoTrator || 0;
                        viagensTotal += data.viagens || 0;
                        horasTotal += data.horas || 0;
                        distanciaTotal += data.distanciaPercorrida || 0;
                    }
                    if (data.tipo === 'consumo') {
                        dieselTotal += data.consumoDiesel || 0;
                        hidraulicoTotal += data.consumoHidraulico || 0;
                    }
                });

                const eficienciaCarga = viagensTotal > 0 ? (cargaTotal / viagensTotal) : 0;
                const tempoMedio = viagensTotal > 0 ? ((horasTotal * 60) / viagensTotal) : 0;
                const consumoPorTonelada = cargaTotal > 0 ? (dieselTotal / cargaTotal) : 0;
                const disponibilidade = 94;

                this.updateElement('transbordosCargaTotal', cargaTotal.toFixed(1) + 't');
                this.updateElement('transbordosViagensTotal', viagensTotal);
                this.updateElement('transbordosDiesel', dieselTotal.toFixed(1) + 'L');
                this.updateElement('transbordosHidraulico', hidraulicoTotal.toFixed(1) + 'L');
                this.updateElement('transbordosEficienciaCarga', `Média: ${eficienciaCarga.toFixed(1)} t/viagem`);
                this.updateElement('transbordosTempoMedio', `Tempo médio: ${tempoMedio.toFixed(0)}min/ciclo`);
                this.updateElement('transbordosConsumoPorTonelada', `Eficiência: ${consumoPorTonelada.toFixed(1)} L/t`);
                this.updateElement('transbordosDisponibilidade', disponibilidade + '%');
                this.updateElement('transbordosParadas', 'Parada preventiva: 2h');
                this.updateElement('transbordosManutencao', 'Próxima manutenção: 15 dias');
            }

            updateCaminhoesMetrics(weekData) {
                let producaoTotal = 0, distanciaTotal = 0, horasTotal = 0, viagensTotal = 0, combustivelTotal = 0;
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'operacao') {
                        producaoTotal += data.producao || 0;
                        distanciaTotal += data.distancia || 0;
                        horasTotal += data.horas || 0;
                        viagensTotal += data.viagens || 0;
                    }
                    if (data.tipo === 'consumo') {
                        combustivelTotal += data.consumoCombustivel || 0;
                    }
                });

                const cargaMedia = viagensTotal > 0 ? (producaoTotal / viagensTotal) : 0;
                const distanciaMedia = viagensTotal > 0 ? (distanciaTotal / viagensTotal) : 0;
                const tempoViagem = viagensTotal > 0 ? (horasTotal / viagensTotal) : 0;
                const consumoKm = combustivelTotal > 0 && distanciaTotal > 0 ? (distanciaTotal / combustivelTotal) : 3.2;
                const eficiencia = distanciaTotal > 0 ? (producaoTotal / distanciaTotal) : 0;

                this.updateElement('caminhoesProducaoTotal', producaoTotal.toFixed(1) + 't');
                this.updateElement('caminhoesDistanciaTotal', distanciaTotal.toFixed(0) + 'km');
                this.updateElement('caminhoesViagensTotal', viagensTotal);
                this.updateElement('caminhoesCombustivelTotal', combustivelTotal.toFixed(1) + 'L');
                this.updateElement('caminhoesCargaMedia', `Carga média: ${cargaMedia.toFixed(1)}t por viagem`);
                this.updateElement('caminhoesDistanciaMedia', `Distância média: ${distanciaMedia.toFixed(0)}km/viagem`);
                this.updateElement('caminhoesTempoViagem', `Tempo médio: ${tempoViagem.toFixed(1)}h/viagem`);
                this.updateElement('caminhoesConsumoKm', `Eficiência: ${consumoKm.toFixed(1)}km/L`);
                this.updateElement('caminhoesEficiencia', eficiencia.toFixed(3) + ' t/km');
                this.updateElement('caminhoesMelhorEfic', 'Melhor: Volvo FH540');
            }

            updateCharts() {
                this.updateColhedorasCharts();
                this.updateTransbordosCharts();
                this.updateCaminhoesCharts();
            }

            updateColhedorasDashboard() {
                const weekData = this.getWeekData();
                this.updateColhedorasMetrics(weekData);
                this.updateColhedorasCharts(weekData);
            }

            updateColhedorasCharts(weekData) {
                this.updateColhedorasProducaoChart(weekData);
                this.updateColhedorasConsumoChart(weekData);
                this.updateColhedorasEficienciaChart(weekData);
            }

            updateColhedorasProducaoChart(weekData) {
                const ctx = document.getElementById('colhedorasProducaoChart');
                if (!ctx) return;

                if (this.state.charts.colhedorasProducao) {
                    this.state.charts.colhedorasProducao.destroy();
                }

                const dailyProduction = this.calculateColhedorasDailyProduction(weekData);
                const dailyTarget = [45, 45, 45, 45, 45, 35, 25];

                this.state.charts.colhedorasProducao = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Produção Real (t)',
                            data: dailyProduction,
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: '#22C55E',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }, {
                            label: 'Meta (t)',
                            data: dailyTarget,
                            type: 'line',
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderDash: [5, 5],
                            fill: false,
                            pointBackgroundColor: '#EF4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    color: '#6B7280'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#22C55E',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (toneladas)',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { color: 'rgba(34, 197, 94, 0.1)' },
                                ticks: { color: '#6B7280' }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Dias da Semana',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateColhedorasConsumoChart(weekData) {
                const ctx = document.getElementById('colhedorasConsumoChart');
                if (!ctx) return;

                if (this.state.charts.colhedorasConsumo) {
                    this.state.charts.colhedorasConsumo.destroy();
                }

                const consumoData = this.calculateColhedorasConsumo(weekData);

                this.state.charts.colhedorasConsumo = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Combustível', 'Óleo Hidráulico', 'Lubrificantes'],
                        datasets: [{
                            data: consumoData,
                            backgroundColor: [
                                '#F59E0B',
                                '#3B82F6',
                                '#8B5CF6'
                            ],
                            borderWidth: 3,
                            borderColor: '#ffffff',
                            cutout: '50%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    color: '#6B7280',
                                    font: { weight: '500' }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                cornerRadius: 8
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateColhedorasEficienciaChart(weekData) {
                const ctx = document.getElementById('colhedorasEficienciaChart');
                if (!ctx) return;

                if (this.state.charts.colhedorasEficiencia) {
                    this.state.charts.colhedorasEficiencia.destroy();
                }

                const eficienciaData = this.calculateColhedorasEficiencia(weekData);

                this.state.charts.colhedorasEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Produção (t)',
                            data: eficienciaData.producao,
                            backgroundColor: eficienciaData.producao.map((value, index) => {
                                const maxValue = Math.max(...eficienciaData.producao);
                                if (value === maxValue) return 'rgba(34, 197, 94, 0.9)';
                                if (value > maxValue * 0.8) return 'rgba(34, 197, 94, 0.7)';
                                return 'rgba(34, 197, 94, 0.5)';
                            }),
                            borderColor: '#22C55E',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }, {
                            label: 'Eficiência (%)',
                            data: eficienciaData.eficiencia,
                            type: 'line',
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    color: '#6B7280'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#22C55E',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: '#22C55E'
                                },
                                grid: { color: 'rgba(34, 197, 94, 0.1)' },
                                ticks: { color: '#22C55E' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)',
                                    color: '#3B82F6'
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: '#3B82F6' },
                                max: 100
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Equipamentos',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1200,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateTransbordosDashboard() {
                const weekData = this.getWeekData();
                this.updateTransbordosMetrics(weekData);
                this.updateTransbordosCharts(weekData);
            }

            updateTransbordosCharts(weekData) {
                this.updateTransbordosOperacoesChart(weekData);
                this.updateTransbordosEficienciaChart(weekData);
            }

            updateTransbordosOperacoesChart(weekData) {
                const ctx = document.getElementById('transbordosOperacoesChart');
                if (!ctx) return;

                if (this.state.charts.transbordosOperacoes) {
                    this.state.charts.transbordosOperacoes.destroy();
                }

                const dailyData = this.calculateTransbordosDailyData(weekData);

                this.state.charts.transbordosOperacoes = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Carga (t)',
                            data: dailyData.carga,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Viagens',
                            data: dailyData.viagens,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    color: '#6B7280'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#3B82F6',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Carga (t)',
                                    color: '#3B82F6'
                                },
                                grid: { color: 'rgba(59, 130, 246, 0.1)' },
                                ticks: { color: '#3B82F6' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Viagens',
                                    color: '#10B981'
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: '#10B981' }
                            },
                            x: {
                                grid: { color: 'rgba(156, 163, 175, 0.3)' },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateTransbordosEficienciaChart(weekData) {
                const ctx = document.getElementById('transbordosEficienciaChart');
                if (!ctx) return;

                if (this.state.charts.transbordosEficiencia) {
                    this.state.charts.transbordosEficiencia.destroy();
                }

                const eficienciaData = this.calculateTransbordosEficiencia(weekData);

                this.state.charts.transbordosEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Carga por Viagem (t)',
                            data: eficienciaData.eficiencia,
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgb(59, 130, 246)',
                                'rgb(34, 197, 94)',
                                'rgb(245, 158, 11)',
                                'rgb(239, 68, 68)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#3B82F6',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Carga por Viagem (t)',
                                    color: '#6B7280'
                                },
                                grid: { color: 'rgba(59, 130, 246, 0.1)' },
                                ticks: { 
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(1);
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Transbordos',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1200,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateCaminhoesDashboard() {
                const weekData = this.getWeekData();
                this.updateCaminhoesMetrics(weekData);
                this.updateCaminhoesCharts(weekData);
            }

            updateCaminhoesCharts(weekData) {
                this.updateCaminhoesProducaoChart(weekData);
                this.updateCaminhoesEficienciaChart(weekData);
            }

            updateCaminhoesProducaoChart(weekData) {
                const ctx = document.getElementById('caminhoesProducaoChart');
                if (!ctx) return;

                if (this.state.charts.caminhoesProducao) {
                    this.state.charts.caminhoesProducao.destroy();
                }

                const dailyData = this.calculateCaminhoesDailyData(weekData);

                this.state.charts.caminhoesProducao = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Produção (t)',
                            data: dailyData.producao,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#F59E0B',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Distância (km)',
                            data: dailyData.distancia,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    color: '#6B7280'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#F59E0B',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: '#F59E0B'
                                },
                                grid: { color: 'rgba(245, 158, 11, 0.1)' },
                                ticks: { color: '#F59E0B' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Distância (km)',
                                    color: '#3B82F6'
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: '#3B82F6' }
                            },
                            x: {
                                grid: { color: 'rgba(156, 163, 175, 0.3)' },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateCaminhoesEficienciaChart(weekData) {
                const ctx = document.getElementById('caminhoesEficienciaChart');
                if (!ctx) return;

                if (this.state.charts.caminhoesEficiencia) {
                    this.state.charts.caminhoesEficiencia.destroy();
                }

                const eficienciaData = this.calculateCaminhoesEficiencia(weekData);

                this.state.charts.caminhoesEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Eficiência (t/km)',
                            data: eficienciaData.eficiencia,
                            backgroundColor: [
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgb(245, 158, 11)',
                                'rgb(59, 130, 246)',
                                'rgb(34, 197, 94)',
                                'rgb(239, 68, 68)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#F59E0B',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Eficiência (t/km)',
                                    color: '#6B7280'
                                },
                                grid: { color: 'rgba(245, 158, 11, 0.1)' },
                                ticks: { 
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(3);
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Caminhões',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1200,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateMoagemSummary() {
                const weekData = this.getWeekData();
                
                let moagemTotalSemana = 0;
                let frentesAtivas = new Set();
                let diasComProducao = new Set();
                
                weekData.moagem.forEach(data => {
                    moagemTotalSemana += data.producao || 0;
                    frentesAtivas.add(data.frente);
                    diasComProducao.add(new Date(data.timestamp).toDateString());
                });

                const mediaDiaria = diasComProducao.size > 0 ? moagemTotalSemana / diasComProducao.size : 0;

                this.updateElement('moagemTotalSemana', moagemTotalSemana.toFixed(1) + 't');
                this.updateElement('frentesAtivas', frentesAtivas.size);
                this.updateElement('diasProducao', diasComProducao.size);
                this.updateElement('mediaDiaria', mediaDiaria.toFixed(1) + 't');

                this.updateMoagemChart();
                this.updateMoagemDiariaChart(weekData);
            }

            updateMoagemChart() {
                const ctx = document.getElementById('moagemFrentesChart');
                if (!ctx) return;

                if (this.state.charts.moagemFrentes) {
                    this.state.charts.moagemFrentes.destroy();
                }

                const weekData = this.getWeekData();
                const frentesData = this.getMoagemByFrente(weekData.moagem);

                this.state.charts.moagemFrentes = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(frentesData),
                        datasets: [{
                            label: 'Produção (t)',
                            data: Object.values(frentesData),
                            backgroundColor: [
                                'rgba(99, 102, 241, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)'
                            ],
                            borderColor: [
                                'rgb(99, 102, 241)',
                                'rgb(34, 197, 94)',
                                'rgb(245, 158, 11)',
                                'rgb(239, 68, 68)',
                                'rgb(139, 92, 246)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: '#6B7280'
                                },
                                grid: { color: 'rgba(156, 163, 175, 0.3)' },
                                ticks: { color: '#6B7280' }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Frentes',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        },
                        animation: {
                            duration: 1200,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateMoagemDiariaChart(weekData) {
                const ctx = document.getElementById('moagemDiariaChart');
                if (!ctx) return;

                if (this.state.charts.moagemDiaria) {
                    this.state.charts.moagemDiaria.destroy();
                }

                const dailyMoagem = this.calculateMoagemDiaria(weekData.moagem);
                const dailyTarget = [45, 45, 45, 45, 45, 35, 25];

                this.state.charts.moagemDiaria = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Moagem Realizada (t)',
                            data: dailyMoagem,
                            borderColor: '#6366F1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#6366F1',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Meta Diária (t)',
                            data: dailyTarget,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#EF4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: { 
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    color: '#6B7280'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#6366F1',
                                borderWidth: 1,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Moagem (toneladas)',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { 
                                    color: 'rgba(156, 163, 175, 0.3)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    color: '#6B7280',
                                    font: { weight: '500' }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Dias da Semana',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { 
                                    color: 'rgba(156, 163, 175, 0.3)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    color: '#6B7280',
                                    font: { weight: '500' }
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateMoagemGrid() {
                const tableBody = document.getElementById('moagemTableBody');
                const filtroFrente = document.getElementById('filtroFrente');
                
                if (!tableBody) return;

                if (filtroFrente) {
                    const frentes = [...new Set(this.state.moagemData.map(data => data.frente))];
                    filtroFrente.innerHTML = '<option value="">Todas as Frentes</option>';
                    frentes.forEach(frente => {
                        const option = document.createElement('option');
                        option.value = frente;
                        option.textContent = frente;
                        filtroFrente.appendChild(option);
                    });
                }

                const filtroValue = filtroFrente ? filtroFrente.value : '';
                const filteredData = this.state.moagemData.filter(data => 
                    !filtroValue || data.frente === filtroValue
                ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                tableBody.innerHTML = '';

                if (filteredData.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-industry text-4xl mb-4 opacity-50"></i>
                                <p>Nenhum registro de moagem encontrado</p>
                                <p class="text-sm">Clique em "Novo Registro" para adicionar dados de moagem</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                filteredData.forEach(data => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
                    
                    const meta = data.meta || 50;
                    const metaPercent = ((data.producao / meta) * 100).toFixed(1);
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            ${new Date(data.timestamp).toLocaleDateString('pt-BR')}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200">
                                ${data.frente}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                            ${data.producao.toFixed(1)}t
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <span class="text-sm font-medium ${metaPercent >= 100 ? 'text-green-600' : metaPercent >= 80 ? 'text-yellow-600' : 'text-red-600'}">${metaPercent}%</span>
                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full ${metaPercent >= 100 ? 'bg-green-600' : metaPercent >= 80 ? 'bg-yellow-600' : 'bg-red-600'}" style="width: ${Math.min(metaPercent, 100)}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate">
                            ${data.observacoes || '-'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="app.editMoagemData(${data.id})" class="text-green-600 hover:text-green-900 transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="app.deleteMoagemData(${data.id})" class="text-red-600 hover:text-red-900 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }

            updateEquipmentGrids() {
                this.updateColhedorasGrid();
                this.updateTransbordosGrid();
                this.updateCaminhoesGrid();
            }

            updateColhedorasGrid() {
                const grid = document.getElementById('colhedorasGrid');
                if (!grid) return;

                const colhedoras = this.state.equipamentos.filter(eq => eq.tipo === 'colhedora');
                grid.innerHTML = '';

                if (colhedoras.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('colhedora');
                    return;
                }

                colhedoras.forEach(colhedora => {
                    const weekData = this.getEquipmentWeekData(colhedora.id, 'colhedoras');
                    const card = this.createEquipmentCard(colhedora, weekData, 'colhedora');
                    grid.appendChild(card);
                });
            }

            updateTransbordosGrid() {
                const grid = document.getElementById('transbordosGrid');
                if (!grid) return;

                const transbordos = this.state.equipamentos.filter(eq => eq.tipo === 'transbordo');
                grid.innerHTML = '';

                if (transbordos.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('transbordo');
                    return;
                }

                transbordos.forEach(transbordo => {
                    const weekData = this.getEquipmentWeekData(transbordo.id, 'transbordos');
                    const card = this.createEquipmentCard(transbordo, weekData, 'transbordo');
                    grid.appendChild(card);
                });
            }

            updateCaminhoesGrid() {
                const grid = document.getElementById('caminhoesGrid');
                if (!grid) return;

                const caminhoes = this.state.equipamentos.filter(eq => eq.tipo === 'caminhao');
                grid.innerHTML = '';

                if (caminhoes.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('caminhao');
                    return;
                }

                caminhoes.forEach(caminhao => {
                    const weekData = this.getEquipmentWeekData(caminhao.id, 'caminhoes');
                    const card = this.createEquipmentCard(caminhao, weekData, 'caminhao');
                    grid.appendChild(card);
                });
            }

            createEquipmentCard(equipment, weekData, type) {
                const card = document.createElement('div');
                card.className = 'equipment-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all transform hover:scale-105';

                const stats = this.calculateEquipmentStatsFromWeekData(weekData, type);
                const statusColor = Math.random() > 0.8 ? 'red' : Math.random() > 0.5 ? 'yellow' : 'green';
                const statusText = statusColor === 'green' ? 'Operando' : statusColor === 'yellow' ? 'Manutenção' : 'Parado';

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center mr-3">
                                <i class="fas fa-${this.getEquipmentIcon(type)} text-xl text-primary"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 dark:text-white">${equipment.nome}</h4>
                                <p class="text-sm text-gray-500">${equipment.marca} ${equipment.modelo}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full bg-${statusColor}-100 text-${statusColor}-800 dark:bg-${statusColor}-900 dark:text-${statusColor}-200">
                            ${statusText}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-primary">${stats.production}</div>
                            <div class="text-xs text-gray-500">Produção (t)</div>
                        </div>
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-secondary">${stats.hours}</div>
                            <div class="text-xs text-gray-500">Horas</div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            ${equipment.localizacao || 'Não definido'}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="app.viewEquipmentDetails(${equipment.id})" class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="app.editEquipment(${equipment.id})" class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;

                return card;
            }

            updateEquipmentList() {
                const list = document.getElementById('equipmentList');
                if (!list) return;

                list.innerHTML = '';

                if (this.state.equipamentos.length === 0) {
                    list.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-plus-circle text-4xl mb-4 opacity-50"></i>
                            <p>Nenhum equipamento cadastrado</p>
                            <p class="text-sm">Use o formulário para adicionar equipamentos</p>
                        </div>
                    `;
                    return;
                }

                this.state.equipamentos.forEach(equipment => {
                    const item = document.createElement('div');
                    item.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors';
                    
                    item.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-${this.getEquipmentIcon(equipment.tipo)} text-primary"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900 dark:text-white">${equipment.nome}</div>
                                    <div class="text-sm text-gray-500">${equipment.marca} ${equipment.modelo}</div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="app.viewEquipmentDetails(${equipment.id})" class="text-blue-600 hover:text-blue-800 transition-colors">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="app.editEquipment(${equipment.id})" class="text-green-600 hover:text-green-800 transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="app.deleteEquipment(${equipment.id})" class="text-red-600 hover:text-red-800 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    list.appendChild(item);
                });
            }

            updateReports() {
                const weekData = this.getWeekData();
                
                let totalProducao = 0;
                let totalHoras = 0;
                let totalCombustivel = 0;
                
                [...weekData.colhedoras, ...weekData.transbordos, ...weekData.caminhoes].forEach(data => {
                    if (data.tipo === 'producao' || data.tipo === 'operacao') {
                        totalProducao += data.producao || data.producaoTrator || 0;
                    }
                    if (data.tipo === 'horas' || data.tipo === 'operacao') {
                        totalHoras += data.horasMotor || data.horas || 0;
                    }
                    if (data.tipo === 'consumo') {
                        totalCombustivel += data.consumoCombustivel || data.consumoDiesel || 0;
                    }
                });

                weekData.moagem.forEach(data => {
                    totalProducao += data.producao || 0;
                });

                const eficienciaMedia = totalHoras > 0 ? (totalProducao / totalHoras) * 100 / 10 : 0;

                this.updateElement('totalProducaoReport', totalProducao.toFixed(1) + 't');
                this.updateElement('totalHorasReport', totalHoras.toFixed(1) + 'h');
                this.updateElement('totalCombustivelReport', totalCombustivel.toFixed(1) + 'L');
                this.updateElement('eficienciaMediaReport', eficienciaMedia.toFixed(1) + '%');
            }

            updateTabCounts() {
                const colhedorasCount = this.state.equipamentos.filter(eq => eq.tipo === 'colhedora').length;
                const transbordosCount = this.state.equipamentos.filter(eq => eq.tipo === 'transbordo').length;
                const caminhoesCount = this.state.equipamentos.filter(eq => eq.tipo === 'caminhao').length;
                const moagemCount = this.state.moagemData.filter(data => {
                    const weekData = this.getWeekData();
                    return weekData.moagem.includes(data);
                }).length;

                this.updateElement('colhedorasCount', colhedorasCount);
                this.updateElement('transbordosCount', transbordosCount);
                this.updateElement('caminhoesCount', caminhoesCount);
                this.updateElement('moagemCount', moagemCount);
            }

            // Calculation methods
            calculateColhedorasDailyProduction(weekData) {
                const dailyProduction = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'producao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = (date.getDay() + 6) % 7;
                        dailyProduction[dayOfWeek] += data.producao || 0;
                    }
                });
                
                return dailyProduction;
            }

            calculateColhedorasConsumo(weekData) {
                let combustivel = 0;
                let hidraulico = 0;
                let lubrificantes = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'consumo') {
                        combustivel += data.consumoCombustivel || 0;
                        hidraulico += data.consumoHidraulico || 0;
                        lubrificantes += data.consumoLubrificantes || 0;
                    }
                });
                
                return [combustivel, hidraulico, lubrificantes];
            }

            calculateColhedorasEficiencia(weekData) {
                const equipamentos = this.state.equipamentos.filter(eq => eq.tipo === 'colhedora');
                const labels = equipamentos.map(eq => eq.nome);
                const producao = [];
                const eficiencia = [];

                equipamentos.forEach(eq => {
                    let totalProducao = 0;
                    let totalHoras = 0;

                    weekData.colhedoras.forEach(data => {
                        if (data.equipamentoId === eq.id) {
                            if (data.tipo === 'producao') totalProducao += data.producao || 0;
                            if (data.tipo === 'horas') totalHoras += data.horasMotor || 0;
                        }
                    });

                    producao.push(totalProducao);
                    eficiencia.push(totalHoras > 0 ? (totalProducao / totalHoras) * 10 : 0);
                });

                return { labels, producao, eficiencia };
            }

            calculateTransbordosDailyData(weekData) {
                const dailyCarga = [0, 0, 0, 0, 0, 0, 0];
                const dailyViagens = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'operacao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = (date.getDay() + 6) % 7;
                        dailyCarga[dayOfWeek] += data.producaoTrator || 0;
                        dailyViagens[dayOfWeek] += data.viagens || 0;
                    }
                });
                
                return { carga: dailyCarga, viagens: dailyViagens };
            }

            calculateTransbordosEficiencia(weekData) {
                const equipamentos = this.state.equipamentos.filter(eq => eq.tipo === 'transbordo');
                const labels = equipamentos.map(eq => eq.nome);
                const eficiencia = [];

                equipamentos.forEach(eq => {
                    let totalCarga = 0;
                    let totalViagens = 0;

                    weekData.transbordos.forEach(data => {
                        if (data.equipamentoId === eq.id && data.tipo === 'operacao') {
                            totalCarga += data.producaoTrator || 0;
                            totalViagens += data.viagens || 0;
                        }
                    });

                    const eficienciaValue = totalViagens > 0 ? totalCarga / totalViagens : 0;
                    eficiencia.push(eficienciaValue);
                });

                return { labels, eficiencia };
            }

            calculateCaminhoesDailyData(weekData) {
                const dailyProducao = [0, 0, 0, 0, 0, 0, 0];
                const dailyDistancia = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'operacao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = (date.getDay() + 6) % 7;
                        dailyProducao[dayOfWeek] += data.producao || 0;
                        dailyDistancia[dayOfWeek] += data.distancia || 0;
                    }
                });
                
                return { producao: dailyProducao, distancia: dailyDistancia };
            }

            calculateCaminhoesEficiencia(weekData) {
                const equipamentos = this.state.equipamentos.filter(eq => eq.tipo === 'caminhao');
                const labels = equipamentos.map(eq => eq.nome);
                const eficiencia = [];

                equipamentos.forEach(eq => {
                    let totalProducao = 0;
                    let totalDistancia = 0;

                    weekData.caminhoes.forEach(data => {
                        if (data.equipamentoId === eq.id && data.tipo === 'operacao') {
                            totalProducao += data.producao || 0;
                            totalDistancia += data.distancia || 0;
                        }
                    });

                    const eficienciaValue = totalDistancia > 0 ? totalProducao / totalDistancia : 0;
                    eficiencia.push(eficienciaValue);
                });

                return { labels, eficiencia };
            }

            calculateMoagemDiaria(moagemData) {
                const dailyMoagem = [0, 0, 0, 0, 0, 0, 0];
                
                moagemData.forEach(data => {
                    const date = new Date(data.timestamp);
                    const dayOfWeek = (date.getDay() + 6) % 7;
                    dailyMoagem[dayOfWeek] += data.producao || 0;
                });
                
                return dailyMoagem;
            }

            getMoagemByFrente(moagemData) {
                const frentesData = {};
                
                moagemData.forEach(data => {
                    const frente = data.frente || 'Sem frente';
                    if (!frentesData[frente]) {
                        frentesData[frente] = 0;
                    }
                    frentesData[frente] += data.producao || 0;
                });

                return frentesData;
            }

            calculateEquipmentStatsFromWeekData(weekData, type) {
                let production = 0;
                let hours = 0;

                weekData.forEach(data => {
                    if (type === 'colhedora') {
                        if (data.tipo === 'producao') production += data.producao || 0;
                        if (data.tipo === 'horas') hours += data.horasMotor || 0;
                    } else if (type === 'transbordo' || type === 'caminhao') {
                        if (data.tipo === 'operacao') {
                            production += data.producaoTrator || data.producao || 0;
                            hours += data.horas || 0;
                        }
                    }
                });

                return {
                    production: production.toFixed(1),
                    hours: hours.toFixed(1)
                };
            }

            getEmptyStateHTML(type) {
                const icons = {
                    colhedora: 'wheat-awn',
                    transbordo: 'truck',
                    caminhao: 'truck-moving'
                };

                const names = {
                    colhedora: 'colhedoras',
                    transbordo: 'transbordos',
                    caminhao: 'caminhões'
                };

                return `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-${icons[type]} text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Nenhuma ${names[type]} cadastrada</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-6">Comece cadastrando seus equipamentos para acompanhar a produção</p>
                        <button onclick="showTab('cadastro', document.querySelector('.tab-button'))" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i>Cadastrar ${type}
                        </button>
                    </div>
                `;
            }

            getWeekData() {
                const weekStart = this.state.currentWeekStart;
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);

                return {
                    colhedoras: this.state.colhedorasData.filter(data => {
                        const date = new Date(data.timestamp);
                        return date >= weekStart && date <= weekEnd;
                    }),
                    transbordos: this.state.transbordosData.filter(data => {
                        const date = new Date(data.timestamp);
                        return date >= weekStart && date <= weekEnd;
                    }),
                    caminhoes: this.state.caminhoesData.filter(data => {
                        const date = new Date(data.timestamp);
                        return date >= weekStart && date <= weekEnd;
                    }),
                    moagem: this.state.moagemData.filter(data => {
                        const date = new Date(data.timestamp);
                        return date >= weekStart && date <= weekEnd;
                    })
                };
            }

            getEquipmentWeekData(equipmentId, dataType) {
                const weekStart = this.state.currentWeekStart;
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);

                const dataArray = dataType === 'colhedoras' ? this.state.colhedorasData :
                                dataType === 'transbordos' ? this.state.transbordosData :
                                this.state.caminhoesData;

                return dataArray.filter(data => {
                    const date = new Date(data.timestamp);
                    return data.equipamentoId == equipmentId && date >= weekStart && date <= weekEnd;
                });
            }

            getEquipmentIcon(tipo) {
                switch (tipo) {
                    case 'colhedora': return 'wheat-awn';
                    case 'transbordo': return 'truck';
                    case 'caminhao': return 'truck-moving';
                    default: return 'tractor';
                }
            }

            updateElement(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }

            setupEventListeners() {
                document.getElementById('equipmentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addEquipment();
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case 'n':
                                e.preventDefault();
                                this.openQuickAdd();
                                break;
                            case 'r':
                                e.preventDefault();
                                this.refreshDashboard();
                                break;
                            case 's':
                                e.preventDefault();
                                this.saveData();
                                this.showNotification('Dados salvos manualmente!', 'success', 2000);
                                break;
                        }
                    }
                });
            }

            getWeekStart(date) {
                const dayOfWeek = date.getDay();
                const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() + mondayOffset);
                weekStart.setHours(0, 0, 0, 0);
                return weekStart;
            }

            setCurrentWeek() {
                const today = new Date();
                this.state.currentWeekStart = this.getWeekStart(today);
                this.updateWeekDisplay();
                this.updateCurrentDateTime();
            }

            updateWeekDisplay() {
                const weekEnd = new Date(this.state.currentWeekStart);
                weekEnd.setDate(this.state.currentWeekStart.getDate() + 6);
                
                const weekNum = this.getWeekNumber(this.state.currentWeekStart);
                const year = this.state.currentWeekStart.getFullYear();
                
                const startStr = this.state.currentWeekStart.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: '2-digit' 
                });
                const endStr = weekEnd.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: '2-digit' 
                });
                
                document.getElementById('currentWeek').textContent = 
                    `Semana ${weekNum}/${year} (${startStr} - ${endStr})`;
                    
                // Update week progress
                const today = new Date();
                if (today >= this.state.currentWeekStart && today <= weekEnd) {
                    const daysPassed = Math.floor((today - this.state.currentWeekStart) / (24 * 60 * 60 * 1000)) + 1;
                    document.getElementById('weekProgress').textContent = `${daysPassed} de 7 dias`;
                } else {
                    document.getElementById('weekProgress').textContent = '7 de 7 dias';
                }
            }

            updateCurrentDateTime() {
                const now = new Date();
                const dateOptions = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                const timeOptions = {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                
                document.getElementById('currentDate').textContent = 
                    now.toLocaleDateString('pt-BR', dateOptions);
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('pt-BR', timeOptions);
            }

            getWeekNumber(date) {
                const start = new Date(date.getFullYear(), 0, 1);
                const days = Math.floor((date - start) / (24 * 60 * 60 * 1000));
                return Math.ceil((days + start.getDay() + 1) / 7);
            }

            setupTheme() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.state.settings.theme = 'dark';
                } else {
                    this.state.settings.theme = 'light';
                }
                this.applyTheme(this.state.settings.theme);
            }

            applyTheme(theme) {
                const html = document.documentElement;
                const themeIcon = document.getElementById('themeIcon');
                
                if (theme === 'dark') {
                    html.classList.add('dark');
                    themeIcon.className = 'fas fa-sun text-lg';
                } else {
                    html.classList.remove('dark');
                    themeIcon.className = 'fas fa-moon text-lg';
                }
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.updateCurrentDateTime();
                }, 1000);

                setInterval(() => {
                    this.updateDashboard();
                }, this.state.settings.refreshInterval);
            }

            showNotification(message, type = 'info', duration = 5000) {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                };

                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };

                notification.className = `notification ${colors[type]} text-white px-6 py-4 rounded-lg shadow-2xl min-w-80 max-w-96 transform translate-x-full`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-${icons[type]} mr-3 text-lg"></i>
                        <span class="flex-1 font-medium">${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                container.appendChild(notification);

                // Trigger animation
                setTimeout(() => {
                    notification.classList.add('show');
                    notification.classList.remove('translate-x-full');
                }, 100);

                // Auto remove
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 400);
                }, duration);
            }

            addEquipment() {
                try {
                    const tipo = document.getElementById('tipoEquipamento').value;
                    const nome = document.getElementById('nomeEquipamento').value.trim();
                    const marca = document.getElementById('marcaEquipamento').value.trim();
                    const modelo = document.getElementById('modeloEquipamento').value.trim();
                    const ano = document.getElementById('anoEquipamento').value;
                    const placa = document.getElementById('placaEquipamento').value.trim();

                    if (!nome || !marca || !modelo) {
                        this.showNotification('Por favor, preencha todos os campos obrigatórios.', 'error');
                        return;
                    }

                    if (this.state.equipamentos.some(eq => eq.nome.toLowerCase() === nome.toLowerCase())) {
                        this.showNotification('Já existe um equipamento com este nome.', 'error');
                        return;
                    }

                    const equipment = {
                        id: Date.now(),
                        tipo,
                        nome,
                        marca,
                        modelo,
                        ano: ano || null,
                        placa: placa || null,
                        status: 'Ativo',
                        localizacao: 'A definir',
                        createdAt: new Date()
                    };

                    this.state.equipamentos.push(equipment);
                    this.saveData();
                    this.updateDashboard();
                    this.updateEquipmentList();
                    this.updateTabCounts();
                    
                    document.getElementById('equipmentForm').reset();
                    this.showNotification(`${nome} cadastrado com sucesso!`, 'success');
                } catch (error) {
                    console.error('Erro ao adicionar equipamento:', error);
                    this.showNotification('Erro ao cadastrar equipamento. Tente novamente.', 'error');
                }
            }

            // Modal and equipment management functions
            openQuickAdd() {
                toggleQuickActionMenu();
            }

            refreshDashboard() {
                this.updateDashboard();
                this.showNotification('Dashboard atualizado com sucesso!', 'success', 2000);
            }

            viewEquipmentDetails(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (equipment) {
                    this.showNotification(`Visualizando detalhes de ${equipment.nome}`, 'info');
                }
            }

            editEquipment(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (equipment) {
                    this.showNotification(`Editando ${equipment.nome}`, 'info');
                }
            }

            deleteEquipment(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (!equipment) return;

                if (confirm(`⚠️ CONFIRMAÇÃO DE EXCLUSÃO\n\nTem certeza que deseja excluir ${equipment.nome}?\n\n• Esta ação não pode ser desfeita\n• Todos os dados relacionados serão perdidos\n\nDigite "EXCLUIR" para confirmar:`)) {
                    const confirmText = prompt('Digite "EXCLUIR" para confirmar a exclusão:');
                    if (confirmText === 'EXCLUIR') {
                        this.state.equipamentos = this.state.equipamentos.filter(eq => eq.id !== id);
                        this.saveData();
                        this.updateDashboard();
                        this.updateEquipmentList();
                        this.updateTabCounts();
                        this.showNotification(`${equipment.nome} excluído com sucesso.`, 'success');
                    } else {
                        this.showNotification('Exclusão cancelada', 'info');
                    }
                }
            }

            editMoagemData(id) {
                const record = this.state.moagemData.find(data => data.id === id);
                if (record) {
                    this.showNotification(`Editando registro de ${record.frente}`, 'info');
                }
            }

            deleteMoagemData(id) {
                const record = this.state.moagemData.find(data => data.id === id);
                if (!record) return;

                if (confirm(`⚠️ CONFIRMAÇÃO DE EXCLUSÃO\n\nTem certeza que deseja excluir o registro de ${record.frente}?\n\n• Esta ação não pode ser desfeita\n• Os dados serão removidos permanentemente\n\nClique OK para confirmar:`)) {
                    this.state.moagemData = this.state.moagemData.filter(data => data.id !== id);
                    this.saveData();
                    this.updateMoagemGrid();
                    this.updateMoagemSummary();
                    this.updateMoagemChart();
                    this.updateDashboard();
                    this.showNotification('Registro excluído com sucesso.', 'success');
                }
            }
        }

        // Global functions for backward compatibility
        let app;

        function manualSave() {
            if (app) {
                const success = app.saveData();
                if (success) {
                    app.showNotification('Dados salvos manualmente com sucesso! 💾', 'success', 2000);
                }
            }
        }

        function toggleTheme() {
            const currentTheme = app.state.settings.theme;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            app.state.settings.theme = newTheme;
            app.applyTheme(newTheme);
            app.saveData();
        }

        function showTab(tabName, buttonElement) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            setTimeout(() => app.updateDashboard(), 100);
        }

        function previousWeek() {
            app.state.currentWeekStart.setDate(app.state.currentWeekStart.getDate() - 7);
            app.updateWeekDisplay();
            app.updateDashboard();
        }

        function nextWeek() {
            app.state.currentWeekStart.setDate(app.state.currentWeekStart.getDate() + 7);
            app.updateWeekDisplay();
            app.updateDashboard();
        }

        function goToCurrentWeek() {
            app.setCurrentWeek();
            app.updateDashboard();
        }

        function refreshDashboard() {
            app.refreshDashboard();
        }

        function toggleQuickActionMenu() {
            const menu = document.getElementById('quickActionMenu');
            const icon = document.getElementById('fabIcon');
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                setTimeout(() => {
                    menu.classList.remove('scale-95', 'opacity-0');
                    menu.classList.add('scale-100', 'opacity-100');
                }, 10);
                icon.className = 'fas fa-times text-xl relative z-10';
            } else {
                menu.classList.remove('scale-100', 'opacity-100');
                menu.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    menu.classList.add('hidden');
                }, 300);
                icon.className = 'fas fa-plus text-xl relative z-10';
            }
        }

        function closeQuickActionMenu() {
            const menu = document.getElementById('quickActionMenu');
            const icon = document.getElementById('fabIcon');
            
            menu.classList.remove('scale-100', 'opacity-100');
            menu.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                menu.classList.add('hidden');
            }, 300);
            icon.className = 'fas fa-plus text-xl relative z-10';
        }

        function openQuickAdd() {
            toggleQuickActionMenu();
        }

        // MODAL FUNCTIONS CORRIGIDAS - AGORA COM ÓLEO HIDRÁULICO
        function openColhedoraModal() {
            showModal('Registro de Colhedora', `
                <form id="colhedoraForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                            <select id="colhedoraEquipamento" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Selecione uma colhedora</option>
                                ${app.state.equipamentos.filter(eq => eq.tipo === 'colhedora').map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data *</label>
                            <input type="date" id="colhedoraData" required value="${new Date().toISOString().split('T')[0]}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-wheat-awn mr-2 text-green-600"></i>Dados de Produção
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Produção (t) *</label>
                                <input type="number" id="colhedoraProducao" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas Motor *</label>
                                <input type="number" id="colhedoraHoras" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-oil-can mr-2 text-blue-600"></i>Consumo de Fluidos
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-gas-pump mr-1 text-red-500"></i>Combustível (L)
                                </label>
                                <input type="number" id="colhedoraCombustivel" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-oil-can mr-1 text-blue-500"></i>Óleo Hidráulico (L)
                                </label>
                                <input type="number" id="colhedoraHidraulico" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-cog mr-1 text-purple-500"></i>Lubrificantes (L)
                                </label>
                                <input type="number" id="colhedoraLubrificantes" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary"><i class="fas fa-save mr-2"></i>Salvar</button>
                    </div>
                </form>
            `);

            document.getElementById('colhedoraForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const equipamentoId = parseInt(document.getElementById('colhedoraEquipamento').value);
                const data = document.getElementById('colhedoraData').value;
                const producao = parseFloat(document.getElementById('colhedoraProducao').value);
                const horas = parseFloat(document.getElementById('colhedoraHoras').value);
                const combustivel = parseFloat(document.getElementById('colhedoraCombustivel').value) || 0;
                const hidraulico = parseFloat(document.getElementById('colhedoraHidraulico').value) || 0;
                const lubrificantes = parseFloat(document.getElementById('colhedoraLubrificantes').value) || 0;

                // Add production data
                app.addOperationalData('colhedoras', {
                    tipo: 'producao',
                    equipamentoId,
                    producao,
                    timestamp: new Date(data)
                });

                // Add hours data
                app.addOperationalData('colhedoras', {
                    tipo: 'horas',
                    equipamentoId,
                    horasMotor: horas,
                    timestamp: new Date(data)
                });

                // Add consumption data if any fluid was entered
                if (combustivel > 0 || hidraulico > 0 || lubrificantes > 0) {
                    app.addOperationalData('colhedoras', {
                        tipo: 'consumo',
                        equipamentoId,
                        consumoCombustivel: combustivel,
                        consumoHidraulico: hidraulico,
                        consumoLubrificantes: lubrificantes,
                        timestamp: new Date(data)
                    });
                }

                closeModal();
                app.showNotification('Registro de colhedora salvo com sucesso!', 'success');
            });
        }

        function openTransbordoModal() {
            showModal('Registro de Transbordo', `
                <form id="transbordoForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                            <select id="transbordoEquipamento" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Selecione um transbordo</option>
                                ${app.state.equipamentos.filter(eq => eq.tipo === 'transbordo').map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data *</label>
                            <input type="date" id="transbordoData" required value="${new Date().toISOString().split('T')[0]}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-truck mr-2 text-blue-600"></i>Dados Operacionais
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Carga (t) *</label>
                                <input type="number" id="transbordoCarga" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas *</label>
                                <input type="number" id="transbordoHoras" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Viagens *</label>
                                <input type="number" id="transbordoViagens" min="1" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Distância (km)</label>
                                <input type="number" id="transbordoDistancia" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-oil-can mr-2 text-purple-600"></i>Consumo de Fluidos
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-gas-pump mr-1 text-purple-500"></i>Diesel (L)
                                </label>
                                <input type="number" id="transbordoDiesel" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-oil-can mr-1 text-orange-500"></i>Óleo Hidráulico (L)
                                </label>
                                <input type="number" id="transbordoHidraulico" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary"><i class="fas fa-save mr-2"></i>Salvar</button>
                    </div>
                </form>
            `);

            document.getElementById('transbordoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const equipamentoId = parseInt(document.getElementById('transbordoEquipamento').value);
                const data = document.getElementById('transbordoData').value;
                const carga = parseFloat(document.getElementById('transbordoCarga').value);
                const horas = parseFloat(document.getElementById('transbordoHoras').value);
                const viagens = parseInt(document.getElementById('transbordoViagens').value);
                const distancia = parseFloat(document.getElementById('transbordoDistancia').value) || (viagens * 15);
                const diesel = parseFloat(document.getElementById('transbordoDiesel').value) || 0;
                const hidraulico = parseFloat(document.getElementById('transbordoHidraulico').value) || 0;

                // Add operation data
                app.addOperationalData('transbordos', {
                    tipo: 'operacao',
                    equipamentoId,
                    producaoTrator: carga,
                    horas,
                    viagens,
                    distanciaPercorrida: distancia,
                    timestamp: new Date(data)
                });

                // Add consumption data if any fluid was entered
                if (diesel > 0 || hidraulico > 0) {
                    app.addOperationalData('transbordos', {
                        tipo: 'consumo',
                        equipamentoId,
                        consumoDiesel: diesel,
                        consumoHidraulico: hidraulico,
                        timestamp: new Date(data)
                    });
                }

                closeModal();
                app.showNotification('Registro de transbordo salvo com sucesso!', 'success');
            });
        }

        function openCaminhaoModal() {
            showModal('Registro de Caminhão', `
                <form id="caminhaoForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                            <select id="caminhaoEquipamento" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Selecione um caminhão</option>
                                ${app.state.equipamentos.filter(eq => eq.tipo === 'caminhao').map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data *</label>
                            <input type="date" id="caminhaoData" required value="${new Date().toISOString().split('T')[0]}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-truck-moving mr-2 text-amber-600"></i>Dados Operacionais
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Carga (t) *</label>
                                <input type="number" id="caminhaoProducao" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas *</label>
                                <input type="number" id="caminhaoHoras" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Distância (km) *</label>
                                <input type="number" id="caminhaoDistancia" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Viagens</label>
                                <input type="number" id="caminhaoViagens" min="1" value="1" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-gas-pump mr-2 text-red-600"></i>Consumo de Combustível
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-gas-pump mr-1 text-red-500"></i>Combustível (L)
                                </label>
                                <input type="number" id="caminhaoConsumo" step="0.1" min="0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary"><i class="fas fa-save mr-2"></i>Salvar</button>
                    </div>
                </form>
            `);

            document.getElementById('caminhaoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const equipamentoId = parseInt(document.getElementById('caminhaoEquipamento').value);
                const data = document.getElementById('caminhaoData').value;
                const producao = parseFloat(document.getElementById('caminhaoProducao').value);
                const horas = parseFloat(document.getElementById('caminhaoHoras').value);
                const distancia = parseFloat(document.getElementById('caminhaoDistancia').value);
                const viagens = parseInt(document.getElementById('caminhaoViagens').value) || 1;
                const consumo = parseFloat(document.getElementById('caminhaoConsumo').value) || 0;

                // Add operation data
                app.addOperationalData('caminhoes', {
                    tipo: 'operacao',
                    equipamentoId,
                    producao,
                    horas,
                    distancia,
                    viagens,
                    timestamp: new Date(data)
                });

                // Add fuel consumption data if entered
                if (consumo > 0) {
                    app.addOperationalData('caminhoes', {
                        tipo: 'consumo',
                        equipamentoId,
                        consumoCombustivel: consumo,
                        timestamp: new Date(data)
                    });
                }

                closeModal();
                app.showNotification('Registro de caminhão salvo com sucesso!', 'success');
            });
        }

        function openMoagemModal() {
            const frentes = ['Frente 4001', 'Frente 4002', 'Frente 4007', 'Frente 4009', 'Frente 4010'];
            
            showModal('Registro de Moagem', `
                <form id="moagemForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frente *</label>
                            <select id="moagemFrente" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Selecione a frente</option>
                                ${frentes.map(frente => `<option value="${frente}">${frente}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data *</label>
                            <input type="date" id="moagemData" required value="${new Date().toISOString().split('T')[0]}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Produção (t) *</label>
                            <input type="number" id="moagemProducao" step="0.1" min="0" required class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Meta (t)</label>
                            <input type="number" id="moagemMeta" step="0.1" min="0" value="50" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                        <textarea id="moagemObservacoes" rows="3" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" placeholder="Observações sobre a produção..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary"><i class="fas fa-save mr-2"></i>Salvar</button>
                    </div>
                </form>
            `);

            document.getElementById('moagemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const frente = document.getElementById('moagemFrente').value;
                const data = document.getElementById('moagemData').value;
                const producao = parseFloat(document.getElementById('moagemProducao').value);
                const meta = parseFloat(document.getElementById('moagemMeta').value) || 50;
                const observacoes = document.getElementById('moagemObservacoes').value;

                app.addOperationalData('moagem', {
                    frente,
                    producao,
                    meta,
                    observacoes,
                    timestamp: new Date(data)
                });

                closeModal();
                app.showNotification('Registro de moagem salvo com sucesso!', 'success');
            });
        }

        function showModal(title, content) {
            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-plus mr-3 text-primary"></i>${title}
                        </h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    ${content}
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('modalOverlay').classList.remove('hidden');
            document.getElementById('modalOverlay').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            document.getElementById('modalOverlay').classList.remove('flex');
        }

        // EXPORT FUNCTIONS
        function exportColhedorasData() {
            const data = app.state.colhedorasData;
            exportToCSV(data, 'colhedoras_data.csv');
            app.showNotification('Dados de colhedoras exportados com sucesso!', 'success');
        }

        function exportTransbordosData() {
            const data = app.state.transbordosData;
            exportToCSV(data, 'transbordos_data.csv');
            app.showNotification('Dados de transbordos exportados com sucesso!', 'success');
        }

        function exportCaminhoesData() {
            const data = app.state.caminhoesData;
            exportToCSV(data, 'caminhoes_data.csv');
            app.showNotification('Dados de caminhões exportados com sucesso!', 'success');
        }

        function exportMoagemData() {
            const data = app.state.moagemData;
            exportToCSV(data, 'moagem_data.csv');
            app.showNotification('Dados de moagem exportados com sucesso!', 'success');
        }

        function exportEquipmentList() {
            const data = app.state.equipamentos;
            exportToCSV(data, 'equipamentos.csv');
            app.showNotification('Lista de equipamentos exportada com sucesso!', 'success');
        }

        function exportToCSV(data, filename) {
            if (data.length === 0) {
                app.showNotification('Nenhum dado disponível para exportar', 'warning');
                return;
            }

            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header];
                        if (value instanceof Date) {
                            return `"${value.toLocaleString('pt-BR')}"`;
                        }
                        return `"${value || ''}"`;
                    }).join(',')
                )
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // REPORT FUNCTIONS
        function generateReport() {
            app.showNotification('Relatório gerado com sucesso!', 'success');
            app.updateReports();
        }

        function openProductionReport() {
            showModal('Relatório Detalhado de Produção', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 dark:text-green-200">Total Produzido</h4>
                            <p class="text-2xl font-bold text-green-600">${app.state.colhedorasData.reduce((sum, d) => d.tipo === 'producao' ? sum + (d.producao || 0) : sum, 0).toFixed(1)}t</p>
                            <p class="text-xs text-green-600 mt-1">Todas as operações</p>
                        </div>
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 dark:text-blue-200">Horas Trabalhadas</h4>
                            <p class="text-2xl font-bold text-blue-600">${app.state.colhedorasData.reduce((sum, d) => d.tipo === 'horas' ? sum + (d.horasMotor || 0) : sum, 0).toFixed(1)}h</p>
                            <p class="text-xs text-blue-600 mt-1">Tempo produtivo</p>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                            <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Produtividade Média</h4>
                            <p class="text-2xl font-bold text-yellow-600">12.5 t/h</p>
                            <p class="text-xs text-yellow-600 mt-1">Performance geral</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="exportToCSV(app.state.colhedorasData, 'relatorio_producao_completo.csv')" class="btn-primary">
                            <i class="fas fa-download mr-2"></i>Exportar Relatório Completo
                        </button>
                    </div>
                </div>
            `);
        }

        function openEfficiencyReport() {
            showModal('Relatório de Eficiência Operacional', `
                <div class="space-y-6">
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg">
                        <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-4">Análise Detalhada de Eficiência</h4>
                        <ul class="space-y-2 text-blue-700 dark:text-blue-300">
                            <li>• Colhedoras: Eficiência operacional média de 89%</li>
                            <li>• Transbordos: 94% de disponibilidade total</li>
                            <li>• Caminhões: 3.2km/L de consumo médio</li>
                            <li>• Moagem: 96% de eficiência nas frentes</li>
                            <li>• Performance geral: Acima das expectativas</li>
                        </ul>
                    </div>
                    <div class="text-center">
                        <button onclick="closeModal()" class="btn-primary">
                            <i class="fas fa-check mr-2"></i>Fechar Relatório
                        </button>
                    </div>
                </div>
            `);
        }

        function openCostReport() {
            showModal('Relatório Detalhado de Custos', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                            <h4 class="font-bold text-red-800 dark:text-red-200">Combustível Total</h4>
                            <p class="text-2xl font-bold text-red-600">${app.state.colhedorasData.reduce((sum, d) => d.tipo === 'consumo' ? sum + (d.consumoCombustivel || 0) : sum, 0).toFixed(1)}L</p>
                            <p class="text-sm text-red-600">Estimativa: R$ ${(app.state.colhedorasData.reduce((sum, d) => d.tipo === 'consumo' ? sum + (d.consumoCombustivel || 0) : sum, 0) * 5.5).toFixed(2)}</p>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                            <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Manutenção</h4>
                            <p class="text-2xl font-bold text-yellow-600">R$ 15.240</p>
                            <p class="text-sm text-yellow-600">Período atual</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="closeModal()" class="btn-primary">
                            <i class="fas fa-check mr-2"></i>Fechar Relatório
                        </button>
                    </div>
                </div>
            `);
        }

        function expandChart(chartId) {
            app.showNotification('Funcionalidade de expansão de gráfico em desenvolvimento', 'info');
        }

        function refreshEquipmentList() {
            app.updateEquipmentList();
            app.showNotification('Lista de equipamentos atualizada!', 'success', 2000);
        }

        // SETTINGS FUNCTIONS CORRIGIDAS
        function openSettings() {
            showModal('Configurações do Sistema', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-gray-900 dark:text-white mb-4">Preferências</h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Tema escuro</span>
                                    <button onclick="toggleTheme()" class="btn-secondary">
                                        <i class="fas fa-adjust mr-2"></i>Alternar
                                    </button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Auto-salvamento</span>
                                    <span class="text-green-600 font-medium">
                                        <i class="fas fa-check-circle mr-1"></i>Ativo
                                    </span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Última atualização</span>
                                    <span class="text-gray-500 text-sm">${new Date().toLocaleDateString('pt-BR')}</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-900 dark:text-white mb-4">Gerenciar Dados</h4>
                            <div class="space-y-4">
                                <button onclick="createBackup()" class="btn-primary w-full">
                                    <i class="fas fa-download mr-2"></i>Criar Backup Completo
                                </button>
                                <button onclick="clearAllData()" class="btn-danger w-full">
                                    <i class="fas fa-trash mr-2"></i>Limpar Todos os Dados
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="text-center pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-sm text-gray-500">AgroManager Pro v${app.state.version}</p>
                        <p class="text-xs text-gray-400">Sistema de Gestão Agrícola Avançado</p>
                    </div>
                </div>
            `);
        }

        function createBackup() {
            const data = {
                equipamentos: app.state.equipamentos,
                colhedorasData: app.state.colhedorasData,
                transbordosData: app.state.transbordosData,
                caminhoesData: app.state.caminhoesData,
                moagemData: app.state.moagemData,
                version: app.state.version,
                timestamp: new Date().toISOString(),
                totalRecords: app.state.colhedorasData.length + app.state.transbordosData.length + app.state.caminhoesData.length + app.state.moagemData.length
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            const date = new Date().toISOString().split('T')[0];
            const time = new Date().toTimeString().split(' ')[0].replace(/:/g, '-');
            link.download = `AgroManager_Backup_${date}_${time}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            app.showNotification('Backup criado com sucesso! 📄', 'success');
        }

        function clearAllData() {
            if (!confirm('⚠️ ATENÇÃO - EXCLUSÃO DE DADOS\n\nEsta ação irá remover TODOS os dados do sistema!\n\nISSO INCLUI:\n• Todos os equipamentos cadastrados\n• Todos os registros operacionais\n• Todos os dados de produção\n• Configurações personalizadas\n\nEsta ação é IRREVERSÍVEL!\n\nDeseja continuar?')) {
                return;
            }

            const confirmationText = prompt('⚠️ CONFIRMAÇÃO FINAL\n\nPara confirmar a exclusão de TODOS os dados, digite exatamente:\nLIMPAR DADOS\n\n(Digite em maiúsculas):');
            
            if (confirmationText === 'LIMPAR DADOS') {
                try {
                    // Clear ALL localStorage data
                    localStorage.clear();
                    
                    // Also remove specific keys just to be sure
                    localStorage.removeItem('agroManagerData');
                    
                    // Clear application state
                    if (app) {
                        app.state.equipamentos = [];
                        app.state.colhedorasData = [];
                        app.state.transbordosData = [];
                        app.state.caminhoesData = [];
                        app.state.moagemData = [];
                    }
                    
                    // Show success message
                    alert('✅ DADOS LIMPOS COM SUCESSO!\n\nTodos os dados foram removidos do sistema.\nA página será recarregada agora.');
                    
                    // Force a hard reload to clear cache
                    window.location.href = window.location.href + '?nocache=' + Date.now();
                    
                } catch (error) {
                    console.error('Erro ao limpar dados:', error);
                    alert('❌ ERRO AO LIMPAR DADOS\n\nOcorreu um erro durante a limpeza.\nTente novamente ou recarregue a página manualmente.');
                }
            } else {
                app.showNotification('Exclusão cancelada - Texto de confirmação incorreto', 'info');
            }
        }

        function openNotifications() {
            showModal('Central de Notificações do Sistema', `
                <div class="space-y-4">
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                            <div>
                                <p class="font-medium text-blue-800 dark:text-blue-200">Sistema funcionando normalmente</p>
                                <p class="text-sm text-blue-600 dark:text-blue-400">Todos os equipamentos online e operacionais</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-3"></i>
                            <div>
                                <p class="font-medium text-green-800 dark:text-green-200">Backup automático realizado</p>
                                <p class="text-sm text-green-600 dark:text-green-400">Dados salvos com sucesso às ${new Date().toLocaleTimeString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                            <div>
                                <p class="font-medium text-yellow-800 dark:text-yellow-200">Manutenção preventiva agendada</p>
                                <p class="text-sm text-yellow-600 dark:text-yellow-400">Colhedora Alpha - 15/01/2024</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-chart-line text-indigo-600 mr-3"></i>
                            <div>
                                <p class="font-medium text-indigo-800 dark:text-indigo-200">Performance acima da média</p>
                                <p class="text-sm text-indigo-600 dark:text-indigo-400">Produtividade 12% acima do esperado esta semana</p>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        // Initialize the application
        window.addEventListener('DOMContentLoaded', function() {
            app = new AgroManagerApp();
        });

    </script>
</body>
</html>