<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroManager Pro - Sistema de Gestão Agrícola Avançado v3.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#22C55E',
                        secondary: '#3B82F6', 
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        success: '#10B981',
                        warning: '#F59E0B',
                        info: '#3B82F6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 0.6s ease-in-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'zoom-in': 'zoomIn 0.3s ease-out'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes bounceGentle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { 
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 50%, #15803D 100%);
        }

        .metric-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .loading-overlay {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }
        .dark .loading-overlay {
            background: rgba(17, 24, 39, 0.9);
        }

        .notification {
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .notification.show {
            transform: translateX(0);
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .chart-container-large {
            position: relative;
            height: 450px;
        }

        .chart-container-small {
            position: relative;
            height: 280px;
        }

        .data-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        .data-table th:first-child { border-radius: 0.5rem 0 0 0; }
        .data-table th:last-child { border-radius: 0 0.5rem 0 0; }
        .data-table tr:last-child td:first-child { border-radius: 0 0 0 0.5rem; }
        .data-table tr:last-child td:last-child { border-radius: 0 0 0.5rem 0; }

        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .btn-primary {
            @apply bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-secondary {
            @apply bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-6 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-danger {
            @apply bg-danger text-white px-4 py-2 rounded-lg hover:bg-danger/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-warning {
            @apply bg-warning text-white px-4 py-2 rounded-lg hover:bg-warning/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .btn-info {
            @apply bg-info text-white px-4 py-2 rounded-lg hover:bg-info/90 transition-all transform hover:scale-105 active:scale-95 font-medium flex items-center justify-center;
        }
        .tab-button {
            @apply bg-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #16A34A, #15803D);
        }

        .equipment-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .equipment-card:hover {
            transform: translateY(-12px) rotateX(5deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .dark .equipment-card {
            background: linear-gradient(145deg, #1f2937, #111827);
        }

        .progress-bar {
            overflow: hidden;
        }
        .progress-fill {
            animation: progressFill 2s ease-out forwards;
        }
        @keyframes progressFill {
            from { width: 0%; }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .status-indicator {
            position: relative;
            display: inline-block;
        }
        .status-indicator::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .status-online::after { background: #10b981; animation: pulse 2s infinite; }
        .status-warning::after { background: #f59e0b; }
        .status-offline::after { background: #ef4444; }

        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .save-button {
            position: fixed;
            top: 120px;
            right: 20px;
            z-index: 40;
            transition: all 0.3s ease;
        }

        .save-button:hover {
            transform: scale(1.1);
        }

        .record-row {
            transition: all 0.3s ease;
        }
        .record-row:hover {
            background-color: rgba(34, 197, 94, 0.05);
            transform: translateX(4px);
        }

        .filter-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .dark .filter-container {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .record-item {
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }
        .record-item:hover {
            border-left-color: #22C55E;
            background-color: rgba(34, 197, 94, 0.05);
        }

        .edit-form {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        .dark .edit-form {
            background: linear-gradient(135deg, #14532d 0%, #166534 100%);
        }

        .search-highlight {
            background-color: yellow;
            font-weight: bold;
        }

        .pagination-button {
            @apply px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors;
        }
        .pagination-button.active {
            @apply bg-primary text-white border-primary;
        }
        .pagination-button:disabled {
            @apply opacity-50 cursor-not-allowed;
        }

        .chart-card {
            transition: all 0.3s ease;
        }
        .chart-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .chart-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .chart-toolbar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .chart-full-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .dark .chart-full-screen {
            background: #1f2937;
        }

        .notification-center {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -10px 0 25px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification-center.show {
            transform: translateX(0);
        }

        .dark .notification-center {
            background: #1f2937;
        }

        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            z-index: 50;
            transform: scale(0.9) translateY(-10px);
            opacity: 0;
            transition: all 0.2s ease;
        }

        .export-menu.show {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .dark .export-menu {
            background: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-all duration-300 font-sans">
    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="relative inline-block mb-8">
                <div class="w-20 h-20 border-4 border-primary/20 rounded-full animate-spin"></div>
                <div class="absolute inset-0 w-20 h-20 border-4 border-primary border-t-transparent rounded-full animate-spin" style="animation-delay: -0.15s"></div>
                <i class="fas fa-tractor absolute inset-0 text-3xl text-primary flex items-center justify-center"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">AgroManager Pro</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Sistema Inteligente de Gestão Agrícola v3.1</p>
            <div class="w-64 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mx-auto">
                <div id="loadingProgress" class="bg-gradient-to-r from-primary to-secondary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="loadingText" class="text-sm text-gray-500 dark:text-gray-400 mt-4">Inicializando...</p>
        </div>
    </div>

    <!-- Save Button -->
    <button id="saveButton" onclick="manualSave()" class="save-button btn-primary shadow-2xl">
        <i class="fas fa-save mr-2"></i>Salvar Dados
    </button>

    <!-- Notification Center -->
    <div id="notificationCenter" class="notification-center">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Notificações</h3>
                <button onclick="closeNotificationCenter()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <div id="notificationList" class="p-6 space-y-4 max-h-96 overflow-y-auto">
            <!-- Dynamic notifications -->
        </div>
        <div class="p-6 border-t border-gray-200 dark:border-gray-700">
            <button onclick="clearAllNotifications()" class="w-full btn-secondary text-sm">
                <i class="fas fa-trash mr-2"></i>Limpar Todas
            </button>
        </div>
    </div>

    <div id="app" class="min-h-screen opacity-0 transition-opacity duration-500">
        <!-- Enhanced Header -->
        <header class="gradient-bg text-white shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-black opacity-10"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20"></div>
            <div class="container mx-auto px-4 py-6 relative z-10">
                <div class="flex flex-col lg:flex-row items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <i class="fas fa-tractor text-4xl"></i>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <h1 class="text-3xl lg:text-4xl font-bold">AgroManager Pro</h1>
                            <p class="text-sm opacity-90">Sistema Inteligente de Gestão Agrícola Completo</p>
                            <div class="flex items-center mt-1 text-xs opacity-75">
                                <i class="fas fa-shield-check mr-1"></i>
                                <span>Versão 3.1.0 - Sistema Online</span>
                                <span class="mx-2">•</span>
                                <span id="dataStatus">Dados carregados</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Week Navigator -->
                    <div class="flex items-center space-x-4 glass-card rounded-xl px-6 py-3">
                        <button onclick="previousWeek()" class="text-white hover:text-yellow-300 transition-all p-2 rounded-lg hover:bg-white/10 transform hover:scale-110">
                            <i class="fas fa-chevron-left text-lg"></i>
                        </button>
                        <div class="text-center">
                            <div class="text-xs opacity-80 uppercase tracking-wide">Período de Análise</div>
                            <div class="text-lg font-bold" id="currentWeek">Semana 1/2024</div>
                            <div class="text-xs opacity-70" id="weekProgress">5 de 7 dias</div>
                        </div>
                        <button onclick="nextWeek()" class="text-white hover:text-yellow-300 transition-all p-2 rounded-lg hover:bg-white/10 transform hover:scale-110">
                            <i class="fas fa-chevron-right text-lg"></i>
                        </button>
                        <button onclick="goToCurrentWeek()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm transition-all transform hover:scale-105">
                            <i class="fas fa-calendar-day mr-2"></i>Hoje
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm opacity-80" id="currentDate">Carregando...</div>
                            <div class="text-xs opacity-70" id="currentTime">--:--</div>
                        </div>
                        
                        <!-- Auto-save status indicator -->
                        <div id="saveStatus" class="text-xs bg-white/20 px-3 py-2 rounded-lg opacity-0 transition-all">
                            <i class="fas fa-check mr-1"></i>Salvo automaticamente
                        </div>
                        
                        <!-- Data info -->
                        <div class="text-xs bg-white/10 px-3 py-2 rounded-lg">
                            <div class="text-xs opacity-70">Registros:</div>
                            <div class="font-bold" id="totalRecords">0</div>
                        </div>
                        
                        <!-- Notification Badge -->
                        <button onclick="openNotifications()" class="relative p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i class="fas fa-bell text-lg"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">3</span>
                        </button>
                        
                        <button onclick="toggleTheme()" class="p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i id="themeIcon" class="fas fa-moon text-lg"></i>
                        </button>
                        
                        <button onclick="openSettings()" class="p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-all transform hover:scale-110">
                            <i class="fas fa-cog text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Enhanced Navigation Tabs -->
        <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 overflow-x-auto custom-scrollbar">
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap active flex items-center" onclick="showTab('colhedoras', this)">
                        <i class="fas fa-wheat-awn mr-2"></i>Colhedoras
                        <span class="ml-2 bg-primary/20 text-primary px-2 py-1 rounded-full text-xs" id="colhedorasCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('transbordo', this)">
                        <i class="fas fa-truck mr-2"></i>Transbordos
                        <span class="ml-2 bg-secondary/20 text-secondary px-2 py-1 rounded-full text-xs" id="transbordosCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('caminhoes', this)">
                        <i class="fas fa-truck-moving mr-2"></i>Caminhões
                        <span class="ml-2 bg-accent/20 text-accent px-2 py-1 rounded-full text-xs" id="caminhoesCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('moagem', this)">
                        <i class="fas fa-industry mr-2"></i>Moagem
                        <span class="ml-2 bg-indigo-500/20 text-indigo-600 px-2 py-1 rounded-full text-xs" id="moagemCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('registros', this)">
                        <i class="fas fa-database mr-2"></i>Registros
                        <span class="ml-2 bg-purple-500/20 text-purple-600 px-2 py-1 rounded-full text-xs" id="registrosCount">0</span>
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('relatorios', this)">
                        <i class="fas fa-chart-line mr-2"></i>Relatórios
                    </button>
                    <button class="tab-button px-6 py-4 font-medium text-sm rounded-t-lg transition-all whitespace-nowrap flex items-center" onclick="showTab('cadastro', this)">
                        <i class="fas fa-plus-circle mr-2"></i>Cadastro
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Colhedoras Tab -->
            <div id="colhedoras" class="tab-content active animate-fade-in">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão Completa de Colhedoras</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle total da operação de colheita - Produtividade, Consumo e Eficiência</p>
                        </div>
                        <div class="flex space-x-3">
                            <div class="relative">
                                <button onclick="toggleExportMenu('colhedoras')" class="btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Dados
                                </button>
                                <div id="exportMenuColhedoras" class="export-menu">
                                    <div class="p-2">
                                        <button onclick="exportData('colhedoras', 'csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-csv mr-2"></i>CSV
                                        </button>
                                        <button onclick="exportData('colhedoras', 'excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-excel mr-2"></i>Excel
                                        </button>
                                        <button onclick="exportData('colhedoras', 'pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-pdf mr-2"></i>PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button onclick="openColhedoraModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Colhedoras -->
                <div class="mb-8">
                    <!-- Métricas das Colhedoras -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Colhedoras</h3>
                            <p class="text-gray-600 dark:text-gray-400">Performance detalhada e indicadores de produtividade</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Produção Total</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="colhedorasProducaoTotal">0t</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Período selecionado</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-wheat-awn text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span id="colhedorasProducaoTrend">+12% vs período anterior</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Horas Operação</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="colhedorasHorasTotal">0h</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Motor + Sistema</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-clock text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span id="colhedorasEficienciaHoras">Eficiência operacional: 89%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 border border-red-200 dark:border-red-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-red-700 dark:text-red-300 uppercase tracking-wide">Combustível Total</p>
                                        <p class="text-2xl font-bold text-red-900 dark:text-red-100" id="colhedorasCombustivel">0L</p>
                                        <p class="text-xs text-red-600 dark:text-red-400 mt-1">Diesel consumido</p>
                                    </div>
                                    <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-red-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-red-600 dark:text-red-400">
                                        <i class="fas fa-chart-line mr-1"></i>
                                        <span id="colhedorasConsumoMedio">Consumo médio: 15.2L/t</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 border border-orange-200 dark:border-orange-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-orange-700 dark:text-orange-300 uppercase tracking-wide">Óleo Hidráulico</p>
                                        <p class="text-2xl font-bold text-orange-900 dark:text-orange-100" id="colhedorasHidraulico">0L</p>
                                        <p class="text-xs text-orange-600 dark:text-orange-400 mt-1">Sistema hidráulico</p>
                                    </div>
                                    <div class="w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-oil-can text-xl text-orange-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-orange-600 dark:text-orange-400">
                                        <i class="fas fa-wrench mr-1"></i>
                                        <span id="colhedorasManutencao">Próxima manutenção: 20 dias</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Produtividade</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="colhedorasProdutividade">0 t/h</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Performance média</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-tachometer-alt text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-trophy mr-1"></i>
                                        <span id="colhedorasMelhorPerf">Melhor: Colhedora Alpha</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos das Colhedoras -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Produção Diária vs Meta de Colheita</h4>
                                <div class="chart-toolbar">
                                    <select id="colhedorasProducaoFilter" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1" onchange="app.updateColhedorasCharts(app.getWeekData())">
                                        <option value="week">Esta Semana</option>
                                        <option value="month">Este Mês</option>
                                        <option value="quarter">Este Trimestre</option>
                                    </select>
                                    <button onclick="toggleChartType('colhedorasProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Alternar tipo de gráfico">
                                        <i class="fas fa-exchange-alt text-sm"></i>
                                    </button>
                                    <button onclick="expandChart('colhedorasProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Expandir gráfico">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasProducaoChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência por Equipamento</h4>
                                <div class="chart-toolbar">
                                    <select id="colhedorasEficienciaFilter" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1" onchange="app.updateColhedorasCharts(app.getWeekData())">
                                        <option value="produtividade">Produtividade</option>
                                        <option value="consumo">Eficiência Combustível</option>
                                        <option value="disponibilidade">Disponibilidade</option>
                                        <option value="horas">Horas Operação</option>
                                    </select>
                                    <button onclick="toggleChartType('colhedorasEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Alternar tipo de gráfico">
                                        <i class="fas fa-chart-bar text-sm"></i>
                                    </button>
                                    <button onclick="expandChart('colhedorasEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Expandir gráfico">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Novos Gráficos de Consumo para Colhedoras -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Análise Detalhada de Consumo</h4>
                                <div class="chart-toolbar">
                                    <select id="colhedorasConsumoTipo" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1" onchange="app.updateColhedorasConsumoChart()">
                                        <option value="all">Todos os Fluidos</option>
                                        <option value="combustivel">Combustível</option>
                                        <option value="hidraulico">Óleo Hidráulico</option>
                                        <option value="lubrificantes">Lubrificantes</option>
                                    </select>
                                    <button onclick="expandChart('colhedorasConsumoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasConsumoChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Tendência de Produtividade</h4>
                                <div class="chart-toolbar">
                                    <select id="colhedorasTendenciaFilter" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1" onchange="app.updateColhedorasTendenciaChart()">
                                        <option value="7">Últimos 7 dias</option>
                                        <option value="14">Últimos 14 dias</option>
                                        <option value="30">Últimos 30 dias</option>
                                    </select>
                                    <button onclick="expandChart('colhedorasTendenciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="colhedorasTendenciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Colhedoras Cards Grid -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Equipamentos Cadastrados e Status Operacional</h3>
                        <div id="colhedorasGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transbordos Tab -->
            <div id="transbordo" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão Completa de Transbordos</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle detalhado do transporte interno de grãos e logística de campo</p>
                        </div>
                        <div class="flex space-x-3">
                            <div class="relative">
                                <button onclick="toggleExportMenu('transbordos')" class="btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Dados
                                </button>
                                <div id="exportMenuTransbordos" class="export-menu">
                                    <div class="p-2">
                                        <button onclick="exportData('transbordos', 'csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-csv mr-2"></i>CSV
                                        </button>
                                        <button onclick="exportData('transbordos', 'excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-excel mr-2"></i>Excel
                                        </button>
                                        <button onclick="exportData('transbordos', 'pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-pdf mr-2"></i>PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button onclick="openTransbordoModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Transbordos -->
                <div class="mb-8">
                    <!-- Métricas dos Transbordos -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Transbordos</h3>
                            <p class="text-gray-600 dark:text-gray-400">Desempenho logístico e eficiência de transporte interno</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Carga Transportada</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="transbordosCargaTotal">0t</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Total do período</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-truck text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-chart-line mr-1"></i>
                                        <span id="transbordosEficienciaCarga">Média: 18.5 t/viagem</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Viagens Realizadas</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="transbordosViagensTotal">0</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Ciclos completos</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-route text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span id="transbordosTempoMedio">Tempo médio: 45min/ciclo</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 border border-purple-200 dark:border-purple-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wide">Diesel Consumido</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" id="transbordosDiesel">0L</p>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">Combustível total</p>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-purple-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-purple-600 dark:text-purple-400">
                                        <i class="fas fa-calculator mr-1"></i>
                                        <span id="transbordosConsumoPorTonelada">Eficiência: 2.8 L/t</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 border border-orange-200 dark:border-orange-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-orange-700 dark:text-orange-300 uppercase tracking-wide">Óleo Hidráulico</p>
                                        <p class="text-2xl font-bold text-orange-900 dark:text-orange-100" id="transbordosHidraulico">0L</p>
                                        <p class="text-xs text-orange-600 dark:text-orange-400 mt-1">Sistema hidráulico</p>
                                    </div>
                                    <div class="w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-oil-can text-xl text-orange-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-orange-600 dark:text-orange-400">
                                        <i class="fas fa-wrench mr-1"></i>
                                        <span id="transbordosManutencao">Próxima manutenção: 15 dias</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Disponibilidade</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="transbordosDisponibilidade">0%</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Tempo operacional</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-check-circle text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-tools mr-1"></i>
                                        <span id="transbordosParadas">Parada preventiva: 2h</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos dos Transbordos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Performance de Transporte Semanal</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Esta Semana</option>
                                        <option>Semana Passada</option>
                                        <option>Este Mês</option>
                                    </select>
                                    <button onclick="expandChart('transbordosPerformanceChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosPerformanceChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência de Carga vs Viagens</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Por Equipamento</option>
                                        <option>Por Período</option>
                                        <option>Comparativo</option>
                                    </select>
                                    <button onclick="expandChart('transbordosEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Novos Gráficos de Consumo e Distância para Transbordos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Consumo de Combustível por Distância</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Últimos 7 dias</option>
                                        <option>Últimos 14 dias</option>
                                        <option>Este mês</option>
                                    </select>
                                    <button onclick="expandChart('transbordosConsumoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosConsumoChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Análise de Tempo de Ciclo</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Tempo por Viagem</option>
                                        <option>Eficiência Temporal</option>
                                        <option>Comparativo</option>
                                    </select>
                                    <button onclick="expandChart('transbordosTempoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="transbordosTempoChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Transbordos Cards Grid -->
                    <div id="transbordosGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Caminhões Tab -->
            <div id="caminhoes" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão da Frota de Caminhões</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle completo da frota própria e terceirizada - Transporte rodoviário</p>
                        </div>
                        <div class="flex space-x-3">
                            <div class="relative">
                                <button onclick="toggleExportMenu('caminhoes')" class="btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Dados
                                </button>
                                <div id="exportMenuCaminhoes" class="export-menu">
                                    <div class="p-2">
                                        <button onclick="exportData('caminhoes', 'csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-csv mr-2"></i>CSV
                                        </button>
                                        <button onclick="exportData('caminhoes', 'excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-excel mr-2"></i>Excel
                                        </button>
                                        <button onclick="exportData('caminhoes', 'pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-pdf mr-2"></i>PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button onclick="openCaminhaoModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Caminhões -->
                <div class="mb-8">
                    <!-- Métricas dos Caminhões -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Caminhões</h3>
                            <p class="text-gray-600 dark:text-gray-400">Performance logística e eficiência de transporte rodoviário</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <div class="metric-card bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl p-4 border border-amber-200 dark:border-amber-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-amber-700 dark:text-amber-300 uppercase tracking-wide">Carga Transportada</p>
                                        <p class="text-2xl font-bold text-amber-900 dark:text-amber-100" id="caminhoesCargaTotal">0t</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">Total do período</p>
                                    </div>
                                    <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-truck-moving text-xl text-amber-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-amber-600 dark:text-amber-400">
                                        <i class="fas fa-chart-line mr-1"></i>
                                        <span id="caminhoesCargaMedia">Média: 32.5 t/viagem</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Distância Total</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="caminhoesDistanciaTotal">0km</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Quilometragem</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-route text-xl text-green-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-green-600 dark:text-green-400">
                                        <i class="fas fa-road mr-1"></i>
                                        <span id="caminhoesDistanciaMedia">Média: 180km/viagem</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 border border-red-200 dark:border-red-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-red-700 dark:text-red-300 uppercase tracking-wide">Combustível</p>
                                        <p class="text-2xl font-bold text-red-900 dark:text-red-100" id="caminhoesCombustivelTotal">0L</p>
                                        <p class="text-xs text-red-600 dark:text-red-400 mt-1">Diesel consumido</p>
                                    </div>
                                    <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gas-pump text-xl text-red-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-red-600 dark:text-red-400">
                                        <i class="fas fa-calculator mr-1"></i>
                                        <span id="caminhoesConsumoKm">Eficiência: 3.2 km/L</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="metric-card bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Horas Operação</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="caminhoesHorasTotal">0h</p>
                                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Tempo ativo</p>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-clock text-xl text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span id="caminhoesTempoViagem">Tempo médio: 4.2h/viagem</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 rounded-xl p-4 border border-indigo-200 dark:border-indigo-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-indigo-700 dark:text-indigo-300 uppercase tracking-wide">Eficiência Carga</p>
                                        <p class="text-2xl font-bold text-indigo-900 dark:text-indigo-100" id="caminhoesEficiencia">0%</p>
                                        <p class="text-xs text-indigo-600 dark:text-indigo-400 mt-1">Otimização</p>
                                    </div>
                                    <div class="w-12 h-12 bg-indigo-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-tachometer-alt text-xl text-indigo-600"></i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-indigo-600 dark:text-indigo-400">
                                        <i class="fas fa-trophy mr-1"></i>
                                        <span id="caminhoesMelhorEficiencia">Melhor: Caminhão Gamma</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos dos Caminhões -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Carga Transportada vs Distância</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Esta Semana</option>
                                        <option>Semana Passada</option>
                                        <option>Este Mês</option>
                                    </select>
                                    <button onclick="expandChart('caminhoesCargaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesCargaChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência de Combustível por Caminhão</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Por Equipamento</option>
                                        <option>Por Rota</option>
                                        <option>Comparativo</option>
                                    </select>
                                    <button onclick="expandChart('caminhoesEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesEficienciaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Novos Gráficos para Caminhões -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Análise de Consumo vs Distância</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Scatter Plot</option>
                                        <option>Tendência Linear</option>
                                        <option>Por Período</option>
                                    </select>
                                    <button onclick="expandChart('caminhoesConsumoDistanciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesConsumoDistanciaChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Performance de Viagens por Período</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Diário</option>
                                        <option>Semanal</option>
                                        <option>Mensal</option>
                                    </select>
                                    <button onclick="expandChart('caminhoesViagensChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="caminhoesViagensChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Caminhões Cards Grid -->
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Frota de Caminhões - Status e Performance</h3>
                        <div id="caminhoesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Moagem Tab -->
            <div id="moagem" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão de Moagem Industrial</h2>
                            <p class="text-gray-600 dark:text-gray-400">Controle de produção detalhado por frentes de trabalho e unidades produtivas</p>
                        </div>
                        <div class="flex space-x-3">
                            <div class="relative">
                                <button onclick="toggleExportMenu('moagem')" class="btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Dados
                                </button>
                                <div id="exportMenuMoagem" class="export-menu">
                                    <div class="p-2">
                                        <button onclick="exportData('moagem', 'csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-csv mr-2"></i>CSV
                                        </button>
                                        <button onclick="exportData('moagem', 'excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-excel mr-2"></i>Excel
                                        </button>
                                        <button onclick="exportData('moagem', 'pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-pdf mr-2"></i>PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button onclick="openMoagemModal()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>Novo Registro
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de Moagem -->
                <div class="mb-8">
                    <!-- Métricas de Moagem -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                        <div class="text-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dashboard Operacional - Moagem</h3>
                            <p class="text-gray-600 dark:text-gray-400">Performance das unidades produtivas e eficiência por frentes</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="metric-card bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 rounded-xl p-4 border border-indigo-200 dark:border-indigo-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-indigo-700 dark:text-indigo-300 uppercase tracking-wide">Produção Total</p>
                                        <p class="text-2xl font-bold text-indigo-900 dark:text-indigo-100" id="moagemProducaoTotal">0t</p>
                                        <p class="text-xs text-indigo-600 dark:text-indigo-400 mt-1">Período selecionado</p>
                                    </div>
                                    <div class="w-12 h-12 bg-indigo-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-industry text-xl text-indigo-600"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200 dark:border-green-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-green-700 dark:text-green-300 uppercase tracking-wide">Frentes Ativas</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" id="moagemFrentesAtivas">0</p>
                                        <p class="text-xs text-green-600 dark:text-green-400 mt-1">Unidades operando</p>
                                    </div>
                                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-play-circle text-xl text-green-600"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-xl p-4 border border-yellow-200 dark:border-yellow-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-yellow-700 dark:text-yellow-300 uppercase tracking-wide">Eficiência Média</p>
                                        <p class="text-2xl font-bold text-yellow-900 dark:text-yellow-100" id="moagemEficienciaMedia">0%</p>
                                        <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">vs Meta</p>
                                    </div>
                                    <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-percentage text-xl text-yellow-600"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 border border-purple-200 dark:border-purple-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-purple-700 dark:text-purple-300 uppercase tracking-wide">Média Diária</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" id="moagemMediaDiaria">0t</p>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">Produção/dia</p>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-calendar-day text-xl text-purple-600"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos de Moagem -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Produção por Frente de Trabalho</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Esta Semana</option>
                                        <option>Semana Passada</option>
                                        <option>Este Mês</option>
                                    </select>
                                    <button onclick="expandChart('moagemProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="moagemProducaoChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Meta vs Realizado por Frente</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Comparativo</option>
                                        <option>Eficiência %</option>
                                        <option>Desvio da Meta</option>
                                    </select>
                                    <button onclick="expandChart('moagemMetaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="moagemMetaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Novos Gráficos para Moagem -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Tendência de Produção Semanal</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Últimas 4 semanas</option>
                                        <option>Últimas 8 semanas</option>
                                        <option>Últimas 12 semanas</option>
                                    </select>
                                    <button onclick="expandChart('moagemTendenciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="moagemTendenciaChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Distribuição de Eficiência por Frente</h4>
                                <div class="chart-toolbar">
                                    <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                        <option>Pizza</option>
                                        <option>Barras</option>
                                        <option>Donut</option>
                                    </select>
                                    <button onclick="expandChart('moagemDistribuicaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-expand text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="moagemDistribuicaoChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Registros de Moagem -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Registros Detalhados de Moagem</h3>
                            <div class="flex items-center space-x-4">
                                <select id="filtroFrente" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-1 bg-white dark:bg-gray-700">
                                    <option value="">Todas as Frentes</option>
                                </select>
                                <button onclick="app.updateMoagemGrid()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr class="bg-gray-50 dark:bg-gray-700">
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Frente</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Produção (t)</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Meta (%)</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Observações</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="moagemTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nova Aba de Registros -->
            <div id="registros" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gestão Completa de Registros</h2>
                            <p class="text-gray-600 dark:text-gray-400">Visualização, busca, edição e histórico completo de todos os registros operacionais</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="clearFilters()" class="btn-secondary">
                                <i class="fas fa-filter mr-2"></i>Limpar Filtros
                            </button>
                            <div class="relative">
                                <button onclick="toggleExportMenu('registros')" class="btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Tudo
                                </button>
                                <div id="exportMenuRegistros" class="export-menu">
                                    <div class="p-2">
                                        <button onclick="exportAllRecords('csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-csv mr-2"></i>Todos - CSV
                                        </button>
                                        <button onclick="exportAllRecords('excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-excel mr-2"></i>Todos - Excel
                                        </button>
                                        <button onclick="exportAllRecords('pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                            <i class="fas fa-file-pdf mr-2"></i>Relatório Completo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros Avançados -->
                <div class="filter-container rounded-2xl p-6 mb-6 border border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-search mr-2 text-primary"></i>Filtros Avançados
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Registro</label>
                            <select id="filterTipo" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Todos os Tipos</option>
                                <option value="colhedoras">Colhedoras</option>
                                <option value="transbordos">Transbordos</option>
                                <option value="caminhoes">Caminhões</option>
                                <option value="moagem">Moagem</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento</label>
                            <select id="filterEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                <option value="">Todos os Equipamentos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Inicial</label>
                            <input type="date" id="filterDataInicio" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Final</label>
                            <input type="date" id="filterDataFim" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div class="mt-4 flex flex-col sm:flex-row gap-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Busca por Texto</label>
                            <input type="text" id="filterSearch" placeholder="Digite para buscar em todos os campos..." class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="flex space-x-2 items-end">
                            <button onclick="applyFilters()" class="btn-primary">
                                <i class="fas fa-search mr-2"></i>Aplicar Filtros
                            </button>
                            <button onclick="clearFilters()" class="btn-secondary">
                                <i class="fas fa-times mr-2"></i>Limpar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas dos Registros -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-primary">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total de Registros</p>
                                <p class="text-3xl font-bold text-primary" id="statsTotal">0</p>
                            </div>
                            <i class="fas fa-database text-2xl text-primary"></i>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Esta Semana</p>
                                <p class="text-3xl font-bold text-green-500" id="statsWeek">0</p>
                            </div>
                            <i class="fas fa-calendar-week text-2xl text-green-500"></i>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Hoje</p>
                                <p class="text-3xl font-bold text-blue-500" id="statsToday">0</p>
                            </div>
                            <i class="fas fa-calendar-day text-2xl text-blue-500"></i>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Filtrados</p>
                                <p class="text-3xl font-bold text-purple-500" id="statsFiltered">0</p>
                            </div>
                            <i class="fas fa-filter text-2xl text-purple-500"></i>
                        </div>
                    </div>
                </div>

                <!-- Lista de Registros -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-list mr-3 text-primary"></i>Histórico Completo de Registros
                        </h3>
                        <div class="flex space-x-2">
                            <select id="recordsPerPage" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1" onchange="updateRecordsPerPage()">
                                <option value="10">10 por página</option>
                                <option value="25" selected>25 por página</option>
                                <option value="50">50 por página</option>
                                <option value="100">100 por página</option>
                            </select>
                            <button onclick="refreshRecords()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="recordsContainer" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                        <!-- Dynamic content -->
                    </div>

                    <!-- Paginação -->
                    <div id="paginationContainer" class="flex items-center justify-between mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            Mostrando <span id="paginationInfo">0-0 de 0</span> registros
                        </div>
                        <div id="paginationButtons" class="flex space-x-1">
                            <!-- Dynamic pagination buttons -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relatórios Tab -->
            <div id="relatorios" class="tab-content">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Relatórios Analíticos Avançados</h2>
                            <p class="text-gray-600 dark:text-gray-400">Análises detalhadas, insights operacionais e indicadores de performance</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="generateReport()" class="btn-primary">
                                <i class="fas fa-chart-line mr-2"></i>Gerar Relatório Completo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Estatísticas Consolidadas do Período</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-primary mb-2" id="totalProducaoReport">0t</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Produção Total (Período)</div>
                            <div class="text-xs text-primary mt-1">Todas as operações</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-secondary mb-2" id="totalHorasReport">0h</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Horas Operadas</div>
                            <div class="text-xs text-secondary mt-1">Tempo produtivo total</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-accent mb-2" id="totalCombustivelReport">0L</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Combustível Consumido</div>
                            <div class="text-xs text-accent mt-1">Diesel + outros</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600 mb-2" id="eficienciaMediaReport">0%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Eficiência Média</div>
                            <div class="text-xs text-green-600 mt-1">Performance geral</div>
                        </div>
                    </div>
                </div>

                <!-- Gráficos dos Relatórios -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-lg font-bold text-gray-900 dark:text-white">Produção Geral por Categoria</h4>
                            <div class="chart-toolbar">
                                <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                    <option>Esta Semana</option>
                                    <option>Este Mês</option>
                                    <option>Este Trimestre</option>
                                </select>
                                <button onclick="expandChart('relatoriosProducaoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="relatoriosProducaoChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-lg font-bold text-gray-900 dark:text-white">Consumo Total de Combustível</h4>
                            <div class="chart-toolbar">
                                <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                    <option>Por Equipamento</option>
                                    <option>Por Categoria</option>
                                    <option>Temporal</option>
                                </select>
                                <button onclick="expandChart('relatoriosConsumoChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-expand text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="relatoriosConsumoChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de Eficiência Geral -->
                <div class="chart-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-lg font-bold text-gray-900 dark:text-white">Dashboard de Eficiência Geral</h4>
                        <div class="chart-toolbar">
                            <select class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-2 py-1">
                                <option>Todas as Categorias</option>
                                <option>Apenas Colhedoras</option>
                                <option>Apenas Transporte</option>
                                <option>Apenas Moagem</option>
                            </select>
                            <button onclick="expandChart('relatoriosEficienciaChart')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                <i class="fas fa-expand text-sm"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container-large">
                        <canvas id="relatoriosEficienciaChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Cadastro Tab -->
            <div id="cadastro" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Equipment Registration Form -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                            <i class="fas fa-plus-circle mr-3 text-primary"></i>Cadastrar Novo Equipamento
                        </h3>
                        <form id="equipmentForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Tipo de Equipamento *
                                    </label>
                                    <select id="tipoEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                        <option value="colhedora">Colhedora</option>
                                        <option value="transbordo">Transbordo</option>
                                        <option value="caminhao">Caminhão</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Nome/Identificação *
                                    </label>
                                    <input type="text" id="nomeEquipamento" placeholder="Ex: Colhedora 01" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Marca *
                                    </label>
                                    <input type="text" id="marcaEquipamento" placeholder="Ex: John Deere" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Modelo *
                                    </label>
                                    <input type="text" id="modeloEquipamento" placeholder="Ex: S770" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Ano
                                    </label>
                                    <input type="number" id="anoEquipamento" placeholder="2024" min="1900" max="2030" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Placa/Número
                                    </label>
                                    <input type="text" id="placaEquipamento" placeholder="ABC-1234" 
                                           class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Localização Atual
                                </label>
                                <input type="text" id="localizacaoEquipamento" placeholder="Ex: Talhão A1" 
                                       class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white transition-all">
                            </div>
                            
                            <button type="submit" class="w-full btn-primary">
                                <i class="fas fa-save mr-2"></i>Cadastrar Equipamento
                            </button>
                        </form>
                    </div>

                    <!-- Equipment List -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                                <i class="fas fa-list mr-3 text-primary"></i>Equipamentos Cadastrados
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="refreshEquipmentList()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <div class="relative">
                                    <button onclick="toggleExportMenu('equipamentos')" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <div id="exportMenuEquipamentos" class="export-menu">
                                        <div class="p-2">
                                            <button onclick="exportEquipmentList('csv')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                                <i class="fas fa-file-csv mr-2"></i>CSV
                                            </button>
                                            <button onclick="exportEquipmentList('excel')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                                <i class="fas fa-file-excel mr-2"></i>Excel
                                            </button>
                                            <button onclick="exportEquipmentList('pdf')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 text-sm">
                                                <i class="fas fa-file-pdf mr-2"></i>PDF
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search and Filter -->
                        <div class="mb-4">
                            <input type="text" id="equipmentListSearch" placeholder="Buscar equipamento..." 
                                   class="w-full px-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"
                                   onkeyup="filterEquipmentList()">
                        </div>
                        
                        <div id="equipmentList" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Enhanced Floating Action Button -->
        <div class="floating-action">
            <div class="relative">
                <button onclick="toggleQuickActionMenu()" class="w-16 h-16 bg-gradient-to-r from-primary to-secondary text-white rounded-full shadow-2xl hover:shadow-3xl transition-all transform hover:scale-110 active:scale-95 relative overflow-hidden">
                    <div class="absolute inset-0 bg-white opacity-0 hover:opacity-20 transition-opacity rounded-full"></div>
                    <i class="fas fa-plus text-xl relative z-10" id="fabIcon"></i>
                </button>
                
                <!-- Quick Action Menu -->
                <div id="quickActionMenu" class="absolute bottom-20 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 w-48 hidden transform scale-95 opacity-0 transition-all duration-300">
                    <div class="space-y-2">
                        <button onclick="openColhedoraModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-wheat-awn mr-3 text-green-600"></i>
                            <span>Nova Colhedora</span>
                        </button>
                        <button onclick="openTransbordoModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-truck mr-3 text-blue-600"></i>
                            <span>Novo Transbordo</span>
                        </button>
                        <button onclick="openCaminhaoModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-truck-moving mr-3 text-amber-600"></i>
                            <span>Novo Caminhão</span>
                        </button>
                        <button onclick="openMoagemModal(); closeQuickActionMenu();" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-industry mr-3 text-indigo-600"></i>
                            <span>Nova Moagem</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <div id="modalOverlay" class="fixed inset-0 modal-backdrop z-50 hidden items-center justify-center p-4">
        <div id="modalContent" class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Dynamic modal content -->
        </div>
    </div>

    <!-- Enhanced Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-4 max-w-sm"></div>

    <script>
        // Chart.js Global Configuration
        Chart.defaults.font.family = '"Inter", system-ui, -apple-system, sans-serif';
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#6B7280';
        Chart.defaults.borderColor = 'rgba(107, 114, 128, 0.1)';
        Chart.defaults.backgroundColor = 'rgba(107, 114, 128, 0.05)';

        // Support dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Enhanced Application State Management
        class AgroManagerApp {
            constructor() {
                this.state = {
                    equipamentos: [],
                    colhedorasData: [],
                    transbordosData: [],
                    caminhoesData: [],
                    moagemData: [],
                    currentWeekStart: new Date(),
                    charts: {},
                    chartTypes: {},
                    notifications: [],
                    filters: {
                        tipo: '',
                        equipamento: '',
                        dataInicio: '',
                        dataFim: '',
                        search: ''
                    },
                    pagination: {
                        currentPage: 1,
                        recordsPerPage: 25,
                        totalRecords: 0
                    },
                    settings: {
                        theme: 'light',
                        autoSave: true,
                        notifications: true,
                        language: 'pt-BR',
                        refreshInterval: 30000
                    },
                    version: '3.1.0',
                    lastUpdate: new Date(),
                    lastSave: null
                };
                this.init();
            }

            // FUNÇÕES PARA CORRIGIR PROBLEMAS DE DATA
            createLocalDate(dateString) {
                if (typeof dateString === 'string') {
                    if (dateString.includes('-')) {
                        const [year, month, day] = dateString.split('-').map(Number);
                        return new Date(year, month - 1, day, 12, 0, 0, 0);
                    }
                    return new Date(dateString);
                }
                return new Date(dateString);
            }

            getCorrectDayOfWeek(date) {
                const day = date.getDay();
                return day === 0 ? 6 : day - 1;
            }

            formatDateBR(date) {
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            formatDateTimeBR(date) {
                return date.toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            getCurrentDateForInput() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // ENHANCED CHART UTILITIES
            getChartColors() {
                return {
                    primary: '#22C55E',
                    secondary: '#3B82F6',
                    accent: '#F59E0B',
                    danger: '#EF4444',
                    success: '#10B981',
                    warning: '#F59E0B',
                    info: '#3B82F6',
                    purple: '#8B5CF6',
                    pink: '#EC4899',
                    indigo: '#6366F1',
                    gray: '#6B7280'
                };
            }

            getChartGradient(ctx, color1, color2) {
                const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                return gradient;
            }

            getDefaultChartOptions(title = '', responsive = true) {
                return {
                    responsive: responsive,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: !!title,
                            text: title,
                            font: { size: 16, weight: 'bold' },
                            color: '#1F2937',
                            padding: { top: 10, bottom: 30 }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                color: '#6B7280',
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#22C55E',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        // Format numbers based on context
                                        if (label.includes('L') || label.includes('Combustível') || label.includes('Óleo') || label.includes('Diesel')) {
                                            label += context.parsed.y.toFixed(1) + 'L';
                                        } else if (label.includes('t') || label.includes('Produção') || label.includes('Carga')) {
                                            label += context.parsed.y.toFixed(1) + 't';
                                        } else if (label.includes('h') || label.includes('Horas')) {
                                            label += context.parsed.y.toFixed(1) + 'h';
                                        } else if (label.includes('%') || label.includes('Eficiência')) {
                                            label += context.parsed.y.toFixed(1) + '%';
                                        } else {
                                            label += context.parsed.y.toFixed(1);
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 4,
                            hoverRadius: 6,
                            borderWidth: 2
                        },
                        line: {
                            tension: 0.4,
                            borderWidth: 3
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                };
            }

            destroyChart(chartId) {
                if (this.state.charts[chartId]) {
                    this.state.charts[chartId].destroy();
                    delete this.state.charts[chartId];
                }
            }

            async init() {
                try {
                    await this.loadData();
                    this.setupEventListeners();
                    this.setupTheme();
                    this.setCurrentWeek();
                    this.startRealTimeUpdates();
                    await this.simulateLoading();
                    this.showApp();
                    this.updateDashboard();
                    this.updateEquipmentList();
                    this.updateTabCounts();
                    this.updateDataStatus();
                    this.updateRecordsTab();
                    this.addNotification('Sistema AgroManager Pro v3.1 carregado com sucesso! 🚜', 'success');
                    this.showNotification('Sistema AgroManager Pro v3.1 carregado com sucesso! 🚜', 'success');
                    this.startAutoSave();
                } catch (error) {
                    console.error('Erro na inicialização:', error);
                    this.showNotification('Erro ao carregar sistema', 'error');
                }
            }

            async simulateLoading() {
                const progress = document.getElementById('loadingProgress');
                const text = document.getElementById('loadingText');
                
                const steps = [
                    { progress: 20, text: 'Carregando configurações do sistema...' },
                    { progress: 40, text: 'Inicializando equipamentos cadastrados...' },
                    { progress: 60, text: 'Preparando dashboard operacional...' },
                    { progress: 80, text: 'Conectando módulos de análise...' },
                    { progress: 100, text: 'Finalizando carregamento...' }
                ];

                for (const step of steps) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    progress.style.width = `${step.progress}%`;
                    text.textContent = step.text;
                }
            }

            showApp() {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').classList.remove('opacity-0');
                document.getElementById('app').classList.add('opacity-100');
            }

            updateDataStatus() {
                const totalRecords = this.state.colhedorasData.length + 
                                   this.state.transbordosData.length + 
                                   this.state.caminhoesData.length + 
                                   this.state.moagemData.length;
                
                this.updateElement('totalRecords', totalRecords);
                this.updateElement('dataStatus', `${totalRecords} registros`);
            }

            // DATA PERSISTENCE
            async loadData() {
                try {
                    const savedData = localStorage.getItem('agroManagerData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        this.state.equipamentos = data.equipamentos || [];
                        this.state.colhedorasData = data.colhedorasData || [];
                        this.state.transbordosData = data.transbordosData || [];
                        this.state.caminhoesData = data.caminhoesData || [];
                        this.state.moagemData = data.moagemData || [];
                        this.state.lastSave = data.lastSave ? new Date(data.lastSave) : null;
                        
                        // Convert strings back to Date objects
                        this.state.equipamentos.forEach(eq => {
                            eq.createdAt = new Date(eq.createdAt);
                        });
                        
                        ['colhedorasData', 'transbordosData', 'caminhoesData', 'moagemData'].forEach(dataType => {
                            this.state[dataType].forEach(item => {
                                item.timestamp = new Date(item.timestamp);
                            });
                        });
                        
                        console.log('Dados carregados do localStorage:', {
                            equipamentos: this.state.equipamentos.length,
                            totalRegistros: this.state.colhedorasData.length + this.state.transbordosData.length + this.state.caminhoesData.length + this.state.moagemData.length,
                            lastSave: this.state.lastSave
                        });
                        
                        if (this.state.lastSave) {
                            this.showNotification(`Dados carregados (última atualização: ${this.formatDateBR(this.state.lastSave)})`, 'info', 3000);
                        }
                    } else {
                        this.loadSampleData();
                        this.saveData();
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    this.loadSampleData();
                    this.saveData();
                }
            }

            saveData() {
                try {
                    const dataToSave = {
                        equipamentos: this.state.equipamentos,
                        colhedorasData: this.state.colhedorasData,
                        transbordosData: this.state.transbordosData,
                        caminhoesData: this.state.caminhoesData,
                        moagemData: this.state.moagemData,
                        lastSave: new Date(),
                        version: this.state.version
                    };
                    
                    localStorage.setItem('agroManagerData', JSON.stringify(dataToSave));
                    this.state.lastSave = dataToSave.lastSave;
                    
                    this.showSaveStatus();
                    this.updateDataStatus();
                    
                    console.log('Dados salvos com sucesso:', {
                        equipamentos: this.state.equipamentos.length,
                        totalRegistros: this.state.colhedorasData.length + this.state.transbordosData.length + this.state.caminhoesData.length + this.state.moagemData.length,
                        timestamp: dataToSave.lastSave
                    });
                    
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    this.showNotification('Erro ao salvar dados', 'error');
                    return false;
                }
            }

            showSaveStatus() {
                const saveStatus = document.getElementById('saveStatus');
                if (saveStatus) {
                    saveStatus.classList.remove('opacity-0');
                    saveStatus.classList.add('opacity-100');
                    
                    setTimeout(() => {
                        saveStatus.classList.remove('opacity-100');
                        saveStatus.classList.add('opacity-0');
                    }, 3000);
                }
            }

            startAutoSave() {
                setInterval(() => {
                    if (this.state.settings.autoSave) {
                        this.saveData();
                    }
                }, 30000);

                window.addEventListener('beforeunload', () => {
                    this.saveData();
                });
            }

            addOperationalData(type, data) {
                const dataArray = type === 'colhedoras' ? this.state.colhedorasData :
                                type === 'transbordos' ? this.state.transbordosData :
                                type === 'caminhoes' ? this.state.caminhoesData :
                                this.state.moagemData;

                const newRecord = {
                    id: Date.now() + Math.random() * 1000,
                    ...data,
                    timestamp: data.timestamp || new Date()
                };

                dataArray.push(newRecord);
                this.saveData();
                this.updateDashboard();
                this.updateRecordsTab();
                
                return newRecord;
            }

            loadSampleData() {
                this.state.equipamentos = [
                    {
                        id: 1,
                        tipo: 'colhedora',
                        nome: 'Colhedora Alpha',
                        marca: 'John Deere',
                        modelo: 'S770',
                        ano: 2023,
                        placa: 'AGR-2023',
                        status: 'Ativo',
                        localizacao: 'Talhão A1',
                        createdAt: new Date()
                    },
                    {
                        id: 2,
                        tipo: 'transbordo',
                        nome: 'Transbordo Beta',
                        marca: 'Stara',
                        modelo: 'Reboke 14000',
                        ano: 2022,
                        placa: 'TRS-2022',
                        status: 'Ativo',
                        localizacao: 'Talhão B2',
                        createdAt: new Date()
                    },
                    {
                        id: 3,
                        tipo: 'caminhao',
                        nome: 'Caminhão Gamma',
                        marca: 'Volvo',
                        modelo: 'FH 540',
                        ano: 2021,
                        placa: 'CAM-2021',
                        status: 'Ativo',
                        localizacao: 'Estrada Rural',
                        createdAt: new Date()
                    },
                    {
                        id: 4,
                        tipo: 'caminhao',
                        nome: 'Caminhão Delta',
                        marca: 'Mercedes',
                        modelo: 'Atego 2426',
                        ano: 2022,
                        placa: 'CAM-2022',
                        status: 'Ativo',
                        localizacao: 'Usina',
                        createdAt: new Date()
                    }
                ];

                this.generateSampleOperationalData();
                console.log('Dados de exemplo carregados');
            }

            generateSampleOperationalData() {
                const now = new Date();
                
                for (let week = 0; week < 8; week++) {
                    const weekStart = new Date(now);
                    weekStart.setDate(weekStart.getDate() - (week * 7));
                    const weekStartCalculated = this.getWeekStart(weekStart);
                    
                    for (let i = 0; i < 7; i++) {
                        const date = new Date(weekStartCalculated);
                        date.setDate(date.getDate() + i);
                        date.setHours(12, 0, 0, 0);
                        
                        // Colhedoras data
                        this.state.colhedorasData.push({
                            id: Date.now() + i + (week * 1000) + Math.random() * 1000,
                            tipo: 'producao',
                            equipamentoId: 1,
                            producao: Math.random() * 50 + 20 + (week < 4 ? 10 : 0),
                            timestamp: date
                        });

                        this.state.colhedorasData.push({
                            id: Date.now() + i + 100 + (week * 1000) + Math.random() * 1000,
                            tipo: 'horas',
                            equipamentoId: 1,
                            horasMotor: Math.random() * 8 + 4,
                            horasElevador: Math.random() * 8 + 4,
                            timestamp: date
                        });

                        this.state.colhedorasData.push({
                            id: Date.now() + i + 200 + (week * 1000) + Math.random() * 1000,
                            tipo: 'consumo',
                            equipamentoId: 1,
                            consumoCombustivel: Math.random() * 100 + 50,
                            consumoHidraulico: Math.random() * 5 + 2,
                            consumoLubrificantes: Math.random() * 3 + 1,
                            timestamp: date
                        });

                        // Transbordos data
                        this.state.transbordosData.push({
                            id: Date.now() + i + 300 + (week * 1000) + Math.random() * 1000,
                            tipo: 'operacao',
                            equipamentoId: 2,
                            producaoTrator: Math.random() * 30 + 15,
                            horas: Math.random() * 6 + 3,
                            viagens: Math.floor(Math.random() * 10) + 5,
                            distanciaPercorrida: Math.random() * 50 + 20,
                            timestamp: date
                        });

                        this.state.transbordosData.push({
                            id: Date.now() + i + 400 + (week * 1000) + Math.random() * 1000,
                            tipo: 'consumo',
                            equipamentoId: 2,
                            consumoDiesel: Math.random() * 80 + 40,
                            consumoHidraulico: Math.random() * 4 + 1,
                            timestamp: date
                        });

                        // Caminhões data
                        [3, 4].forEach(caminhaoId => {
                            this.state.caminhoesData.push({
                                id: Date.now() + i + (caminhaoId * 100) + (week * 1000) + Math.random() * 1000,
                                tipo: 'operacao',
                                equipamentoId: caminhaoId,
                                producao: Math.random() * 40 + 20,
                                horas: Math.random() * 10 + 5,
                                distancia: Math.random() * 200 + 100,
                                viagens: Math.floor(Math.random() * 3) + 1,
                                timestamp: date
                            });

                            this.state.caminhoesData.push({
                                id: Date.now() + i + (caminhaoId * 100) + 50 + (week * 1000) + Math.random() * 1000,
                                tipo: 'consumo',
                                equipamentoId: caminhaoId,
                                consumoCombustivel: Math.random() * 120 + 60,
                                timestamp: date
                            });
                        });

                        // Moagem data
                        const frentes = ['Frente A', 'Frente B', 'Frente C', 'Frente D'];
                        if (Math.random() > 0.3) {
                            this.state.moagemData.push({
                                id: Date.now() + i + 700 + (week * 1000) + Math.random() * 1000,
                                frente: frentes[Math.floor(Math.random() * frentes.length)],
                                producao: Math.random() * 80 + 40,
                                meta: 50,
                                observacoes: this.getRandomObservation(),
                                timestamp: date
                            });
                        }
                    }
                }
            }

            getRandomObservation() {
                const observations = [
                    'Produção dentro da normalidade operacional',
                    'Pequeno atraso devido condições climáticas',
                    'Excelente produtividade alcançada',
                    'Manutenção preventiva realizada conforme cronograma',
                    'Ajuste fino de equipamentos executado',
                    'Condições ideais de trabalho e clima',
                    'Parada programada para reabastecimento completo',
                    'Performance acima da meta estabelecida'
                ];
                return observations[Math.floor(Math.random() * observations.length)];
            }

            // DASHBOARD UPDATE
            updateDashboard() {
                try {
                    this.updateColhedorasDashboard();
                    this.updateTransbordosDashboard();
                    this.updateCaminhoesDashboard();
                    this.updateMoagemDashboard();
                    this.updateEquipmentGrids();
                    this.updateMoagemSummary();
                    this.updateMoagemGrid();
                    this.updateTabCounts();
                    this.updateReports();
                    this.updateTrendAnalysis();
                    this.updateDataStatus();
                } catch (error) {
                    console.error('Erro ao atualizar dashboard:', error);
                }
            }

            updateTrendAnalysis() {
                const weekData = this.getWeekData();
                
                this.updateColhedorasMetrics(weekData);
                this.updateTransbordosMetrics(weekData);
                this.updateCaminhoesMetrics(weekData);
                this.updateMoagemMetrics(weekData);
            }

            // ENHANCED CHART UPDATES FOR COLHEDORAS
            updateColhedorasDashboard() {
                const weekData = this.getWeekData();
                this.updateColhedorasMetrics(weekData);
                this.updateColhedorasCharts(weekData);
            }

            updateColhedorasMetrics(weekData) {
                let totalProducao = 0, totalHoras = 0, totalCombustivel = 0, totalHidraulico = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'producao') totalProducao += data.producao || 0;
                    if (data.tipo === 'horas') totalHoras += data.horasMotor || 0;
                    if (data.tipo === 'consumo') {
                        totalCombustivel += data.consumoCombustivel || 0;
                        totalHidraulico += data.consumoHidraulico || 0;
                    }
                });

                const produtividade = totalHoras > 0 ? (totalProducao / totalHoras) : 0;
                const consumoMedio = totalProducao > 0 ? (totalCombustivel / totalProducao) : 0;
                const eficienciaHoras = 89;

                this.updateElement('colhedorasProducaoTotal', totalProducao.toFixed(1) + 't');
                this.updateElement('colhedorasHorasTotal', totalHoras.toFixed(1) + 'h');
                this.updateElement('colhedorasCombustivel', totalCombustivel.toFixed(1) + 'L');
                this.updateElement('colhedorasHidraulico', totalHidraulico.toFixed(1) + 'L');
                this.updateElement('colhedorasProdutividade', produtividade.toFixed(1) + ' t/h');
                this.updateElement('colhedorasConsumoMedio', `Consumo médio: ${consumoMedio.toFixed(1)}L/t`);
                this.updateElement('colhedorasEficienciaHoras', `Eficiência operacional: ${eficienciaHoras}%`);
                this.updateElement('colhedorasMelhorPerf', 'Melhor: Colhedora Alpha');
                this.updateElement('colhedorasProducaoTrend', '+12% vs período anterior');
                this.updateElement('colhedorasManutencao', 'Próxima manutenção: 20 dias');
            }

            updateColhedorasCharts(weekData) {
                this.updateColhedorasProducaoChart(weekData);
                this.updateColhedorasEficienciaChart(weekData);
                this.updateColhedorasConsumoChart(weekData);
                this.updateColhedorasTendenciaChart(weekData);
            }

            updateColhedorasProducaoChart(weekData) {
                const ctx = document.getElementById('colhedorasProducaoChart');
                if (!ctx) return;

                this.destroyChart('colhedorasProducao');

                const dailyProduction = this.calculateColhedorasDailyProduction(weekData);
                const dailyTarget = [45, 45, 45, 45, 45, 35, 25];
                const colors = this.getChartColors();

                this.state.charts.colhedorasProducao = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
                        datasets: [{
                            label: 'Produção Real (t)',
                            data: dailyProduction,
                            backgroundColor: dailyProduction.map(value => {
                                const targetIndex = dailyProduction.indexOf(value);
                                const target = dailyTarget[targetIndex];
                                if (value >= target) return colors.success + '80';
                                if (value >= target * 0.9) return colors.warning + '80';
                                return colors.danger + '80';
                            }),
                            borderColor: colors.primary,
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }, {
                            label: 'Meta (t)',
                            data: dailyTarget,
                            type: 'line',
                            borderColor: colors.danger,
                            backgroundColor: colors.danger + '20',
                            borderDash: [5, 5],
                            fill: false,
                            pointBackgroundColor: colors.danger,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (toneladas)',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { 
                                    color: 'rgba(34, 197, 94, 0.1)',
                                    borderDash: [2, 2]
                                },
                                ticks: { 
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value + 't';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Dias da Semana',
                                    color: '#6B7280',
                                    font: { weight: 'bold' }
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateColhedorasEficienciaChart(weekData) {
                const ctx = document.getElementById('colhedorasEficienciaChart');
                if (!ctx) return;

                this.destroyChart('colhedorasEficiencia');

                const eficienciaData = this.calculateColhedorasEficiencia(weekData);
                const colors = this.getChartColors();

                this.state.charts.colhedorasEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Produção (t)',
                            data: eficienciaData.producao,
                            backgroundColor: eficienciaData.producao.map((value, index) => {
                                const maxValue = Math.max(...eficienciaData.producao);
                                if (value === maxValue) return colors.success + '90';
                                if (value > maxValue * 0.8) return colors.primary + '70';
                                return colors.primary + '50';
                            }),
                            borderColor: colors.primary,
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }, {
                            label: 'Eficiência (%)',
                            data: eficienciaData.eficiencia,
                            type: 'line',
                            borderColor: colors.secondary,
                            backgroundColor: colors.secondary + '20',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointBackgroundColor: colors.secondary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            fill: true
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: colors.primary
                                },
                                grid: { 
                                    color: 'rgba(34, 197, 94, 0.1)',
                                    borderDash: [2, 2]
                                },
                                ticks: { 
                                    color: colors.primary,
                                    callback: function(value) {
                                        return value.toFixed(1) + 't';
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)',
                                    color: colors.secondary
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { 
                                    color: colors.secondary,
                                    callback: function(value) {
                                        return value.toFixed(1) + '%';
                                    }
                                },
                                max: 100
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Equipamentos',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateColhedorasConsumoChart(weekData) {
                const ctx = document.getElementById('colhedorasConsumoChart');
                if (!ctx) return;

                this.destroyChart('colhedorasConsumo');

                const consumoData = this.calculateColhedorasConsumo(weekData);
                const colors = this.getChartColors();

                this.state.charts.colhedorasConsumo = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Combustível', 'Óleo Hidráulico', 'Lubrificantes'],
                        datasets: [{
                            data: [consumoData.combustivel, consumoData.hidraulico, consumoData.lubrificantes],
                            backgroundColor: [
                                colors.danger + '90',
                                colors.warning + '90',
                                colors.info + '90'
                            ],
                            borderColor: [
                                colors.danger,
                                colors.warning,
                                colors.info
                            ],
                            borderWidth: 3,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        cutout: '60%',
                        plugins: {
                            ...this.getDefaultChartOptions().plugins,
                            tooltip: {
                                ...this.getDefaultChartOptions().plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toFixed(1)}L (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            updateColhedorasTendenciaChart(weekData) {
                const ctx = document.getElementById('colhedorasTendenciaChart');
                if (!ctx) return;

                this.destroyChart('colhedorasTendencia');

                const tendenciaData = this.calculateColhedorasTendencia();
                const colors = this.getChartColors();

                this.state.charts.colhedorasTendencia = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: tendenciaData.labels,
                        datasets: [{
                            label: 'Produtividade (t/h)',
                            data: tendenciaData.produtividade,
                            borderColor: colors.primary,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.primary + '40', colors.primary + '00'),
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: colors.primary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Meta (t/h)',
                            data: tendenciaData.meta,
                            borderColor: colors.secondary,
                            backgroundColor: 'transparent',
                            borderDash: [10, 5],
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.secondary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produtividade (t/h)',
                                    color: '#6B7280'
                                },
                                grid: { 
                                    color: 'rgba(107, 114, 128, 0.1)',
                                    borderDash: [2, 2]
                                },
                                ticks: { 
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(1) + ' t/h';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Período',
                                    color: '#6B7280'
                                },
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            // ENHANCED CHART UPDATES FOR TRANSBORDOS
            updateTransbordosDashboard() {
                const weekData = this.getWeekData();
                this.updateTransbordosMetrics(weekData);
                this.updateTransbordosCharts(weekData);
            }

            updateTransbordosMetrics(weekData) {
                let cargaTotal = 0, viagensTotal = 0, horasTotal = 0, distanciaTotal = 0, dieselTotal = 0, hidraulicoTotal = 0;
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'operacao') {
                        cargaTotal += data.producaoTrator || 0;
                        viagensTotal += data.viagens || 0;
                        horasTotal += data.horas || 0;
                        distanciaTotal += data.distanciaPercorrida || 0;
                    }
                    if (data.tipo === 'consumo') {
                        dieselTotal += data.consumoDiesel || 0;
                        hidraulicoTotal += data.consumoHidraulico || 0;
                    }
                });

                const eficienciaCarga = viagensTotal > 0 ? (cargaTotal / viagensTotal) : 0;
                const tempoMedio = viagensTotal > 0 ? ((horasTotal * 60) / viagensTotal) : 0;
                const consumoPorTonelada = cargaTotal > 0 ? (dieselTotal / cargaTotal) : 0;
                const disponibilidade = 94;

                this.updateElement('transbordosCargaTotal', cargaTotal.toFixed(1) + 't');
                this.updateElement('transbordosViagensTotal', viagensTotal);
                this.updateElement('transbordosDiesel', dieselTotal.toFixed(1) + 'L');
                this.updateElement('transbordosHidraulico', hidraulicoTotal.toFixed(1) + 'L');
                this.updateElement('transbordosEficienciaCarga', `Média: ${eficienciaCarga.toFixed(1)} t/viagem`);
                this.updateElement('transbordosTempoMedio', `Tempo médio: ${tempoMedio.toFixed(0)}min/ciclo`);
                this.updateElement('transbordosConsumoPorTonelada', `Eficiência: ${consumoPorTonelada.toFixed(1)} L/t`);
                this.updateElement('transbordosDisponibilidade', disponibilidade + '%');
                this.updateElement('transbordosParadas', 'Parada preventiva: 2h');
                this.updateElement('transbordosManutencao', 'Próxima manutenção: 15 dias');
            }

            updateTransbordosCharts(weekData) {
                this.updateTransbordosPerformanceChart(weekData);
                this.updateTransbordosEficienciaChart(weekData);
                this.updateTransbordosConsumoChart(weekData);
                this.updateTransbordosTempoChart(weekData);
            }

            updateTransbordosPerformanceChart(weekData) {
                const ctx = document.getElementById('transbordosPerformanceChart');
                if (!ctx) return;

                this.destroyChart('transbordosPerformance');

                const performanceData = this.calculateTransbordosPerformance(weekData);
                const colors = this.getChartColors();

                this.state.charts.transbordosPerformance = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
                        datasets: [{
                            label: 'Carga Transportada (t)',
                            data: performanceData.carga,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.secondary + '80', colors.secondary + '40'),
                            borderColor: colors.secondary,
                            borderWidth: 2,
                            borderRadius: 8
                        }, {
                            label: 'Número de Viagens',
                            data: performanceData.viagens,
                            type: 'line',
                            borderColor: colors.warning,
                            backgroundColor: colors.warning + '20',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointBackgroundColor: colors.warning,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Carga (t)',
                                    color: colors.secondary
                                },
                                ticks: {
                                    color: colors.secondary,
                                    callback: function(value) {
                                        return value.toFixed(1) + 't';
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Viagens',
                                    color: colors.warning
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: colors.warning }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateTransbordosEficienciaChart(weekData) {
                const ctx = document.getElementById('transbordosEficienciaChart');
                if (!ctx) return;

                this.destroyChart('transbordosEficiencia');

                const eficienciaData = this.calculateTransbordosEficiencia(weekData);
                const colors = this.getChartColors();

                this.state.charts.transbordosEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Performance Atual',
                            data: eficienciaData.performance,
                            backgroundColor: colors.secondary + '20',
                            borderColor: colors.secondary,
                            borderWidth: 3,
                            pointBackgroundColor: colors.secondary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }, {
                            label: 'Meta',
                            data: eficienciaData.meta,
                            backgroundColor: colors.success + '15',
                            borderColor: colors.success,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointBackgroundColor: colors.success,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    color: '#6B7280'
                                },
                                grid: {
                                    color: 'rgba(107, 114, 128, 0.2)'
                                },
                                angleLines: {
                                    color: 'rgba(107, 114, 128, 0.2)'
                                }
                            }
                        }
                    }
                });
            }

            updateTransbordosConsumoChart(weekData) {
                const ctx = document.getElementById('transbordosConsumoChart');
                if (!ctx) return;

                this.destroyChart('transbordosConsumo');

                const consumoData = this.calculateTransbordosConsumo(weekData);
                const colors = this.getChartColors();

                this.state.charts.transbordosConsumo = new Chart(ctx.getContext('2d'), {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Consumo vs Distância',
                            data: consumoData.points,
                            backgroundColor: colors.purple + '60',
                            borderColor: colors.purple,
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Distância (km)',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Consumo (L)',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateTransbordosTempoChart(weekData) {
                const ctx = document.getElementById('transbordosTempoChart');
                if (!ctx) return;

                this.destroyChart('transbordosTempo');

                const tempoData = this.calculateTransbordosTempo(weekData);
                const colors = this.getChartColors();

                this.state.charts.transbordosTempo = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: tempoData.labels,
                        datasets: [{
                            label: 'Tempo de Ciclo (min)',
                            data: tempoData.tempos,
                            borderColor: colors.info,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.info + '40', colors.info + '00'),
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: colors.info,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Tempo (minutos)',
                                    color: '#6B7280'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value + ' min';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Viagens',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            // ENHANCED CHART UPDATES FOR CAMINHÕES
            updateCaminhoesDashboard() {
                const weekData = this.getWeekData();
                this.updateCaminhoesMetrics(weekData);
                this.updateCaminhoesCharts(weekData);
            }

            updateCaminhoesMetrics(weekData) {
                let producaoTotal = 0, distanciaTotal = 0, horasTotal = 0, viagensTotal = 0, combustivelTotal = 0;
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'operacao') {
                        producaoTotal += data.producao || 0;
                        distanciaTotal += data.distancia || 0;
                        horasTotal += data.horas || 0;
                        viagensTotal += data.viagens || 0;
                    }
                    if (data.tipo === 'consumo') {
                        combustivelTotal += data.consumoCombustivel || 0;
                    }
                });

                const cargaMedia = viagensTotal > 0 ? (producaoTotal / viagensTotal) : 0;
                const distanciaMedia = viagensTotal > 0 ? (distanciaTotal / viagensTotal) : 0;
                const tempoViagem = viagensTotal > 0 ? (horasTotal / viagensTotal) : 0;
                const consumoKm = combustivelTotal > 0 && distanciaTotal > 0 ? (distanciaTotal / combustivelTotal) : 3.2;
                const eficiencia = distanciaTotal > 0 ? ((producaoTotal / distanciaTotal) * 100) : 0;

                this.updateElement('caminhoesCargaTotal', producaoTotal.toFixed(1) + 't');
                this.updateElement('caminhoesDistanciaTotal', distanciaTotal.toFixed(1) + 'km');
                this.updateElement('caminhoesCombustivelTotal', combustivelTotal.toFixed(1) + 'L');
                this.updateElement('caminhoesHorasTotal', horasTotal.toFixed(1) + 'h');
                this.updateElement('caminhoesEficiencia', eficiencia.toFixed(1) + '%');
                this.updateElement('caminhoesCargaMedia', `Média: ${cargaMedia.toFixed(1)} t/viagem`);
                this.updateElement('caminhoesDistanciaMedia', `Média: ${distanciaMedia.toFixed(0)}km/viagem`);
                this.updateElement('caminhoesConsumoKm', `Eficiência: ${consumoKm.toFixed(1)} km/L`);
                this.updateElement('caminhoesTempoViagem', `Tempo médio: ${tempoViagem.toFixed(1)}h/viagem`);
                this.updateElement('caminhoesMelhorEficiencia', 'Melhor: Caminhão Gamma');
            }

            updateCaminhoesCharts(weekData) {
                this.updateCaminhoesCargaChart(weekData);
                this.updateCaminhoesEficienciaChart(weekData);
                this.updateCaminhoesConsumoDistanciaChart(weekData);
                this.updateCaminhoesViagensChart(weekData);
            }

            updateCaminhoesCargaChart(weekData) {
                const ctx = document.getElementById('caminhoesCargaChart');
                if (!ctx) return;

                this.destroyChart('caminhoesCarga');

                const cargaData = this.calculateCaminhoesCarga(weekData);
                const colors = this.getChartColors();

                this.state.charts.caminhoesCarga = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
                        datasets: [{
                            label: 'Carga Transportada (t)',
                            data: cargaData.carga,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.accent + '80', colors.accent + '40'),
                            borderColor: colors.accent,
                            borderWidth: 2,
                            borderRadius: 8
                        }, {
                            label: 'Distância Percorrida (km)',
                            data: cargaData.distancia,
                            type: 'line',
                            borderColor: colors.info,
                            backgroundColor: colors.info + '20',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointBackgroundColor: colors.info,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Carga (t)',
                                    color: colors.accent
                                },
                                ticks: {
                                    color: colors.accent,
                                    callback: function(value) {
                                        return value.toFixed(1) + 't';
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Distância (km)',
                                    color: colors.info
                                },
                                grid: { drawOnChartArea: false },
                                ticks: {
                                    color: colors.info,
                                    callback: function(value) {
                                        return value.toFixed(0) + 'km';
                                    }
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateCaminhoesEficienciaChart(weekData) {
                const ctx = document.getElementById('caminhoesEficienciaChart');
                if (!ctx) return;

                this.destroyChart('caminhoesEficiencia');

                const eficienciaData = this.calculateCaminhoesEficiencia(weekData);
                const colors = this.getChartColors();

                this.state.charts.caminhoesEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'polarArea',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            data: eficienciaData.eficiencia,
                            backgroundColor: [
                                colors.accent + '80',
                                colors.secondary + '80',
                                colors.success + '80',
                                colors.warning + '80'
                            ],
                            borderColor: [
                                colors.accent,
                                colors.secondary,
                                colors.success,
                                colors.warning
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            r: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(1) + ' km/L';
                                    },
                                    color: '#6B7280'
                                },
                                grid: {
                                    color: 'rgba(107, 114, 128, 0.2)'
                                }
                            }
                        }
                    }
                });
            }

            updateCaminhoesConsumoDistanciaChart(weekData) {
                const ctx = document.getElementById('caminhoesConsumoDistanciaChart');
                if (!ctx) return;

                this.destroyChart('caminhoesConsumoDistancia');

                const consumoData = this.calculateCaminhoesConsumoDistancia(weekData);
                const colors = this.getChartColors();

                this.state.charts.caminhoesConsumoDistancia = new Chart(ctx.getContext('2d'), {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Caminhão Gamma',
                            data: consumoData.gamma,
                            backgroundColor: colors.accent + '60',
                            borderColor: colors.accent,
                            borderWidth: 2,
                            pointRadius: 6
                        }, {
                            label: 'Caminhão Delta',
                            data: consumoData.delta,
                            backgroundColor: colors.secondary + '60',
                            borderColor: colors.secondary,
                            borderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Distância (km)',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Consumo (L)',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateCaminhoesViagensChart(weekData) {
                const ctx = document.getElementById('caminhoesViagensChart');
                if (!ctx) return;

                this.destroyChart('caminhoesViagens');

                const viagensData = this.calculateCaminhoesViagens(weekData);
                const colors = this.getChartColors();

                this.state.charts.caminhoesViagens = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: viagensData.labels,
                        datasets: [{
                            label: 'Viagens Realizadas',
                            data: viagensData.viagens,
                            borderColor: colors.accent,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.accent + '40', colors.accent + '00'),
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: colors.accent,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Eficiência Temporal (h/viagem)',
                            data: viagensData.eficiencia,
                            borderColor: colors.danger,
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            borderDash: [5, 5],
                            tension: 0.4,
                            pointBackgroundColor: colors.danger,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Viagens',
                                    color: colors.accent
                                },
                                ticks: { color: colors.accent }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Tempo (h/viagem)',
                                    color: colors.danger
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: colors.danger }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            // ENHANCED CHART UPDATES FOR MOAGEM
            updateMoagemDashboard() {
                const weekData = this.getWeekData();
                this.updateMoagemMetrics(weekData);
                this.updateMoagemCharts(weekData);
            }

            updateMoagemMetrics(weekData) {
                let producaoTotal = 0;
                let frentesAtivas = new Set();
                let diasComProducao = new Set();
                let eficienciaTotal = 0;
                let registrosComMeta = 0;
                
                weekData.moagem.forEach(data => {
                    producaoTotal += data.producao || 0;
                    frentesAtivas.add(data.frente);
                    diasComProducao.add(new Date(data.timestamp).toDateString());
                    
                    if (data.meta) {
                        eficienciaTotal += (data.producao / data.meta) * 100;
                        registrosComMeta++;
                    }
                });

                const mediaDiaria = diasComProducao.size > 0 ? producaoTotal / diasComProducao.size : 0;
                const eficienciaMedia = registrosComMeta > 0 ? eficienciaTotal / registrosComMeta : 0;

                this.updateElement('moagemProducaoTotal', producaoTotal.toFixed(1) + 't');
                this.updateElement('moagemFrentesAtivas', frentesAtivas.size);
                this.updateElement('moagemEficienciaMedia', eficienciaMedia.toFixed(1) + '%');
                this.updateElement('moagemMediaDiaria', mediaDiaria.toFixed(1) + 't');
            }

            updateMoagemCharts(weekData) {
                this.updateMoagemProducaoChart(weekData);
                this.updateMoagemMetaChart(weekData);
                this.updateMoagemTendenciaChart(weekData);
                this.updateMoagemDistribuicaoChart(weekData);
            }

            updateMoagemProducaoChart(weekData) {
                const ctx = document.getElementById('moagemProducaoChart');
                if (!ctx) return;

                this.destroyChart('moagemProducao');

                const producaoData = this.calculateMoagemProducao(weekData);
                const colors = this.getChartColors();

                this.state.charts.moagemProducao = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: producaoData.frentes,
                        datasets: [{
                            label: 'Produção por Frente (t)',
                            data: producaoData.producao,
                            backgroundColor: [
                                colors.indigo + '80',
                                colors.purple + '80',
                                colors.pink + '80',
                                colors.success + '80',
                                colors.warning + '80'
                            ],
                            borderColor: [
                                colors.indigo,
                                colors.purple,
                                colors.pink,
                                colors.success,
                                colors.warning
                            ],
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: '#6B7280'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(1) + 't';
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Frentes de Trabalho',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateMoagemMetaChart(weekData) {
                const ctx = document.getElementById('moagemMetaChart');
                if (!ctx) return;

                this.destroyChart('moagemMeta');

                const metaData = this.calculateMoagemMeta(weekData);
                const colors = this.getChartColors();

                this.state.charts.moagemMeta = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: metaData.frentes,
                        datasets: [{
                            label: 'Produção Real (t)',
                            data: metaData.real,
                            backgroundColor: colors.indigo + '80',
                            borderColor: colors.indigo,
                            borderWidth: 2,
                            borderRadius: 6
                        }, {
                            label: 'Meta (t)',
                            data: metaData.meta,
                            backgroundColor: colors.success + '80',
                            borderColor: colors.success,
                            borderWidth: 2,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: '#6B7280'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(1) + 't';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Frentes de Trabalho',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateMoagemTendenciaChart(weekData) {
                const ctx = document.getElementById('moagemTendenciaChart');
                if (!ctx) return;

                this.destroyChart('moagemTendencia');

                const tendenciaData = this.calculateMoagemTendencia();
                const colors = this.getChartColors();

                this.state.charts.moagemTendencia = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: tendenciaData.semanas,
                        datasets: [{
                            label: 'Produção Semanal (t)',
                            data: tendenciaData.producao,
                            borderColor: colors.indigo,
                            backgroundColor: this.getChartGradient(ctx.getContext('2d'), colors.indigo + '40', colors.indigo + '00'),
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: colors.indigo,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Eficiência (%)',
                            data: tendenciaData.eficiencia,
                            borderColor: colors.success,
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            tension: 0.4,
                            pointBackgroundColor: colors.success,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Produção (t)',
                                    color: colors.indigo
                                },
                                ticks: { color: colors.indigo }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)',
                                    color: colors.success
                                },
                                grid: { drawOnChartArea: false },
                                ticks: { color: colors.success },
                                max: 120
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Semanas',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateMoagemDistribuicaoChart(weekData) {
                const ctx = document.getElementById('moagemDistribuicaoChart');
                if (!ctx) return;

                this.destroyChart('moagemDistribuicao');

                const distribuicaoData = this.calculateMoagemDistribuicao(weekData);
                const colors = this.getChartColors();

                this.state.charts.moagemDistribuicao = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: distribuicaoData.frentes,
                        datasets: [{
                            data: distribuicaoData.eficiencia,
                            backgroundColor: [
                                colors.indigo + '90',
                                colors.purple + '90',
                                colors.pink + '90',
                                colors.success + '90',
                                colors.warning + '90'
                            ],
                            borderColor: [
                                colors.indigo,
                                colors.purple,
                                colors.pink,
                                colors.success,
                                colors.warning
                            ],
                            borderWidth: 3,
                            hoverOffset: 15
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        cutout: '50%',
                        plugins: {
                            ...this.getDefaultChartOptions().plugins,
                            tooltip: {
                                ...this.getDefaultChartOptions().plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        return `${label}: ${value.toFixed(1)}% de eficiência`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // CALCULATION METHODS FOR ALL CHARTS
            calculateColhedorasDailyProduction(weekData) {
                const dailyProduction = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'producao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = this.getCorrectDayOfWeek(date);
                        dailyProduction[dayOfWeek] += data.producao || 0;
                    }
                });
                
                return dailyProduction;
            }

            calculateColhedorasEficiencia(weekData) {
                const equipamentos = this.state.equipamentos.filter(eq => eq.tipo === 'colhedora');
                const labels = equipamentos.map(eq => eq.nome);
                const producao = [];
                const eficiencia = [];

                equipamentos.forEach(eq => {
                    let totalProducao = 0;
                    let totalHoras = 0;

                    weekData.colhedoras.forEach(data => {
                        if (data.equipamentoId === eq.id) {
                            if (data.tipo === 'producao') totalProducao += data.producao || 0;
                            if (data.tipo === 'horas') totalHoras += data.horasMotor || 0;
                        }
                    });

                    producao.push(totalProducao);
                    eficiencia.push(totalHoras > 0 ? (totalProducao / totalHoras) * 10 : 0);
                });

                return { labels, producao, eficiencia };
            }

            calculateColhedorasConsumo(weekData) {
                let combustivel = 0, hidraulico = 0, lubrificantes = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'consumo') {
                        combustivel += data.consumoCombustivel || 0;
                        hidraulico += data.consumoHidraulico || 0;
                        lubrificantes += data.consumoLubrificantes || 0;
                    }
                });

                return { combustivel, hidraulico, lubrificantes };
            }

            calculateColhedorasTendencia() {
                const labels = [];
                const produtividade = [];
                const meta = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(this.formatDateBR(date));
                    produtividade.push(Math.random() * 5 + 10);
                    meta.push(12);
                }

                return { labels, produtividade, meta };
            }

            calculateTransbordosPerformance(weekData) {
                const carga = [0, 0, 0, 0, 0, 0, 0];
                const viagens = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'operacao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = this.getCorrectDayOfWeek(date);
                        carga[dayOfWeek] += data.producaoTrator || 0;
                        viagens[dayOfWeek] += data.viagens || 0;
                    }
                });

                return { carga, viagens };
            }

            calculateTransbordosEficiencia(weekData) {
                return {
                    labels: ['Carga/Viagem', 'Tempo/Ciclo', 'Consumo/KM', 'Disponibilidade', 'Eficiência'],
                    performance: [85, 78, 92, 88, 82],
                    meta: [90, 85, 95, 90, 85]
                };
            }

            calculateTransbordosConsumo(weekData) {
                const points = [];
                
                weekData.transbordos.forEach(operacao => {
                    const consumoData = weekData.transbordos.find(c => 
                        c.tipo === 'consumo' && 
                        c.equipamentoId === operacao.equipamentoId &&
                        Math.abs(new Date(c.timestamp) - new Date(operacao.timestamp)) < 24 * 60 * 60 * 1000
                    );
                    
                    if (consumoData && operacao.tipo === 'operacao') {
                        points.push({
                            x: operacao.distanciaPercorrida || 0,
                            y: consumoData.consumoDiesel || 0
                        });
                    }
                });

                return { points };
            }

            calculateTransbordosTempo(weekData) {
                const labels = [];
                const tempos = [];
                
                weekData.transbordos.forEach((data, index) => {
                    if (data.tipo === 'operacao') {
                        labels.push(`Viagem ${index + 1}`);
                        const tempo = data.viagens > 0 ? (data.horas * 60) / data.viagens : 0;
                        tempos.push(tempo);
                    }
                });

                return { labels: labels.slice(0, 10), tempos: tempos.slice(0, 10) };
            }

            calculateCaminhoesCarga(weekData) {
                const carga = [0, 0, 0, 0, 0, 0, 0];
                const distancia = [0, 0, 0, 0, 0, 0, 0];
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'operacao') {
                        const date = new Date(data.timestamp);
                        const dayOfWeek = this.getCorrectDayOfWeek(date);
                        carga[dayOfWeek] += data.producao || 0;
                        distancia[dayOfWeek] += data.distancia || 0;
                    }
                });

                return { carga, distancia };
            }

            calculateCaminhoesEficiencia(weekData) {
                const equipamentos = this.state.equipamentos.filter(eq => eq.tipo === 'caminhao');
                const labels = equipamentos.map(eq => eq.nome);
                const eficiencia = [];

                equipamentos.forEach(eq => {
                    let totalCombustivel = 0;
                    let totalDistancia = 0;

                    weekData.caminhoes.forEach(data => {
                        if (data.equipamentoId === eq.id) {
                            if (data.tipo === 'operacao') totalDistancia += data.distancia || 0;
                            if (data.tipo === 'consumo') totalCombustivel += data.consumoCombustivel || 0;
                        }
                    });

                    eficiencia.push(totalCombustivel > 0 ? totalDistancia / totalCombustivel : 0);
                });

                return { labels, eficiencia };
            }

            calculateCaminhoesConsumoDistancia(weekData) {
                const gamma = [];
                const delta = [];
                
                weekData.caminhoes.forEach(operacao => {
                    const consumoData = weekData.caminhoes.find(c => 
                        c.tipo === 'consumo' && 
                        c.equipamentoId === operacao.equipamentoId &&
                        Math.abs(new Date(c.timestamp) - new Date(operacao.timestamp)) < 24 * 60 * 60 * 1000
                    );
                    
                    if (consumoData && operacao.tipo === 'operacao') {
                        const point = {
                            x: operacao.distancia || 0,
                            y: consumoData.consumoCombustivel || 0
                        };
                        
                        if (operacao.equipamentoId === 3) {
                            gamma.push(point);
                        } else if (operacao.equipamentoId === 4) {
                            delta.push(point);
                        }
                    }
                });

                return { gamma, delta };
            }

            calculateCaminhoesViagens(weekData) {
                const labels = [];
                const viagens = [];
                const eficiencia = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(this.formatDateBR(date));
                    
                    let dailyViagens = 0;
                    let dailyHoras = 0;
                    
                    weekData.caminhoes.forEach(data => {
                        if (data.tipo === 'operacao') {
                            const dataDate = new Date(data.timestamp);
                            if (dataDate.toDateString() === date.toDateString()) {
                                dailyViagens += data.viagens || 0;
                                dailyHoras += data.horas || 0;
                            }
                        }
                    });
                    
                    viagens.push(dailyViagens);
                    eficiencia.push(dailyViagens > 0 ? dailyHoras / dailyViagens : 0);
                }

                return { labels, viagens, eficiencia };
            }

            calculateMoagemProducao(weekData) {
                const frentesData = {};
                
                weekData.moagem.forEach(data => {
                    if (!frentesData[data.frente]) {
                        frentesData[data.frente] = 0;
                    }
                    frentesData[data.frente] += data.producao || 0;
                });

                return {
                    frentes: Object.keys(frentesData),
                    producao: Object.values(frentesData)
                };
            }

            calculateMoagemMeta(weekData) {
                const frentesData = {};
                const frentesMeta = {};
                
                weekData.moagem.forEach(data => {
                    if (!frentesData[data.frente]) {
                        frentesData[data.frente] = 0;
                        frentesMeta[data.frente] = 0;
                    }
                    frentesData[data.frente] += data.producao || 0;
                    frentesMeta[data.frente] += data.meta || 50;
                });

                return {
                    frentes: Object.keys(frentesData),
                    real: Object.values(frentesData),
                    meta: Object.values(frentesMeta)
                };
            }

            calculateMoagemTendencia() {
                const semanas = [];
                const producao = [];
                const eficiencia = [];
                
                for (let i = 7; i >= 0; i--) {
                    semanas.push(`Sem ${8 - i}`);
                    producao.push(Math.random() * 200 + 100);
                    eficiencia.push(Math.random() * 20 + 80);
                }

                return { semanas, producao, eficiencia };
            }

            calculateMoagemDistribuicao(weekData) {
                const frentesEficiencia = {};
                
                weekData.moagem.forEach(data => {
                    if (!frentesEficiencia[data.frente]) {
                        frentesEficiencia[data.frente] = [];
                    }
                    if (data.meta && data.meta > 0) {
                        frentesEficiencia[data.frente].push((data.producao / data.meta) * 100);
                    }
                });

                const frentes = Object.keys(frentesEficiencia);
                const eficiencia = frentes.map(frente => {
                    const eficiencias = frentesEficiencia[frente];
                    return eficiencias.length > 0 ? 
                        eficiencias.reduce((a, b) => a + b, 0) / eficiencias.length : 0;
                });

                return { frentes, eficiencia };
            }

            // REPORTS CHART UPDATES
            updateReports() {
                this.updateReportsCharts();
                this.updateReportsMetrics();
            }

            updateReportsCharts() {
                this.updateRelatoriosProducaoChart();
                this.updateRelatoriosConsumoChart();
                this.updateRelatoriosEficienciaChart();
            }

            updateRelatoriosProducaoChart() {
                const ctx = document.getElementById('relatoriosProducaoChart');
                if (!ctx) return;

                this.destroyChart('relatoriosProducao');

                const weekData = this.getWeekData();
                const colors = this.getChartColors();

                // Calculate production by category
                let colhedorasProducao = 0, transbordosProducao = 0, caminhoesProducao = 0, moagemProducao = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'producao') colhedorasProducao += data.producao || 0;
                });
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'operacao') transbordosProducao += data.producaoTrator || 0;
                });
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'operacao') caminhoesProducao += data.producao || 0;
                });
                
                weekData.moagem.forEach(data => {
                    moagemProducao += data.producao || 0;
                });

                this.state.charts.relatoriosProducao = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Colhedoras', 'Transbordos', 'Caminhões', 'Moagem'],
                        datasets: [{
                            data: [colhedorasProducao, transbordosProducao, caminhoesProducao, moagemProducao],
                            backgroundColor: [
                                colors.success + '90',
                                colors.secondary + '90',
                                colors.accent + '90',
                                colors.indigo + '90'
                            ],
                            borderColor: [
                                colors.success,
                                colors.secondary,
                                colors.accent,
                                colors.indigo
                            ],
                            borderWidth: 3,
                            hoverOffset: 15
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        cutout: '40%',
                        plugins: {
                            ...this.getDefaultChartOptions().plugins,
                            tooltip: {
                                ...this.getDefaultChartOptions().plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toFixed(1)}t (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            updateRelatoriosConsumoChart() {
                const ctx = document.getElementById('relatoriosConsumoChart');
                if (!ctx) return;

                this.destroyChart('relatoriosConsumo');

                const weekData = this.getWeekData();
                const colors = this.getChartColors();

                // Calculate consumption by equipment type
                let colhedorasConsumo = 0, transbordosConsumo = 0, caminhoesConsumo = 0;
                
                weekData.colhedoras.forEach(data => {
                    if (data.tipo === 'consumo') colhedorasConsumo += data.consumoCombustivel || 0;
                });
                
                weekData.transbordos.forEach(data => {
                    if (data.tipo === 'consumo') transbordosConsumo += data.consumoDiesel || 0;
                });
                
                weekData.caminhoes.forEach(data => {
                    if (data.tipo === 'consumo') caminhoesConsumo += data.consumoCombustivel || 0;
                });

                this.state.charts.relatoriosConsumo = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Colhedoras', 'Transbordos', 'Caminhões'],
                        datasets: [{
                            label: 'Consumo de Combustível (L)',
                            data: [colhedorasConsumo, transbordosConsumo, caminhoesConsumo],
                            backgroundColor: [
                                this.getChartGradient(ctx.getContext('2d'), colors.success + '80', colors.success + '40'),
                                this.getChartGradient(ctx.getContext('2d'), colors.secondary + '80', colors.secondary + '40'),
                                this.getChartGradient(ctx.getContext('2d'), colors.accent + '80', colors.accent + '40')
                            ],
                            borderColor: [colors.success, colors.secondary, colors.accent],
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Consumo (L)',
                                    color: '#6B7280'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(0) + 'L';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Categorias',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            }

            updateRelatoriosEficienciaChart() {
                const ctx = document.getElementById('relatoriosEficienciaChart');
                if (!ctx) return;

                this.destroyChart('relatoriosEficiencia');

                const colors = this.getChartColors();

                // Mock efficiency data for different metrics
                const eficienciaData = {
                    labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                    producao: [85, 92, 88, 94, 89, 76, 65],
                    consumo: [78, 82, 85, 80, 88, 90, 92],
                    disponibilidade: [95, 89, 92, 96, 91, 85, 80],
                    qualidade: [88, 94, 91, 87, 93, 89, 86]
                };

                this.state.charts.relatoriosEficiencia = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: eficienciaData.labels,
                        datasets: [{
                            label: 'Eficiência Produção (%)',
                            data: eficienciaData.producao,
                            borderColor: colors.success,
                            backgroundColor: colors.success + '20',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.success,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Eficiência Consumo (%)',
                            data: eficienciaData.consumo,
                            borderColor: colors.danger,
                            backgroundColor: colors.danger + '20',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.danger,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Disponibilidade (%)',
                            data: eficienciaData.disponibilidade,
                            borderColor: colors.secondary,
                            backgroundColor: colors.secondary + '20',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.secondary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }, {
                            label: 'Qualidade (%)',
                            data: eficienciaData.qualidade,
                            borderColor: colors.accent,
                            backgroundColor: colors.accent + '20',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.accent,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        ...this.getDefaultChartOptions(),
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Eficiência (%)',
                                    color: '#6B7280'
                                },
                                ticks: {
                                    color: '#6B7280',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: {
                                    color: 'rgba(107, 114, 128, 0.1)',
                                    borderDash: [2, 2]
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Dias da Semana',
                                    color: '#6B7280'
                                },
                                ticks: { color: '#6B7280' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            updateReportsMetrics() {
                const weekData = this.getWeekData();
                
                let totalProducao = 0;
                let totalHoras = 0;
                let totalCombustivel = 0;
                
                [...weekData.colhedoras, ...weekData.transbordos, ...weekData.caminhoes].forEach(data => {
                    if (data.tipo === 'producao' || data.tipo === 'operacao') {
                        totalProducao += data.producao || data.producaoTrator || 0;
                    }
                    if (data.tipo === 'horas' || data.tipo === 'operacao') {
                        totalHoras += data.horasMotor || data.horas || 0;
                    }
                    if (data.tipo === 'consumo') {
                        totalCombustivel += data.consumoCombustivel || data.consumoDiesel || 0;
                    }
                });

                weekData.moagem.forEach(data => {
                    totalProducao += data.producao || 0;
                });

                const eficienciaMedia = totalHoras > 0 ? (totalProducao / totalHoras) * 100 / 10 : 0;

                this.updateElement('totalProducaoReport', totalProducao.toFixed(1) + 't');
                this.updateElement('totalHorasReport', totalHoras.toFixed(1) + 'h');
                this.updateElement('totalCombustivelReport', totalCombustivel.toFixed(1) + 'L');
                this.updateElement('eficienciaMediaReport', eficienciaMedia.toFixed(1) + '%');
            }

            // EXISTING METHODS (continuing with all the other methods from the original code...)
            updateEquipmentGrids() {
                this.updateColhedorasGrid();
                this.updateTransbordosGrid();
                this.updateCaminhoesGrid();
            }

            updateColhedorasGrid() {
                const grid = document.getElementById('colhedorasGrid');
                if (!grid) return;

                const colhedoras = this.state.equipamentos.filter(eq => eq.tipo === 'colhedora');
                grid.innerHTML = '';

                if (colhedoras.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('colhedora');
                    return;
                }

                colhedoras.forEach(colhedora => {
                    const weekData = this.getEquipmentWeekData(colhedora.id, 'colhedoras');
                    const card = this.createEquipmentCard(colhedora, weekData, 'colhedora');
                    grid.appendChild(card);
                });
            }

            updateTransbordosGrid() {
                const grid = document.getElementById('transbordosGrid');
                if (!grid) return;

                const transbordos = this.state.equipamentos.filter(eq => eq.tipo === 'transbordo');
                grid.innerHTML = '';

                if (transbordos.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('transbordo');
                    return;
                }

                transbordos.forEach(transbordo => {
                    const weekData = this.getEquipmentWeekData(transbordo.id, 'transbordos');
                    const card = this.createEquipmentCard(transbordo, weekData, 'transbordo');
                    grid.appendChild(card);
                });
            }

            updateCaminhoesGrid() {
                const grid = document.getElementById('caminhoesGrid');
                if (!grid) return;

                const caminhoes = this.state.equipamentos.filter(eq => eq.tipo === 'caminhao');
                grid.innerHTML = '';

                if (caminhoes.length === 0) {
                    grid.innerHTML = this.getEmptyStateHTML('caminhao');
                    return;
                }

                caminhoes.forEach(caminhao => {
                    const weekData = this.getEquipmentWeekData(caminhao.id, 'caminhoes');
                    const card = this.createEquipmentCard(caminhao, weekData, 'caminhao');
                    grid.appendChild(card);
                });
            }

            createEquipmentCard(equipment, weekData, type) {
                const card = document.createElement('div');
                card.className = 'equipment-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all transform hover:scale-105';

                const stats = this.calculateEquipmentStatsFromWeekData(weekData, type);
                const statusColor = Math.random() > 0.8 ? 'red' : Math.random() > 0.5 ? 'yellow' : 'green';
                const statusText = statusColor === 'green' ? 'Operando' : statusColor === 'yellow' ? 'Manutenção' : 'Parado';

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center mr-3">
                                <i class="fas fa-${this.getEquipmentIcon(type)} text-xl text-primary"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 dark:text-white">${equipment.nome}</h4>
                                <p class="text-sm text-gray-500">${equipment.marca} ${equipment.modelo}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full bg-${statusColor}-100 text-${statusColor}-800 dark:bg-${statusColor}-900 dark:text-${statusColor}-200">
                            ${statusText}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-primary">${stats.production}</div>
                            <div class="text-xs text-gray-500">Produção (t)</div>
                        </div>
                        <div class="text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="text-2xl font-bold text-secondary">${stats.hours}</div>
                            <div class="text-xs text-gray-500">Horas</div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            ${equipment.localizacao || 'Não definido'}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="app.viewEquipmentDetails(${equipment.id})" class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="app.editEquipment(${equipment.id})" class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `;

                return card;
            }

            updateEquipmentList() {
                const list = document.getElementById('equipmentList');
                if (!list) return;

                list.innerHTML = '';

                if (this.state.equipamentos.length === 0) {
                    list.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-plus-circle text-4xl mb-4 opacity-50"></i>
                            <p>Nenhum equipamento cadastrado</p>
                            <p class="text-sm">Use o formulário para adicionar equipamentos</p>
                        </div>
                    `;
                    return;
                }

                this.state.equipamentos.forEach(equipment => {
                    const item = document.createElement('div');
                    item.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors';
                    
                    item.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-${this.getEquipmentIcon(equipment.tipo)} text-primary"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900 dark:text-white">${equipment.nome}</div>
                                    <div class="text-sm text-gray-500">${equipment.marca} ${equipment.modelo}</div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="app.viewEquipmentDetails(${equipment.id})" class="text-blue-600 hover:text-blue-800 transition-colors">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="app.editEquipment(${equipment.id})" class="text-green-600 hover:text-green-800 transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="app.deleteEquipment(${equipment.id})" class="text-red-600 hover:text-red-800 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    list.appendChild(item);
                });
            }

            // NOVA FUNÇÃO: updateRecordsTab - Atualiza a aba de registros
            updateRecordsTab() {
                this.updateRecordsStats();
                this.updateRecordsFilters();
                this.updateRecordsList();
            }

            updateRecordsStats() {
                const today = new Date();
                const weekStart = this.getWeekStart(today);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const allRecords = this.getAllRecords();
                
                const totalRecords = allRecords.length;
                const weekRecords = allRecords.filter(record => {
                    const recordDate = new Date(record.timestamp);
                    return recordDate >= weekStart && recordDate <= weekEnd;
                }).length;
                
                const todayRecords = allRecords.filter(record => {
                    const recordDate = new Date(record.timestamp);
                    return recordDate.toDateString() === today.toDateString();
                }).length;
                
                this.updateElement('statsTotal', totalRecords);
                this.updateElement('statsWeek', weekRecords);
                this.updateElement('statsToday', todayRecords);
                this.updateElement('statsFiltered', this.getFilteredRecords().length);
            }

            updateRecordsFilters() {
                const filterEquipamento = document.getElementById('filterEquipamento');
                if (filterEquipamento) {
                    filterEquipamento.innerHTML = '<option value="">Todos os Equipamentos</option>';
                    this.state.equipamentos.forEach(eq => {
                        const option = document.createElement('option');
                        option.value = eq.id;
                        option.textContent = eq.nome;
                        filterEquipamento.appendChild(option);
                    });
                }
            }

            updateRecordsList() {
                const container = document.getElementById('recordsContainer');
                if (!container) return;

                const filteredRecords = this.getFilteredRecords();
                const { currentPage, recordsPerPage } = this.state.pagination;
                
                // Calculate pagination
                const totalRecords = filteredRecords.length;
                const totalPages = Math.ceil(totalRecords / recordsPerPage);
                const startIndex = (currentPage - 1) * recordsPerPage;
                const endIndex = Math.min(startIndex + recordsPerPage, totalRecords);
                const currentRecords = filteredRecords.slice(startIndex, endIndex);

                // Update pagination info
                this.updateElement('paginationInfo', `${startIndex + 1}-${endIndex} de ${totalRecords}`);
                this.updateElement('statsFiltered', totalRecords);

                container.innerHTML = '';

                if (currentRecords.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-search text-4xl mb-4 opacity-50"></i>
                            <p class="text-lg font-medium">Nenhum registro encontrado</p>
                            <p class="text-sm">Tente ajustar os filtros ou adicionar novos registros</p>
                        </div>
                    `;
                } else {
                    currentRecords.forEach(record => {
                        const recordElement = this.createRecordElement(record);
                        container.appendChild(recordElement);
                    });
                }

                this.updatePaginationButtons(totalPages);
            }

            createRecordElement(record) {
                const div = document.createElement('div');
                div.className = 'record-item bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all';

                const equipment = this.state.equipamentos.find(eq => eq.id === record.equipamentoId);
                const equipmentName = equipment ? equipment.nome : (record.frente || 'N/A');
                
                const typeInfo = this.getRecordTypeInfo(record);
                const dateStr = this.formatDateTimeBR(new Date(record.timestamp));

                div.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 ${typeInfo.bgColor} rounded-lg flex items-center justify-center">
                                <i class="fas fa-${typeInfo.icon} text-lg ${typeInfo.textColor}"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 dark:text-white">${equipmentName}</h4>
                                <p class="text-sm text-gray-500">${typeInfo.label} • ${dateStr}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${typeInfo.badgeColor}">
                                ${typeInfo.type}
                            </span>
                            <div class="flex space-x-1">
                                <button onclick="app.editRecord('${record.dataType}', ${record.id})" class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors" title="Editar">
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                                <button onclick="app.deleteRecord('${record.dataType}', ${record.id})" class="p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" title="Excluir">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                                <button onclick="app.duplicateRecord('${record.dataType}', ${record.id})" class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors" title="Duplicar">
                                    <i class="fas fa-copy text-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        ${this.getRecordDetailsHTML(record)}
                    </div>
                `;

                return div;
            }

            getRecordTypeInfo(record) {
                if (record.dataType === 'moagem') {
                    return {
                        type: 'Moagem',
                        label: 'Produção Industrial',
                        icon: 'industry',
                        bgColor: 'bg-indigo-100 dark:bg-indigo-900/30',
                        textColor: 'text-indigo-600',
                        badgeColor: 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200'
                    };
                }

                const typeMap = {
                    colhedoras: {
                        producao: { type: 'Produção', label: 'Colheita', icon: 'wheat-awn' },
                        horas: { type: 'Horas', label: 'Tempo Operação', icon: 'clock' },
                        consumo: { type: 'Consumo', label: 'Fluidos', icon: 'gas-pump' }
                    },
                    transbordos: {
                        operacao: { type: 'Operação', label: 'Transporte', icon: 'truck' },
                        consumo: { type: 'Consumo', label: 'Fluidos', icon: 'gas-pump' }
                    },
                    caminhoes: {
                        operacao: { type: 'Operação', label: 'Transporte', icon: 'truck-moving' },
                        consumo: { type: 'Consumo', label: 'Combustível', icon: 'gas-pump' }
                    }
                };

                const colorMap = {
                    colhedoras: {
                        bgColor: 'bg-green-100 dark:bg-green-900/30',
                        textColor: 'text-green-600',
                        badgeColor: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                    },
                    transbordos: {
                        bgColor: 'bg-blue-100 dark:bg-blue-900/30',
                        textColor: 'text-blue-600',
                        badgeColor: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                    },
                    caminhoes: {
                        bgColor: 'bg-amber-100 dark:bg-amber-900/30',
                        textColor: 'text-amber-600',
                        badgeColor: 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200'
                    }
                };

                const typeInfo = typeMap[record.dataType]?.[record.tipo] || 
                    { type: 'Registro', label: 'Operação', icon: 'cog' };
                const colors = colorMap[record.dataType] || {
                    bgColor: 'bg-gray-100 dark:bg-gray-700',
                    textColor: 'text-gray-600',
                    badgeColor: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'
                };

                return { ...typeInfo, ...colors };
            }

            getRecordDetailsHTML(record) {
                if (record.dataType === 'moagem') {
                    const metaPercent = record.meta ? ((record.producao / record.meta) * 100).toFixed(1) : 'N/A';
                    return `
                        <div><span class="text-gray-500">Frente:</span> <span class="font-medium">${record.frente}</span></div>
                        <div><span class="text-gray-500">Produção:</span> <span class="font-medium">${record.producao?.toFixed(1) || 0}t</span></div>
                        <div><span class="text-gray-500">Meta:</span> <span class="font-medium">${metaPercent}%</span></div>
                        <div><span class="text-gray-500">Observações:</span> <span class="font-medium">${record.observacoes || 'N/A'}</span></div>
                    `;
                }

                if (record.dataType === 'colhedoras') {
                    if (record.tipo === 'producao') {
                        return `
                            <div><span class="text-gray-500">Produção:</span> <span class="font-medium">${record.producao?.toFixed(1) || 0}t</span></div>
                        `;
                    } else if (record.tipo === 'horas') {
                        return `
                            <div><span class="text-gray-500">H. Motor:</span> <span class="font-medium">${record.horasMotor?.toFixed(1) || 0}h</span></div>
                            <div><span class="text-gray-500">H. Elevador:</span> <span class="font-medium">${record.horasElevador?.toFixed(1) || 0}h</span></div>
                        `;
                    } else if (record.tipo === 'consumo') {
                        return `
                            <div><span class="text-gray-500">Combustível:</span> <span class="font-medium">${record.consumoCombustivel?.toFixed(1) || 0}L</span></div>
                            <div><span class="text-gray-500">Hidráulico:</span> <span class="font-medium">${record.consumoHidraulico?.toFixed(1) || 0}L</span></div>
                            <div><span class="text-gray-500">Lubrificantes:</span> <span class="font-medium">${record.consumoLubrificantes?.toFixed(1) || 0}L</span></div>
                        `;
                    }
                }

                if (record.dataType === 'transbordos') {
                    if (record.tipo === 'operacao') {
                        return `
                            <div><span class="text-gray-500">Carga:</span> <span class="font-medium">${record.producaoTrator?.toFixed(1) || 0}t</span></div>
                            <div><span class="text-gray-500">Viagens:</span> <span class="font-medium">${record.viagens || 0}</span></div>
                            <div><span class="text-gray-500">Horas:</span> <span class="font-medium">${record.horas?.toFixed(1) || 0}h</span></div>
                            <div><span class="text-gray-500">Distância:</span> <span class="font-medium">${record.distanciaPercorrida?.toFixed(1) || 0}km</span></div>
                        `;
                    } else if (record.tipo === 'consumo') {
                        return `
                            <div><span class="text-gray-500">Diesel:</span> <span class="font-medium">${record.consumoDiesel?.toFixed(1) || 0}L</span></div>
                            <div><span class="text-gray-500">Hidráulico:</span> <span class="font-medium">${record.consumoHidraulico?.toFixed(1) || 0}L</span></div>
                        `;
                    }
                }

                if (record.dataType === 'caminhoes') {
                    if (record.tipo === 'operacao') {
                        return `
                            <div><span class="text-gray-500">Carga:</span> <span class="font-medium">${record.producao?.toFixed(1) || 0}t</span></div>
                            <div><span class="text-gray-500">Distância:</span> <span class="font-medium">${record.distancia?.toFixed(1) || 0}km</span></div>
                            <div><span class="text-gray-500">Horas:</span> <span class="font-medium">${record.horas?.toFixed(1) || 0}h</span></div>
                            <div><span class="text-gray-500">Viagens:</span> <span class="font-medium">${record.viagens || 0}</span></div>
                        `;
                    } else if (record.tipo === 'consumo') {
                        return `
                            <div><span class="text-gray-500">Combustível:</span> <span class="font-medium">${record.consumoCombustivel?.toFixed(1) || 0}L</span></div>
                        `;
                    }
                }

                return '<div><span class="text-gray-500">Sem detalhes</span></div>';
            }

            getAllRecords() {
                const allRecords = [];
                
                this.state.colhedorasData.forEach(record => {
                    allRecords.push({ ...record, dataType: 'colhedoras' });
                });
                
                this.state.transbordosData.forEach(record => {
                    allRecords.push({ ...record, dataType: 'transbordos' });
                });
                
                this.state.caminhoesData.forEach(record => {
                    allRecords.push({ ...record, dataType: 'caminhoes' });
                });
                
                this.state.moagemData.forEach(record => {
                    allRecords.push({ ...record, dataType: 'moagem' });
                });

                return allRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }

            getFilteredRecords() {
                const allRecords = this.getAllRecords();
                const filters = this.state.filters;

                return allRecords.filter(record => {
                    // Filtro por tipo
                    if (filters.tipo && record.dataType !== filters.tipo) {
                        return false;
                    }

                    // Filtro por equipamento
                    if (filters.equipamento && record.equipamentoId && record.equipamentoId.toString() !== filters.equipamento) {
                        return false;
                    }

                    // Filtro por data inicial
                    if (filters.dataInicio) {
                        const recordDate = new Date(record.timestamp);
                        const startDate = new Date(filters.dataInicio);
                        if (recordDate < startDate) {
                            return false;
                        }
                    }

                    // Filtro por data final
                    if (filters.dataFim) {
                        const recordDate = new Date(record.timestamp);
                        const endDate = new Date(filters.dataFim);
                        endDate.setHours(23, 59, 59, 999);
                        if (recordDate > endDate) {
                            return false;
                        }
                    }

                    // Filtro por texto (busca em todos os campos)
                    if (filters.search) {
                        const searchTerm = filters.search.toLowerCase();
                        const equipment = this.state.equipamentos.find(eq => eq.id === record.equipamentoId);
                        const equipmentName = equipment ? equipment.nome.toLowerCase() : '';
                        const frente = record.frente ? record.frente.toLowerCase() : '';
                        const observacoes = record.observacoes ? record.observacoes.toLowerCase() : '';
                        
                        const searchableText = `${equipmentName} ${frente} ${observacoes} ${record.tipo || ''}`.toLowerCase();
                        
                        if (!searchableText.includes(searchTerm)) {
                            return false;
                        }
                    }

                    return true;
                });
            }

            updatePaginationButtons(totalPages) {
                const container = document.getElementById('paginationButtons');
                if (!container) return;

                container.innerHTML = '';

                const { currentPage } = this.state.pagination;

                // Botão anterior
                const prevButton = document.createElement('button');
                prevButton.className = 'pagination-button';
                prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevButton.disabled = currentPage === 1;
                prevButton.onclick = () => this.changePage(currentPage - 1);
                container.appendChild(prevButton);

                // Botões de páginas
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);

                if (startPage > 1) {
                    const firstButton = document.createElement('button');
                    firstButton.className = 'pagination-button';
                    firstButton.textContent = '1';
                    firstButton.onclick = () => this.changePage(1);
                    container.appendChild(firstButton);

                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'px-3 py-2 text-gray-500';
                        ellipsis.textContent = '...';
                        container.appendChild(ellipsis);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    const button = document.createElement('button');
                    button.className = `pagination-button ${i === currentPage ? 'active' : ''}`;
                    button.textContent = i;
                    button.onclick = () => this.changePage(i);
                    container.appendChild(button);
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'px-3 py-2 text-gray-500';
                        ellipsis.textContent = '...';
                        container.appendChild(ellipsis);
                    }

                    const lastButton = document.createElement('button');
                    lastButton.className = 'pagination-button';
                    lastButton.textContent = totalPages;
                    lastButton.onclick = () => this.changePage(totalPages);
                    container.appendChild(lastButton);
                }

                // Botão próximo
                const nextButton = document.createElement('button');
                nextButton.className = 'pagination-button';
                nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextButton.disabled = currentPage === totalPages || totalPages === 0;
                nextButton.onclick = () => this.changePage(currentPage + 1);
                container.appendChild(nextButton);
            }

            changePage(page) {
                const totalRecords = this.getFilteredRecords().length;
                const totalPages = Math.ceil(totalRecords / this.state.pagination.recordsPerPage);
                
                if (page >= 1 && page <= totalPages) {
                    this.state.pagination.currentPage = page;
                    this.updateRecordsList();
                }
            }

            // MOAGEM METHODS
            updateMoagemSummary() {
                const weekData = this.getWeekData();
                this.updateMoagemMetrics(weekData);
            }

            updateMoagemGrid() {
                const tableBody = document.getElementById('moagemTableBody');
                if (!tableBody) return;

                const filtroFrente = document.getElementById('filtroFrente');
                const selectedFrente = filtroFrente ? filtroFrente.value : '';

                // Atualizar opções do filtro
                if (filtroFrente) {
                    const frentes = [...new Set(this.state.moagemData.map(data => data.frente))];
                    filtroFrente.innerHTML = '<option value="">Todas as Frentes</option>';
                    frentes.forEach(frente => {
                        const option = document.createElement('option');
                        option.value = frente;
                        option.textContent = frente;
                        option.selected = frente === selectedFrente;
                        filtroFrente.appendChild(option);
                    });
                }

                const filteredData = selectedFrente ? 
                    this.state.moagemData.filter(data => data.frente === selectedFrente) :
                    this.state.moagemData;

                const sortedData = filteredData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                tableBody.innerHTML = '';

                if (sortedData.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-industry text-4xl mb-4 opacity-50"></i>
                                <p>Nenhum registro de moagem encontrado</p>
                                <p class="text-sm">Adicione registros de produção das frentes</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                sortedData.slice(0, 20).forEach(data => {
                    const row = document.createElement('tr');
                    row.className = 'record-row hover:bg-gray-50 dark:hover:bg-gray-700';

                    const eficiencia = data.meta ? ((data.producao / data.meta) * 100).toFixed(1) : 'N/A';
                    const eficienciaClass = data.meta ? 
                        (data.producao / data.meta) >= 1 ? 'text-green-600' :
                        (data.producao / data.meta) >= 0.9 ? 'text-yellow-600' : 'text-red-600'
                        : 'text-gray-600';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                            ${this.formatDateBR(new Date(data.timestamp))}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200">
                                ${data.frente}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
                            ${data.producao?.toFixed(1) || 0}t
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${eficienciaClass}">
                            ${eficiencia}${data.meta ? '%' : ''}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400 max-w-xs truncate">
                            ${data.observacoes || 'Sem observações'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="app.editRecord('moagem', ${data.id})" class="text-green-600 hover:text-green-900 transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="app.deleteRecord('moagem', ${data.id})" class="text-red-600 hover:text-red-900 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;

                    tableBody.appendChild(row);
                });
            }

            // WEEK NAVIGATION METHODS
            getWeekStart(date) {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                const weekStart = new Date(d.setDate(diff));
                weekStart.setHours(0, 0, 0, 0);
                return weekStart;
            }

            setCurrentWeek() {
                const now = new Date();
                this.state.currentWeekStart = this.getWeekStart(now);
                this.updateWeekDisplay();
            }

            updateWeekDisplay() {
                const weekStart = this.state.currentWeekStart;
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const weekNumber = this.getWeekNumber(weekStart);
                const year = weekStart.getFullYear();
                
                this.updateElement('currentWeek', `Semana ${weekNumber}/${year}`);
                
                const today = new Date();
                const daysInWeek = Math.min(7, Math.floor((today - weekStart) / (24 * 60 * 60 * 1000)) + 1);
                this.updateElement('weekProgress', `${Math.max(0, daysInWeek)} de 7 dias`);
            }

            getWeekNumber(date) {
                const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
                const dayNum = d.getUTCDay() || 7;
                d.setUTCDate(d.getUTCDate() + 4 - dayNum);
                const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
                return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            }

            getWeekData() {
                const weekStart = this.state.currentWeekStart;
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);

                return {
                    colhedoras: this.state.colhedorasData.filter(data => {
                        const dataDate = new Date(data.timestamp);
                        return dataDate >= weekStart && dataDate <= weekEnd;
                    }),
                    transbordos: this.state.transbordosData.filter(data => {
                        const dataDate = new Date(data.timestamp);
                        return dataDate >= weekStart && dataDate <= weekEnd;
                    }),
                    caminhoes: this.state.caminhoesData.filter(data => {
                        const dataDate = new Date(data.timestamp);
                        return dataDate >= weekStart && dataDate <= weekEnd;
                    }),
                    moagem: this.state.moagemData.filter(data => {
                        const dataDate = new Date(data.timestamp);
                        return dataDate >= weekStart && dataDate <= weekEnd;
                    })
                };
            }

            getEquipmentWeekData(equipmentId, dataType) {
                const weekData = this.getWeekData();
                return weekData[dataType].filter(data => data.equipamentoId === equipmentId);
            }

            calculateEquipmentStatsFromWeekData(weekData, type) {
                let production = 0;
                let hours = 0;

                if (type === 'colhedora') {
                    weekData.forEach(data => {
                        if (data.tipo === 'producao') production += data.producao || 0;
                        if (data.tipo === 'horas') hours += data.horasMotor || 0;
                    });
                } else if (type === 'transbordo') {
                    weekData.forEach(data => {
                        if (data.tipo === 'operacao') {
                            production += data.producaoTrator || 0;
                            hours += data.horas || 0;
                        }
                    });
                } else if (type === 'caminhao') {
                    weekData.forEach(data => {
                        if (data.tipo === 'operacao') {
                            production += data.producao || 0;
                            hours += data.horas || 0;
                        }
                    });
                }

                return {
                    production: production.toFixed(1),
                    hours: hours.toFixed(1)
                };
            }

            // UTILITY METHODS
            updateElement(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }

            getEquipmentIcon(type) {
                const icons = {
                    colhedora: 'wheat-awn',
                    transbordo: 'truck',
                    caminhao: 'truck-moving'
                };
                return icons[type] || 'cog';
            }

            getEmptyStateHTML(type) {
                const typeNames = {
                    colhedora: 'colhedoras',
                    transbordo: 'transbordos',
                    caminhao: 'caminhões'
                };
                const typeName = typeNames[type] || 'equipamentos';

                return `
                    <div class="col-span-full text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-${this.getEquipmentIcon(type)} text-6xl mb-4 opacity-30"></i>
                        <h3 class="text-lg font-medium mb-2">Nenhuma ${typeName} cadastrada</h3>
                        <p class="text-sm">Cadastre equipamentos na aba "Cadastro" para começar</p>
                        <button onclick="showTab('cadastro', document.querySelector('[onclick*=\"cadastro\"]'))" class="mt-4 btn-primary">
                            <i class="fas fa-plus mr-2"></i>Cadastrar Agora
                        </button>
                    </div>
                `;
            }

            updateTabCounts() {
                this.updateElement('colhedorasCount', this.state.equipamentos.filter(eq => eq.tipo === 'colhedora').length);
                this.updateElement('transbordosCount', this.state.equipamentos.filter(eq => eq.tipo === 'transbordo').length);
                this.updateElement('caminhoesCount', this.state.equipamentos.filter(eq => eq.tipo === 'caminhao').length);
                this.updateElement('moagemCount', this.state.moagemData.length);
                this.updateElement('registrosCount', this.getAllRecords().length);
            }

            // NOTIFICATION SYSTEM
            addNotification(message, type = 'info', persistent = false) {
                const notification = {
                    id: Date.now(),
                    message,
                    type,
                    timestamp: new Date(),
                    read: false,
                    persistent
                };

                this.state.notifications.unshift(notification);
                this.updateNotificationBadge();
                this.updateNotificationList();
            }

            showNotification(message, type = 'info', duration = 5000) {
                const container = document.getElementById('notificationContainer');
                if (!container) return;

                const notification = document.createElement('div');
                notification.className = `notification bg-white dark:bg-gray-800 border-l-4 rounded-lg shadow-lg p-4 mb-4 transform transition-all duration-300 ${this.getNotificationBorderColor(type)}`;

                notification.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-${this.getNotificationIcon(type)} text-lg ${this.getNotificationTextColor(type)}"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${message}</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                container.appendChild(notification);

                // Animate in
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);

                // Auto remove
                if (duration > 0) {
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.classList.remove('show');
                            setTimeout(() => {
                                if (notification.parentElement) {
                                    notification.remove();
                                }
                            }, 400);
                        }
                    }, duration);
                }

                this.addNotification(message, type);
            }

            getNotificationIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                return icons[type] || 'info-circle';
            }

            getNotificationBorderColor(type) {
                const colors = {
                    success: 'border-green-500',
                    error: 'border-red-500',
                    warning: 'border-yellow-500',
                    info: 'border-blue-500'
                };
                return colors[type] || 'border-blue-500';
            }

            getNotificationTextColor(type) {
                const colors = {
                    success: 'text-green-500',
                    error: 'text-red-500',
                    warning: 'text-yellow-500',
                    info: 'text-blue-500'
                };
                return colors[type] || 'text-blue-500';
            }

            updateNotificationBadge() {
                const badge = document.getElementById('notificationBadge');
                const unreadCount = this.state.notifications.filter(n => !n.read).length;
                
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            }

            updateNotificationList() {
                const list = document.getElementById('notificationList');
                if (!list) return;

                list.innerHTML = '';

                if (this.state.notifications.length === 0) {
                    list.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-bell-slash text-4xl mb-4 opacity-50"></i>
                            <p>Nenhuma notificação</p>
                        </div>
                    `;
                    return;
                }

                this.state.notifications.slice(0, 20).forEach(notification => {
                    const item = document.createElement('div');
                    item.className = `p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${!notification.read ? 'bg-blue-50 dark:bg-blue-900/20' : ''}`;

                    item.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-${this.getNotificationIcon(notification.type)} ${this.getNotificationTextColor(notification.type)}"></i>
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="text-sm text-gray-900 dark:text-white">${notification.message}</p>
                                <p class="text-xs text-gray-500 mt-1">${this.formatDateTimeBR(notification.timestamp)}</p>
                            </div>
                            ${!notification.read ? '<div class="w-2 h-2 bg-blue-500 rounded-full"></div>' : ''}
                        </div>
                    `;

                    item.onclick = () => {
                        if (!notification.read) {
                            notification.read = true;
                            this.updateNotificationBadge();
                            this.updateNotificationList();
                        }
                    };

                    list.appendChild(item);
                });
            }

            // REAL-TIME UPDATES
            startRealTimeUpdates() {
                // Update time display
                setInterval(() => {
                    const now = new Date();
                    this.updateElement('currentDate', this.formatDateBR(now));
                    this.updateElement('currentTime', now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }));
                }, 1000);

                // Periodic dashboard refresh
                setInterval(() => {
                    this.updateDashboard();
                }, this.state.settings.refreshInterval);
            }

            // THEME MANAGEMENT
            setupTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                this.state.settings.theme = isDark ? 'dark' : 'light';
                
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) {
                    themeIcon.className = `fas fa-${isDark ? 'sun' : 'moon'} text-lg`;
                }
            }

            // EVENT LISTENERS SETUP
            setupEventListeners() {
                // Equipment form submission
                const equipmentForm = document.getElementById('equipmentForm');
                if (equipmentForm) {
                    equipmentForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleEquipmentSubmit();
                    });
                }

                // Search functionality for equipment list
                const equipmentSearch = document.getElementById('equipmentListSearch');
                if (equipmentSearch) {
                    equipmentSearch.addEventListener('input', () => {
                        this.filterEquipmentList();
                    });
                }

                // Close modals on overlay click
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'modalOverlay') {
                        this.closeModal();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                        this.closeNotificationCenter();
                        this.closeExpandedChart();
                    }
                });

                // Close export menus when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.export-menu') && !e.target.closest('[onclick*="toggleExportMenu"]')) {
                        document.querySelectorAll('.export-menu').forEach(menu => {
                            menu.classList.remove('show');
                        });
                    }
                });
            }

            // FORM HANDLERS
            handleEquipmentSubmit() {
                const form = document.getElementById('equipmentForm');
                const formData = new FormData(form);
                
                const equipment = {
                    id: Date.now(),
                    tipo: document.getElementById('tipoEquipamento').value,
                    nome: document.getElementById('nomeEquipamento').value,
                    marca: document.getElementById('marcaEquipamento').value,
                    modelo: document.getElementById('modeloEquipamento').value,
                    ano: parseInt(document.getElementById('anoEquipamento').value) || null,
                    placa: document.getElementById('placaEquipamento').value,
                    localizacao: document.getElementById('localizacaoEquipamento').value,
                    status: 'Ativo',
                    createdAt: new Date()
                };

                if (!equipment.nome || !equipment.marca || !equipment.modelo) {
                    this.showNotification('Por favor, preencha todos os campos obrigatórios', 'error');
                    return;
                }

                this.state.equipamentos.push(equipment);
                this.saveData();
                this.updateEquipmentList();
                this.updateTabCounts();
                this.updateRecordsFilters();
                
                form.reset();
                this.showNotification(`Equipamento "${equipment.nome}" cadastrado com sucesso!`, 'success');
            }

            filterEquipmentList() {
                const searchTerm = document.getElementById('equipmentListSearch').value.toLowerCase();
                const items = document.querySelectorAll('#equipmentList > div');
                
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            }

            // MODAL MANAGEMENT
            openModal(content) {
                const overlay = document.getElementById('modalOverlay');
                const modalContent = document.getElementById('modalContent');
                
                if (overlay && modalContent) {
                    modalContent.innerHTML = content;
                    overlay.classList.remove('hidden');
                    overlay.classList.add('flex');
                    document.body.style.overflow = 'hidden';
                }
            }

            closeModal() {
                const overlay = document.getElementById('modalOverlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                    document.body.style.overflow = 'auto';
                }
            }

            // CRUD OPERATIONS
            editEquipment(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (!equipment) return;

                const modalContent = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Editar Equipamento</h3>
                            <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="editEquipmentForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo</label>
                                    <select id="editTipo" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                        <option value="colhedora" ${equipment.tipo === 'colhedora' ? 'selected' : ''}>Colhedora</option>
                                        <option value="transbordo" ${equipment.tipo === 'transbordo' ? 'selected' : ''}>Transbordo</option>
                                        <option value="caminhao" ${equipment.tipo === 'caminhao' ? 'selected' : ''}>Caminhão</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome</label>
                                    <input type="text" id="editNome" value="${equipment.nome}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Marca</label>
                                    <input type="text" id="editMarca" value="${equipment.marca}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Modelo</label>
                                    <input type="text" id="editModelo" value="${equipment.modelo}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ano</label>
                                    <input type="number" id="editAno" value="${equipment.ano || ''}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Placa</label>
                                    <input type="text" id="editPlaca" value="${equipment.placa || ''}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Localização</label>
                                <input type="text" id="editLocalizacao" value="${equipment.localizacao || ''}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <div class="flex justify-end space-x-3 pt-4">
                                <button type="button" onclick="app.closeModal()" class="btn-secondary">Cancelar</button>
                                <button type="submit" class="btn-primary">Salvar Alterações</button>
                            </div>
                        </form>
                    </div>
                `;

                this.openModal(modalContent);

                // Setup form handler
                const editForm = document.getElementById('editEquipmentForm');
                editForm.onsubmit = (e) => {
                    e.preventDefault();
                    this.updateEquipment(id);
                };
            }

            updateEquipment(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (!equipment) return;

                equipment.tipo = document.getElementById('editTipo').value;
                equipment.nome = document.getElementById('editNome').value;
                equipment.marca = document.getElementById('editMarca').value;
                equipment.modelo = document.getElementById('editModelo').value;
                equipment.ano = parseInt(document.getElementById('editAno').value) || null;
                equipment.placa = document.getElementById('editPlaca').value;
                equipment.localizacao = document.getElementById('editLocalizacao').value;

                this.saveData();
                this.updateEquipmentList();
                this.updateDashboard();
                this.closeModal();
                this.showNotification(`Equipamento "${equipment.nome}" atualizado com sucesso!`, 'success');
            }

            deleteEquipment(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (!equipment) return;

                if (confirm(`Tem certeza que deseja excluir "${equipment.nome}"? Esta ação não pode ser desfeita.`)) {
                    this.state.equipamentos = this.state.equipamentos.filter(eq => eq.id !== id);
                    
                    // Remove related operational data
                    this.state.colhedorasData = this.state.colhedorasData.filter(data => data.equipamentoId !== id);
                    this.state.transbordosData = this.state.transbordosData.filter(data => data.equipamentoId !== id);
                    this.state.caminhoesData = this.state.caminhoesData.filter(data => data.equipamentoId !== id);
                    
                    this.saveData();
                    this.updateEquipmentList();
                    this.updateDashboard();
                    this.updateTabCounts();
                    this.showNotification(`Equipamento "${equipment.nome}" excluído com sucesso!`, 'success');
                }
            }

            viewEquipmentDetails(id) {
                const equipment = this.state.equipamentos.find(eq => eq.id === id);
                if (!equipment) return;

                const weekData = this.getEquipmentWeekData(id, equipment.tipo + 's');
                const stats = this.calculateEquipmentStatsFromWeekData(weekData, equipment.tipo);

                const modalContent = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Detalhes do Equipamento</h3>
                            <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6 mb-6">
                            <div class="flex items-center mb-4">
                                <div class="w-16 h-16 bg-primary/10 rounded-xl flex items-center justify-center mr-4">
                                    <i class="fas fa-${this.getEquipmentIcon(equipment.tipo)} text-2xl text-primary"></i>
                                </div>
                                <div>
                                    <h4 class="text-xl font-bold text-gray-900 dark:text-white">${equipment.nome}</h4>
                                    <p class="text-gray-600 dark:text-gray-400">${equipment.marca} ${equipment.modelo}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="text-sm text-gray-500">Tipo</label>
                                    <p class="font-semibold text-gray-900 dark:text-white capitalize">${equipment.tipo}</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">Ano</label>
                                    <p class="font-semibold text-gray-900 dark:text-white">${equipment.ano || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">Placa</label>
                                    <p class="font-semibold text-gray-900 dark:text-white">${equipment.placa || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">Localização</label>
                                    <p class="font-semibold text-gray-900 dark:text-white">${equipment.localizacao || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                                <h5 class="font-semibold text-gray-900 dark:text-white mb-3">Performance Semanal</h5>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Produção Total</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">${stats.production}t</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Horas Operadas</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">${stats.hours}h</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Registros</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">${weekData.length}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                                <h5 class="font-semibold text-gray-900 dark:text-white mb-3">Informações do Sistema</h5>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Cadastrado em</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">${this.formatDateBR(equipment.createdAt)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Status</span>
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                            ${equipment.status}
                                        </span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">ID Sistema</span>
                                        <span class="font-mono text-sm text-gray-900 dark:text-white">#${equipment.id}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button onclick="app.editEquipment(${equipment.id})" class="btn-secondary">
                                <i class="fas fa-edit mr-2"></i>Editar
                            </button>
                            <button onclick="app.closeModal()" class="btn-primary">Fechar</button>
                        </div>
                    </div>
                `;

                this.openModal(modalContent);
            }

            // RECORD CRUD OPERATIONS
            editRecord(dataType, recordId) {
                const dataArray = this.getDataArray(dataType);
                const record = dataArray.find(r => r.id === recordId);
                if (!record) return;

                const modalContent = this.getEditRecordModalContent(dataType, record);
                this.openModal(modalContent);
            }

            deleteRecord(dataType, recordId) {
                const dataArray = this.getDataArray(dataType);
                const record = dataArray.find(r => r.id === recordId);
                if (!record) return;

                if (confirm('Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita.')) {
                    const index = dataArray.findIndex(r => r.id === recordId);
                    if (index !== -1) {
                        dataArray.splice(index, 1);
                        this.saveData();
                        this.updateDashboard();
                        this.updateRecordsTab();
                        this.showNotification('Registro excluído com sucesso!', 'success');
                    }
                }
            }

            duplicateRecord(dataType, recordId) {
                const dataArray = this.getDataArray(dataType);
                const record = dataArray.find(r => r.id === recordId);
                if (!record) return;

                const newRecord = {
                    ...record,
                    id: Date.now() + Math.random() * 1000,
                    timestamp: new Date()
                };

                dataArray.push(newRecord);
                this.saveData();
                this.updateDashboard();
                this.updateRecordsTab();
                this.showNotification('Registro duplicado com sucesso!', 'success');
            }

            getDataArray(dataType) {
                switch (dataType) {
                    case 'colhedoras': return this.state.colhedorasData;
                    case 'transbordos': return this.state.transbordosData;
                    case 'caminhoes': return this.state.caminhoesData;
                    case 'moagem': return this.state.moagemData;
                    default: return [];
                }
            }

            getEditRecordModalContent(dataType, record) {
                // This would return specific modal content based on record type
                // For brevity, returning a generic template
                return `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Editar Registro</h3>
                            <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-construction text-4xl mb-4 opacity-50"></i>
                            <p>Funcionalidade de edição em desenvolvimento</p>
                            <p class="text-sm mt-2">Em breve você poderá editar registros detalhadamente</p>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button onclick="app.closeModal()" class="btn-primary">Fechar</button>
                        </div>
                    </div>
                `;
            }
        }

        // Initialize the application
        const app = new AgroManagerApp();

        // GLOBAL FUNCTIONS (Called from HTML)
        function showTab(tabName, buttonElement) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked button
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            // Update charts if needed
            setTimeout(() => {
                if (tabName === 'relatorios') {
                    app.updateReports();
                }
            }, 100);
        }

        function previousWeek() {
            app.state.currentWeekStart.setDate(app.state.currentWeekStart.getDate() - 7);
            app.updateWeekDisplay();
            app.updateDashboard();
        }

        function nextWeek() {
            app.state.currentWeekStart.setDate(app.state.currentWeekStart.getDate() + 7);
            app.updateWeekDisplay();
            app.updateDashboard();
        }

        function goToCurrentWeek() {
            app.setCurrentWeek();
            app.updateDashboard();
        }

        function manualSave() {
            if (app.saveData()) {
                app.showNotification('Dados salvos manualmente com sucesso!', 'success');
            }
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            
            if (isDark) {
                document.documentElement.classList.remove('dark');
                app.state.settings.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                app.state.settings.theme = 'dark';
            }
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = `fas fa-${isDark ? 'moon' : 'sun'} text-lg`;
            }
            
            app.showNotification(`Tema alterado para ${app.state.settings.theme === 'dark' ? 'escuro' : 'claro'}`, 'info', 2000);
        }

        function openNotifications() {
            const center = document.getElementById('notificationCenter');
            if (center) {
                center.classList.add('show');
                app.updateNotificationList();
            }
        }

        function closeNotificationCenter() {
            const center = document.getElementById('notificationCenter');
            if (center) {
                center.classList.remove('show');
            }
        }

        function clearAllNotifications() {
            app.state.notifications = [];
            app.updateNotificationBadge();
            app.updateNotificationList();
            app.showNotification('Todas as notificações foram removidas', 'info', 2000);
        }

        function openSettings() {
            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Configurações do Sistema</h3>
                        <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Preferências Gerais</h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Auto-salvamento</label>
                                        <p class="text-xs text-gray-500">Salvar dados automaticamente a cada 30 segundos</p>
                                    </div>
                                    <input type="checkbox" ${app.state.settings.autoSave ? 'checked' : ''} class="rounded text-primary focus:ring-primary" onchange="app.state.settings.autoSave = this.checked">
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Notificações</label>
                                        <p class="text-xs text-gray-500">Receber notificações do sistema</p>
                                    </div>
                                    <input type="checkbox" ${app.state.settings.notifications ? 'checked' : ''} class="rounded text-primary focus:ring-primary" onchange="app.state.settings.notifications = this.checked">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Informações do Sistema</h4>
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Versão</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${app.state.version}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Última atualização</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${app.formatDateTimeBR(app.state.lastUpdate)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Total de equipamentos</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${app.state.equipamentos.length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Total de registros</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">${app.getAllRecords().length}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Gerenciamento de Dados</h4>
                            <div class="space-y-3">
                                <button onclick="exportAllData()" class="w-full btn-secondary">
                                    <i class="fas fa-download mr-2"></i>Exportar Todos os Dados
                                </button>
                                <button onclick="clearAllData()" class="w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
                                    <i class="fas fa-trash mr-2"></i>Limpar Todos os Dados
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="app.closeModal()" class="btn-primary">Fechar</button>
                    </div>
                </div>
            `;
            app.openModal(modalContent);
        }

        function toggleQuickActionMenu() {
            const menu = document.getElementById('quickActionMenu');
            const icon = document.getElementById('fabIcon');
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                setTimeout(() => {
                    menu.classList.remove('scale-95', 'opacity-0');
                    menu.classList.add('scale-100', 'opacity-100');
                }, 10);
                icon.style.transform = 'rotate(45deg)';
            } else {
                menu.classList.remove('scale-100', 'opacity-100');
                menu.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    menu.classList.add('hidden');
                }, 300);
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function closeQuickActionMenu() {
            const menu = document.getElementById('quickActionMenu');
            const icon = document.getElementById('fabIcon');
            
            menu.classList.remove('scale-100', 'opacity-100');
            menu.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                menu.classList.add('hidden');
            }, 300);
            icon.style.transform = 'rotate(0deg)';
        }

        // MODAL FUNCTIONS FOR EACH EQUIPMENT TYPE
        function openColhedoraModal() {
            const equipamentos = app.state.equipamentos.filter(eq => eq.tipo === 'colhedora');
            
            if (equipamentos.length === 0) {
                app.showNotification('Nenhuma colhedora cadastrada. Cadastre equipamentos primeiro.', 'warning');
                return;
            }

            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Novo Registro - Colhedora</h3>
                        <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="colhedoraForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                                <select id="colhedoraEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                    <option value="">Selecione uma colhedora</option>
                                    ${equipamentos.map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Registro *</label>
                                <select id="colhedoraTipo" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required onchange="updateColhedoraFields()">
                                    <option value="">Selecione o tipo</option>
                                    <option value="producao">Produção</option>
                                    <option value="horas">Horas de Operação</option>
                                    <option value="consumo">Consumo de Fluidos</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data e Hora *</label>
                            <input type="datetime-local" id="colhedoraTimestamp" value="${new Date().toISOString().slice(0, 16)}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                        </div>
                        
                        <div id="colhedoraFields" class="space-y-4">
                            <!-- Dynamic fields will be inserted here -->
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="app.closeModal()" class="btn-secondary">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Registro</button>
                        </div>
                    </form>
                </div>
            `;

            app.openModal(modalContent);

            // Setup form handler
            document.getElementById('colhedoraForm').onsubmit = (e) => {
                e.preventDefault();
                submitColhedoraRecord();
            };
        }

        function updateColhedoraFields() {
            const tipo = document.getElementById('colhedoraTipo').value;
            const fieldsContainer = document.getElementById('colhedoraFields');
            
            if (!fieldsContainer) return;

            let fieldsHTML = '';

            switch (tipo) {
                case 'producao':
                    fieldsHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Produção (toneladas) *</label>
                            <input type="number" step="0.1" min="0" id="colhedoraProducao" placeholder="Ex: 45.5" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                        </div>
                    `;
                    break;
                case 'horas':
                    fieldsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas do Motor *</label>
                                <input type="number" step="0.1" min="0" id="colhedoraHorasMotor" placeholder="Ex: 8.5" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas do Elevador *</label>
                                <input type="number" step="0.1" min="0" id="colhedoraHorasElevador" placeholder="Ex: 7.2" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                        </div>
                    `;
                    break;
                case 'consumo':
                    fieldsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Combustível (L) *</label>
                                <input type="number" step="0.1" min="0" id="colhedoraCombustivel" placeholder="Ex: 150.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Óleo Hidráulico (L)</label>
                                <input type="number" step="0.1" min="0" id="colhedoraHidraulico" placeholder="Ex: 5.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lubrificantes (L)</label>
                                <input type="number" step="0.1" min="0" id="colhedoraLubrificantes" placeholder="Ex: 2.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    `;
                    break;
            }

            fieldsContainer.innerHTML = fieldsHTML;
        }

        function submitColhedoraRecord() {
            const form = document.getElementById('colhedoraForm');
            const tipo = document.getElementById('colhedoraTipo').value;
            const equipamentoId = parseInt(document.getElementById('colhedoraEquipamento').value);
            const timestamp = new Date(document.getElementById('colhedoraTimestamp').value);

            const baseRecord = {
                tipo,
                equipamentoId,
                timestamp
            };

            let record = { ...baseRecord };

            switch (tipo) {
                case 'producao':
                    record.producao = parseFloat(document.getElementById('colhedoraProducao').value);
                    break;
                case 'horas':
                    record.horasMotor = parseFloat(document.getElementById('colhedoraHorasMotor').value);
                    record.horasElevador = parseFloat(document.getElementById('colhedoraHorasElevador').value);
                    break;
                case 'consumo':
                    record.consumoCombustivel = parseFloat(document.getElementById('colhedoraCombustivel').value);
                    record.consumoHidraulico = parseFloat(document.getElementById('colhedoraHidraulico').value) || 0;
                    record.consumoLubrificantes = parseFloat(document.getElementById('colhedoraLubrificantes').value) || 0;
                    break;
            }

            app.addOperationalData('colhedoras', record);
            app.closeModal();
            app.showNotification('Registro de colhedora salvo com sucesso!', 'success');
        }

        function openTransbordoModal() {
            const equipamentos = app.state.equipamentos.filter(eq => eq.tipo === 'transbordo');
            
            if (equipamentos.length === 0) {
                app.showNotification('Nenhum transbordo cadastrado. Cadastre equipamentos primeiro.', 'warning');
                return;
            }

            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Novo Registro - Transbordo</h3>
                        <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="transbordoForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                                <select id="transbordoEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                    <option value="">Selecione um transbordo</option>
                                    ${equipamentos.map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Registro *</label>
                                <select id="transbordoTipo" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required onchange="updateTransbordoFields()">
                                    <option value="">Selecione o tipo</option>
                                    <option value="operacao">Operação</option>
                                    <option value="consumo">Consumo</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data e Hora *</label>
                            <input type="datetime-local" id="transbordoTimestamp" value="${new Date().toISOString().slice(0, 16)}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                        </div>
                        
                        <div id="transbordoFields" class="space-y-4">
                            <!-- Dynamic fields will be inserted here -->
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="app.closeModal()" class="btn-secondary">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Registro</button>
                        </div>
                    </form>
                </div>
            `;

            app.openModal(modalContent);

            document.getElementById('transbordoForm').onsubmit = (e) => {
                e.preventDefault();
                submitTransbordoRecord();
            };
        }

        function updateTransbordoFields() {
            const tipo = document.getElementById('transbordoTipo').value;
            const fieldsContainer = document.getElementById('transbordoFields');
            
            if (!fieldsContainer) return;

            let fieldsHTML = '';

            switch (tipo) {
                case 'operacao':
                    fieldsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Produção do Trator (t) *</label>
                                <input type="number" step="0.1" min="0" id="transbordoProducao" placeholder="Ex: 25.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas Trabalhadas *</label>
                                <input type="number" step="0.1" min="0" id="transbordoHoras" placeholder="Ex: 6.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Número de Viagens *</label>
                                <input type="number" min="0" id="transbordoViagens" placeholder="Ex: 8" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Distância Percorrida (km)</label>
                                <input type="number" step="0.1" min="0" id="transbordoDistancia" placeholder="Ex: 45.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    `;
                    break;
                case 'consumo':
                    fieldsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Diesel (L) *</label>
                                <input type="number" step="0.1" min="0" id="transbordoDiesel" placeholder="Ex: 80.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Óleo Hidráulico (L)</label>
                                <input type="number" step="0.1" min="0" id="transbordoHidraulico" placeholder="Ex: 3.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    `;
                    break;
            }

            fieldsContainer.innerHTML = fieldsHTML;
        }

        function submitTransbordoRecord() {
            const tipo = document.getElementById('transbordoTipo').value;
            const equipamentoId = parseInt(document.getElementById('transbordoEquipamento').value);
            const timestamp = new Date(document.getElementById('transbordoTimestamp').value);

            const baseRecord = {
                tipo,
                equipamentoId,
                timestamp
            };

            let record = { ...baseRecord };

            switch (tipo) {
                case 'operacao':
                    record.producaoTrator = parseFloat(document.getElementById('transbordoProducao').value);
                    record.horas = parseFloat(document.getElementById('transbordoHoras').value);
                    record.viagens = parseInt(document.getElementById('transbordoViagens').value);
                    record.distanciaPercorrida = parseFloat(document.getElementById('transbordoDistancia').value) || 0;
                    break;
                case 'consumo':
                    record.consumoDiesel = parseFloat(document.getElementById('transbordoDiesel').value);
                    record.consumoHidraulico = parseFloat(document.getElementById('transbordoHidraulico').value) || 0;
                    break;
            }

            app.addOperationalData('transbordos', record);
            app.closeModal();
            app.showNotification('Registro de transbordo salvo com sucesso!', 'success');
        }

        function openCaminhaoModal() {
            const equipamentos = app.state.equipamentos.filter(eq => eq.tipo === 'caminhao');
            
            if (equipamentos.length === 0) {
                app.showNotification('Nenhum caminhão cadastrado. Cadastre equipamentos primeiro.', 'warning');
                return;
            }

            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Novo Registro - Caminhão</h3>
                        <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="caminhaoForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Equipamento *</label>
                                <select id="caminhaoEquipamento" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                    <option value="">Selecione um caminhão</option>
                                    ${equipamentos.map(eq => `<option value="${eq.id}">${eq.nome}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Registro *</label>
                                <select id="caminhaoTipo" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required onchange="updateCaminhaoFields()">
                                    <option value="">Selecione o tipo</option>
                                    <option value="operacao">Operação</option>
                                    <option value="consumo">Consumo</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data e Hora *</label>
                            <input type="datetime-local" id="caminhaoTimestamp" value="${new Date().toISOString().slice(0, 16)}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                        </div>
                        
                        <div id="caminhaoFields" class="space-y-4">
                            <!-- Dynamic fields will be inserted here -->
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="app.closeModal()" class="btn-secondary">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Registro</button>
                        </div>
                    </form>
                </div>
            `;

            app.openModal(modalContent);

            document.getElementById('caminhaoForm').onsubmit = (e) => {
                e.preventDefault();
                submitCaminhaoRecord();
            };
        }

        function updateCaminhaoFields() {
            const tipo = document.getElementById('caminhaoTipo').value;
            const fieldsContainer = document.getElementById('caminhaoFields');
            
            if (!fieldsContainer) return;

            let fieldsHTML = '';

            switch (tipo) {
                case 'operacao':
                    fieldsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Carga Transportada (t) *</label>
                                <input type="number" step="0.1" min="0" id="caminhaoProducao" placeholder="Ex: 35.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Horas Trabalhadas *</label>
                                <input type="number" step="0.1" min="0" id="caminhaoHoras" placeholder="Ex: 4.5" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Distância (km) *</label>
                                <input type="number" step="0.1" min="0" id="caminhaoDistancia" placeholder="Ex: 180.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Número de Viagens</label>
                                <input type="number" min="0" id="caminhaoViagens" placeholder="Ex: 2" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                    `;
                    break;
                case 'consumo':
                    fieldsHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Combustível (L) *</label>
                            <input type="number" step="0.1" min="0" id="caminhaoCombutivel" placeholder="Ex: 120.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                        </div>
                    `;
                    break;
            }

            fieldsContainer.innerHTML = fieldsHTML;
        }

        function submitCaminhaoRecord() {
            const tipo = document.getElementById('caminhaoTipo').value;
            const equipamentoId = parseInt(document.getElementById('caminhaoEquipamento').value);
            const timestamp = new Date(document.getElementById('caminhaoTimestamp').value);

            const baseRecord = {
                tipo,
                equipamentoId,
                timestamp
            };

            let record = { ...baseRecord };

            switch (tipo) {
                case 'operacao':
                    record.producao = parseFloat(document.getElementById('caminhaoProducao').value);
                    record.horas = parseFloat(document.getElementById('caminhaoHoras').value);
                    record.distancia = parseFloat(document.getElementById('caminhaoDistancia').value);
                    record.viagens = parseInt(document.getElementById('caminhaoViagens').value) || 1;
                    break;
                case 'consumo':
                    record.consumoCombustivel = parseFloat(document.getElementById('caminhaoCombutivel').value);
                    break;
            }

            app.addOperationalData('caminhoes', record);
            app.closeModal();
            app.showNotification('Registro de caminhão salvo com sucesso!', 'success');
        }

        function openMoagemModal() {
            const modalContent = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Novo Registro - Moagem</h3>
                        <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="moagemForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frente de Trabalho *</label>
                                <select id="moagemFrente" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                                    <option value="">Selecione a frente</option>
                                    <option value="Frente A">Frente A</option>
                                    <option value="Frente B">Frente B</option>
                                    <option value="Frente C">Frente C</option>
                                    <option value="Frente D">Frente D</option>
                                    <option value="Frente E">Frente E</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data e Hora *</label>
                                <input type="datetime-local" id="moagemTimestamp" value="${new Date().toISOString().slice(0, 16)}" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Produção (toneladas) *</label>
                                <input type="number" step="0.1" min="0" id="moagemProducao" placeholder="Ex: 65.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Meta (toneladas)</label>
                                <input type="number" step="0.1" min="0" id="moagemMeta" placeholder="Ex: 50.0" class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                            <textarea id="moagemObservacoes" rows="3" placeholder="Digite observações sobre a produção..." class="w-full text-base px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white resize-none"></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="app.closeModal()" class="btn-secondary">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Registro</button>
                        </div>
                    </form>
                </div>
            `;

            app.openModal(modalContent);

            document.getElementById('moagemForm').onsubmit = (e) => {
                e.preventDefault();
                submitMoagemRecord();
            };
        }

        function submitMoagemRecord() {
            const record = {
                frente: document.getElementById('moagemFrente').value,
                producao: parseFloat(document.getElementById('moagemProducao').value),
                meta: parseFloat(document.getElementById('moagemMeta').value) || 50,
                observacoes: document.getElementById('moagemObservacoes').value || '',
                timestamp: new Date(document.getElementById('moagemTimestamp').value)
            };

            app.addOperationalData('moagem', record);
            app.closeModal();
            app.showNotification('Registro de moagem salvo com sucesso!', 'success');
        }

        // FILTER FUNCTIONS
        function applyFilters() {
            app.state.filters = {
                tipo: document.getElementById('filterTipo').value,
                equipamento: document.getElementById('filterEquipamento').value,
                dataInicio: document.getElementById('filterDataInicio').value,
                dataFim: document.getElementById('filterDataFim').value,
                search: document.getElementById('filterSearch').value
            };

            app.state.pagination.currentPage = 1;
            app.updateRecordsList();
            app.showNotification('Filtros aplicados com sucesso!', 'info', 2000);
        }

        function clearFilters() {
            document.getElementById('filterTipo').value = '';
            document.getElementById('filterEquipamento').value = '';
            document.getElementById('filterDataInicio').value = '';
            document.getElementById('filterDataFim').value = '';
            document.getElementById('filterSearch').value = '';

            app.state.filters = {
                tipo: '',
                equipamento: '',
                dataInicio: '',
                dataFim: '',
                search: ''
            };

            app.state.pagination.currentPage = 1;
            app.updateRecordsList();
            app.showNotification('Filtros limpos!', 'info', 2000);
        }

        function updateRecordsPerPage() {
            const recordsPerPage = parseInt(document.getElementById('recordsPerPage').value);
            app.state.pagination.recordsPerPage = recordsPerPage;
            app.state.pagination.currentPage = 1;
            app.updateRecordsList();
        }

        function refreshRecords() {
            app.updateRecordsTab();
            app.showNotification('Registros atualizados!', 'info', 2000);
        }

        // EXPORT FUNCTIONS
        function toggleExportMenu(type) {
            const menu = document.getElementById(`exportMenu${type.charAt(0).toUpperCase() + type.slice(1)}`);
            if (menu) {
                menu.classList.toggle('show');
            }
        }

        function exportData(type, format) {
            let data = [];
            let filename = '';

            switch (type) {
                case 'colhedoras':
                    data = app.state.colhedorasData;
                    filename = 'colhedoras_data';
                    break;
                case 'transbordos':
                    data = app.state.transbordosData;
                    filename = 'transbordos_data';
                    break;
                case 'caminhoes':
                    data = app.state.caminhoesData;
                    filename = 'caminhoes_data';
                    break;
                case 'moagem':
                    data = app.state.moagemData;
                    filename = 'moagem_data';
                    break;
                case 'registros':
                    data = app.getAllRecords();
                    filename = 'todos_registros';
                    break;
            }

            if (data.length === 0) {
                app.showNotification('Nenhum dado para exportar', 'warning');
                return;
            }

            if (format === 'csv') {
                exportToCSV(data, filename);
            } else {
                app.showNotification(`Exportação em ${format.toUpperCase()} em desenvolvimento`, 'info');
            }

            // Close export menu
            document.querySelectorAll('.export-menu').forEach(menu => {
                menu.classList.remove('show');
            });
        }

        function exportToCSV(data, filename) {
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    let value = row[header];
                    if (value instanceof Date) {
                        value = app.formatDateTimeBR(value);
                    }
                    return `"${value}"`;
                }).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${filename}_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            app.showNotification('Dados exportados com sucesso!', 'success');
        }

        function exportAllRecords(format) {
            exportData('registros', format);
        }

        function exportEquipmentList(format) {
            if (app.state.equipamentos.length === 0) {
                app.showNotification('Nenhum equipamento para exportar', 'warning');
                return;
            }

            if (format === 'csv') {
                exportToCSV(app.state.equipamentos, 'equipamentos');
            } else {
                app.showNotification(`Exportação em ${format.toUpperCase()} em desenvolvimento`, 'info');
            }

            document.querySelectorAll('.export-menu').forEach(menu => {
                menu.classList.remove('show');
            });
        }

        function exportAllData() {
            const allData = {
                equipamentos: app.state.equipamentos,
                colhedorasData: app.state.colhedorasData,
                transbordosData: app.state.transbordosData,
                caminhoesData: app.state.caminhoesData,
                moagemData: app.state.moagemData,
                exportDate: new Date(),
                version: app.state.version
            };

            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `agromanager_backup_${new Date().getTime()}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            app.showNotification('Backup completo exportado com sucesso!', 'success');
        }

        function clearAllData() {
            if (confirm('⚠️ ATENÇÃO: Esta ação irá apagar TODOS os dados do sistema!\n\nIsso inclui:\n- Todos os equipamentos cadastrados\n- Todos os registros operacionais\n- Todas as configurações\n\nEsta ação NÃO pode ser desfeita!\n\nTem certeza que deseja continuar?')) {
                if (confirm('Confirmação final: Digite SIM para confirmar a exclusão completa')) {
                    app.state.equipamentos = [];
                    app.state.colhedorasData = [];
                    app.state.transbordosData = [];
                    app.state.caminhoesData = [];
                    app.state.moagemData = [];
                    app.state.notifications = [];
                    
                    localStorage.removeItem('agroManagerData');
                    
                    app.updateDashboard();
                    app.updateEquipmentList();
                    app.updateRecordsTab();
                    app.updateTabCounts();
                    app.closeModal();
                    
                    app.showNotification('Todos os dados foram removidos do sistema!', 'warning');
                }
            }
        }

        function generateReport() {
            const weekData = app.getWeekData();
            const totalRecords = app.getAllRecords().length;
            
            app.showNotification('Gerando relatório completo...', 'info', 2000);
            
            setTimeout(() => {
                const reportContent = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Relatório Operacional Completo</h3>
                            <button onclick="app.closeModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-chart-line text-6xl mb-4 opacity-50"></i>
                            <h4 class="text-lg font-medium mb-2">Relatório Detalhado</h4>
                            <p class="mb-4">Funcionalidade de geração de relatórios completos em desenvolvimento</p>
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-left max-w-md mx-auto">
                                <h5 class="font-semibold mb-2">Resumo Atual:</h5>
                                <ul class="space-y-1 text-sm">
                                    <li>• ${app.state.equipamentos.length} equipamentos cadastrados</li>
                                    <li>• ${totalRecords} registros operacionais</li>
                                    <li>• ${weekData.colhedoras.length} registros de colheita esta semana</li>
                                    <li>• ${weekData.transbordos.length} registros de transbordo esta semana</li>
                                    <li>• ${weekData.caminhoes.length} registros de caminhão esta semana</li>
                                    <li>• ${weekData.moagem.length} registros de moagem esta semana</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-3 pt-4">
                            <button onclick="exportAllData()" class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                            <button onclick="app.closeModal()" class="btn-primary">Fechar</button>
                        </div>
                    </div>
                `;
                app.openModal(reportContent);
            }, 1000);
        }

        // CHART EXPANSION AND TYPE TOGGLE
        function expandChart(chartId) {
            const chart = app.state.charts[chartId.replace('Chart', '')];
            if (!chart) return;

            const canvas = document.getElementById(chartId);
            if (!canvas) return;

            // Create fullscreen modal
            const modal = document.createElement('div');
            modal.className = 'chart-full-screen';
            modal.innerHTML = `
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Gráfico Expandido</h3>
                    <button onclick="closeExpandedChart()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="flex-1 p-6">
                    <canvas id="${chartId}Expanded" style="width: 100%; height: calc(100vh - 200px);"></canvas>
                </div>
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 text-center text-sm text-gray-500">
                    Pressione ESC para fechar
                </div>
            `;

            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';

            // Clone chart data and create expanded version
            setTimeout(() => {
                const expandedCanvas = document.getElementById(chartId + 'Expanded');
                if (expandedCanvas && chart.config) {
                    const expandedChart = new Chart(expandedCanvas.getContext('2d'), {
                        type: chart.config.type,
                        data: chart.data,
                        options: {
                            ...chart.options,
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                    
                    // Store reference for cleanup
                    modal.expandedChart = expandedChart;
                }
            }, 100);

            // ESC key handler
            const escHandler = (e) => {
                if (e.key === 'Escape') {
                    closeExpandedChart();
                    document.removeEventListener('keydown', escHandler);
                }
            };
            document.addEventListener('keydown', escHandler);
        }

        function closeExpandedChart() {
            const modal = document.querySelector('.chart-full-screen');
            if (modal) {
                if (modal.expandedChart) {
                    modal.expandedChart.destroy();
                }
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        }

        function toggleChartType(chartId) {
            const chartName = chartId.replace('Chart', '');
            const chart = app.state.charts[chartName];
            if (!chart) return;

            const currentType = chart.config.type;
            let newType;

            // Determine next chart type
            switch (currentType) {
                case 'bar':
                    newType = 'line';
                    break;
                case 'line':
                    newType = 'radar';
                    break;
                case 'radar':
                    newType = 'doughnut';
                    break;
                case 'doughnut':
                    newType = 'polarArea';
                    break;
                case 'polarArea':
                    newType = 'bar';
                    break;
                default:
                    newType = 'bar';
            }

            // Update chart type
            chart.config.type = newType;
            chart.update();
            
            app.showNotification(`Tipo de gráfico alterado para: ${newType}`, 'success', 2000);
        }

        // Initialize filter dates
        document.addEventListener('DOMContentLoaded', function() {
            // Set default filter dates to current week
            const now = new Date();
            const weekStart = app.getWeekStart(now);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            const filterDataInicio = document.getElementById('filterDataInicio');
            const filterDataFim = document.getElementById('filterDataFim');
            
            if (filterDataInicio) {
                filterDataInicio.value = weekStart.toISOString().split('T')[0];
            }
            if (filterDataFim) {
                filterDataFim.value = weekEnd.toISOString().split('T')[0];
            }
        });

        console.log('🚜 AgroManager Pro v3.1 - Sistema inicializado com sucesso!');
        console.log('📊 Dashboard operacional carregado');
        console.log('💾 Sistema de persistência ativo');
        console.log('🔄 Atualizações em tempo real habilitadas');
    </script>
</body>
</html>
